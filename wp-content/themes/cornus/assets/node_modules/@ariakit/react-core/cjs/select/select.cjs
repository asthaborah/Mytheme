"use strict";Object.defineProperty(exports, "__esModule", {value: true});"use client";


var _LICANQTIcjs = require('../__chunks/LICANQTI.cjs');
require('../__chunks/QCG6J6X5.cjs');
require('../__chunks/LFHNPG2L.cjs');
require('../__chunks/3QW6ELTG.cjs');
require('../__chunks/5UTRYT6E.cjs');


var _KQN7YDDZcjs = require('../__chunks/KQN7YDDZ.cjs');
require('../__chunks/YU7XEYUJ.cjs');


var _6PUZ4NWRcjs = require('../__chunks/6PUZ4NWR.cjs');



var _2WCJJQSKcjs = require('../__chunks/2WCJJQSK.cjs');
require('../__chunks/DAJUUBUI.cjs');
require('../__chunks/6ZZYUFPW.cjs');
require('../__chunks/UZNYSPKP.cjs');
require('../__chunks/BZTDJIVT.cjs');
require('../__chunks/UVBBMANL.cjs');
require('../__chunks/F2A2ZQDB.cjs');
require('../__chunks/S6UU7NA4.cjs');
require('../__chunks/Z3GCTNW4.cjs');
require('../__chunks/75KXQZJX.cjs');




var _RNZNGEL4cjs = require('../__chunks/RNZNGEL4.cjs');





var _EO6LS72Hcjs = require('../__chunks/EO6LS72H.cjs');
require('../__chunks/CJDHQUBR.cjs');




var _AV6KTKLEcjs = require('../__chunks/AV6KTKLE.cjs');

// src/select/select.tsx
var _react = require('react');
var _array = require('@ariakit/core/utils/array');
var _dom = require('@ariakit/core/utils/dom');
var _events = require('@ariakit/core/utils/events');
var _misc = require('@ariakit/core/utils/misc');
var _jsxruntime = require('react/jsx-runtime');
function getSelectedValues(select) {
  return Array.from(select.selectedOptions).map((option) => option.value);
}
function nextWithValue(store, next) {
  return () => {
    const nextId = next();
    if (!nextId)
      return;
    let i = 0;
    let nextItem = store.item(nextId);
    const firstItem = nextItem;
    while (nextItem && nextItem.value == null) {
      const nextId2 = next(++i);
      if (!nextId2)
        return;
      nextItem = store.item(nextId2);
      if (nextItem === firstItem)
        break;
    }
    return nextItem == null ? void 0 : nextItem.id;
  };
}
var useSelect = _RNZNGEL4cjs.createHook.call(void 0, 
  (_a) => {
    var _b = _a, {
      store,
      name,
      form,
      required,
      showOnKeyDown = true,
      moveOnKeyDown = true,
      toggleOnClick = false,
      toggleOnPress = !toggleOnClick
    } = _b, props = _AV6KTKLEcjs.__objRest.call(void 0, _b, [
      "store",
      "name",
      "form",
      "required",
      "showOnKeyDown",
      "moveOnKeyDown",
      "toggleOnClick",
      "toggleOnPress"
    ]);
    const context = _2WCJJQSKcjs.useSelectProviderContext.call(void 0, );
    store = store || context;
    _misc.invariant.call(void 0, 
      store,
      process.env.NODE_ENV !== "production" && "Select must receive a `store` prop or be wrapped in a SelectProvider component."
    );
    toggleOnPress = toggleOnClick ? false : toggleOnPress;
    const onKeyDownProp = props.onKeyDown;
    const showOnKeyDownProp = _EO6LS72Hcjs.useBooleanEvent.call(void 0, showOnKeyDown);
    const moveOnKeyDownProp = _EO6LS72Hcjs.useBooleanEvent.call(void 0, moveOnKeyDown);
    const toggleOnPressProp = _EO6LS72Hcjs.useBooleanEvent.call(void 0, toggleOnPress);
    const placement = store.useState("placement");
    const dir = placement.split("-")[0];
    const value = store.useState("value");
    const multiSelectable = Array.isArray(value);
    const onKeyDown = _EO6LS72Hcjs.useEvent.call(void 0, (event) => {
      var _a2;
      onKeyDownProp == null ? void 0 : onKeyDownProp(event);
      if (event.defaultPrevented)
        return;
      if (!store)
        return;
      const { orientation, items: items2, activeId } = store.getState();
      if (event.key === " " || event.key === "Enter") {
        if (toggleOnPressProp(event)) {
          event.preventDefault();
          store.toggle();
        }
      }
      const isVertical = orientation !== "horizontal";
      const isHorizontal = orientation !== "vertical";
      const isGrid = !!((_a2 = items2.find(
        (item) => !item.disabled && item.value != null
      )) == null ? void 0 : _a2.rowId);
      const moveKeyMap = {
        ArrowUp: (isGrid || isVertical) && nextWithValue(store, store.up),
        ArrowRight: (isGrid || isHorizontal) && nextWithValue(store, store.next),
        ArrowDown: (isGrid || isVertical) && nextWithValue(store, store.down),
        ArrowLeft: (isGrid || isHorizontal) && nextWithValue(store, store.previous)
      };
      const getId = moveKeyMap[event.key];
      if (getId && moveOnKeyDownProp(event)) {
        event.preventDefault();
        store.move(getId());
      }
      const isTopOrBottom = dir === "top" || dir === "bottom";
      const isLeft = dir === "left";
      const isRight = dir === "right";
      const canShowKeyMap = {
        ArrowDown: isTopOrBottom,
        ArrowUp: isTopOrBottom,
        ArrowLeft: isLeft,
        ArrowRight: isRight
      };
      const canShow = canShowKeyMap[event.key];
      if (canShow && showOnKeyDownProp(event)) {
        event.preventDefault();
        store.move(activeId);
        _events.queueBeforeEvent.call(void 0, event.currentTarget, "keyup", store.show);
      }
    });
    const onMouseDownProp = props.onMouseDown;
    const onMouseDown = _EO6LS72Hcjs.useEvent.call(void 0, (event) => {
      onMouseDownProp == null ? void 0 : onMouseDownProp(event);
      if (event.defaultPrevented)
        return;
      if (event.button)
        return;
      if (event.ctrlKey)
        return;
      if (!toggleOnPressProp(event))
        return;
      const element = event.currentTarget;
      _events.queueBeforeEvent.call(void 0, element, "focusin", () => {
        store == null ? void 0 : store.setDisclosureElement(element);
        store == null ? void 0 : store.toggle();
      });
    });
    props = _EO6LS72Hcjs.useWrapElement.call(void 0, 
      props,
      (element) => /* @__PURE__ */ _jsxruntime.jsx.call(void 0, _2WCJJQSKcjs.SelectScopedContextProvider, { value: store, children: element }),
      [store]
    );
    const [autofill, setAutofill] = _react.useState.call(void 0, false);
    const nativeSelectChangedRef = _react.useRef.call(void 0, false);
    _react.useEffect.call(void 0, () => {
      const nativeSelectChanged = nativeSelectChangedRef.current;
      nativeSelectChangedRef.current = false;
      if (nativeSelectChanged)
        return;
      setAutofill(false);
    }, [value]);
    const labelId = store.useState((state) => {
      var _a2;
      return (_a2 = state.labelElement) == null ? void 0 : _a2.id;
    });
    const label = props["aria-label"];
    const labelledBy = props["aria-labelledby"] || labelId;
    const items = store.useState((state) => {
      if (!name)
        return;
      return state.items;
    });
    const values = _react.useMemo.call(void 0, () => {
      return [...new Set(items == null ? void 0 : items.map((i) => i.value).filter((v) => v != null))];
    }, [items]);
    props = _EO6LS72Hcjs.useWrapElement.call(void 0, 
      props,
      (element) => {
        if (!name)
          return element;
        return /* @__PURE__ */ _jsxruntime.jsxs.call(void 0, _jsxruntime.Fragment, { children: [
          /* @__PURE__ */ _jsxruntime.jsxs.call(void 0, 
            "select",
            {
              style: {
                border: 0,
                clip: "rect(0 0 0 0)",
                height: "1px",
                margin: "-1px",
                overflow: "hidden",
                padding: 0,
                position: "absolute",
                whiteSpace: "nowrap",
                width: "1px"
              },
              tabIndex: -1,
              "aria-hidden": true,
              "aria-label": label,
              "aria-labelledby": labelledBy,
              name,
              form,
              required,
              value,
              multiple: multiSelectable,
              onFocus: () => {
                var _a2;
                return (_a2 = store == null ? void 0 : store.getState().selectElement) == null ? void 0 : _a2.focus();
              },
              onChange: (event) => {
                nativeSelectChangedRef.current = true;
                setAutofill(true);
                store == null ? void 0 : store.setValue(
                  multiSelectable ? getSelectedValues(event.target) : event.target.value
                );
              },
              children: [
                _array.toArray.call(void 0, value).map((value2) => {
                  if (value2 == null)
                    return null;
                  if (values.includes(value2))
                    return null;
                  return /* @__PURE__ */ _jsxruntime.jsx.call(void 0, "option", { value: value2, children: value2 }, value2);
                }),
                values.map((value2) => /* @__PURE__ */ _jsxruntime.jsx.call(void 0, "option", { value: value2, children: value2 }, value2))
              ]
            }
          ),
          element
        ] });
      },
      [
        store,
        label,
        labelledBy,
        name,
        form,
        required,
        value,
        multiSelectable,
        values
      ]
    );
    const children = /* @__PURE__ */ _jsxruntime.jsxs.call(void 0, _jsxruntime.Fragment, { children: [
      value,
      /* @__PURE__ */ _jsxruntime.jsx.call(void 0, _KQN7YDDZcjs.SelectArrow, {})
    ] });
    const contentElement = store.useState("contentElement");
    props = _AV6KTKLEcjs.__spreadProps.call(void 0, _AV6KTKLEcjs.__spreadValues.call(void 0, {
      role: "combobox",
      "aria-autocomplete": "none",
      "aria-labelledby": labelId,
      "aria-haspopup": _dom.getPopupRole.call(void 0, contentElement, "listbox"),
      "data-autofill": autofill ? "" : void 0,
      "data-name": name,
      children
    }, props), {
      ref: _EO6LS72Hcjs.useMergeRefs.call(void 0, store.setSelectElement, props.ref),
      onKeyDown,
      onMouseDown
    });
    props = _LICANQTIcjs.usePopoverDisclosure.call(void 0, _AV6KTKLEcjs.__spreadValues.call(void 0, { store, toggleOnClick }, props));
    props = _6PUZ4NWRcjs.useCompositeTypeahead.call(void 0, _AV6KTKLEcjs.__spreadValues.call(void 0, { store }, props));
    return props;
  }
);
var Select = _RNZNGEL4cjs.createComponent.call(void 0, (props) => {
  const htmlProps = useSelect(props);
  return _RNZNGEL4cjs.createElement.call(void 0, "button", htmlProps);
});
if (process.env.NODE_ENV !== "production") {
  Select.displayName = "Select";
}



exports.Select = Select; exports.useSelect = useSelect;
