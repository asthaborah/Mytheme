{"version":3,"names":["isPlainObject","isValidElementType","deprecated","applyFilters","isValidIcon","normalizeIconObject","omit","BLOCK_ICON_DEFAULT","DEPRECATED_ENTRY_KEYS","error","args","window","console","warn","LEGACY_CATEGORY_MAPPING","common","formatting","layout","processBlockType","name","blockSettings","select","blockType","icon","keywords","attributes","providesContext","usesContext","selectors","supports","styles","variations","blockHooks","save","getBootstrappedBlockType","settings","description","since","map","deprecation","Object","fromEntries","entries","filter","key","includes","edit","hasOwnProperty","category","getCategories","some","slug","title","src"],"sources":["@wordpress/blocks/src/store/process-block-type.js"],"sourcesContent":["/**\n * External dependencies\n */\nimport { isPlainObject } from 'is-plain-object';\nimport { isValidElementType } from 'react-is';\n\n/**\n * WordPress dependencies\n */\nimport deprecated from '@wordpress/deprecated';\nimport { applyFilters } from '@wordpress/hooks';\n\n/**\n * Internal dependencies\n */\nimport { isValidIcon, normalizeIconObject, omit } from '../api/utils';\nimport { BLOCK_ICON_DEFAULT, DEPRECATED_ENTRY_KEYS } from '../api/constants';\n\n/** @typedef {import('../api/registration').WPBlockType} WPBlockType */\n\nconst error = ( ...args ) => window?.console?.error?.( ...args );\nconst warn = ( ...args ) => window?.console?.warn?.( ...args );\n\n/**\n * Mapping of legacy category slugs to their latest normal values, used to\n * accommodate updates of the default set of block categories.\n *\n * @type {Record<string,string>}\n */\nconst LEGACY_CATEGORY_MAPPING = {\n\tcommon: 'text',\n\tformatting: 'text',\n\tlayout: 'design',\n};\n\n/**\n * Takes the unprocessed block type settings, merges them with block type metadata\n * and applies all the existing filters for the registered block type.\n * Next, it validates all the settings and performs additional processing to the block type definition.\n *\n * @param {string}      name          Block name.\n * @param {WPBlockType} blockSettings Unprocessed block type settings.\n *\n * @return {WPBlockType | undefined} The block, if it has been processed and can be registered; otherwise `undefined`.\n */\nexport const processBlockType =\n\t( name, blockSettings ) =>\n\t( { select } ) => {\n\t\tconst blockType = {\n\t\t\tname,\n\t\t\ticon: BLOCK_ICON_DEFAULT,\n\t\t\tkeywords: [],\n\t\t\tattributes: {},\n\t\t\tprovidesContext: {},\n\t\t\tusesContext: [],\n\t\t\tselectors: {},\n\t\t\tsupports: {},\n\t\t\tstyles: [],\n\t\t\tvariations: [],\n\t\t\tblockHooks: {},\n\t\t\tsave: () => null,\n\t\t\t...select.getBootstrappedBlockType( name ),\n\t\t\t...blockSettings,\n\t\t};\n\n\t\tconst settings = applyFilters(\n\t\t\t'blocks.registerBlockType',\n\t\t\tblockType,\n\t\t\tname,\n\t\t\tnull\n\t\t);\n\n\t\tif (\n\t\t\tsettings.description &&\n\t\t\ttypeof settings.description !== 'string'\n\t\t) {\n\t\t\tdeprecated( 'Declaring non-string block descriptions', {\n\t\t\t\tsince: '6.2',\n\t\t\t} );\n\t\t}\n\n\t\tif ( settings.deprecated ) {\n\t\t\tsettings.deprecated = settings.deprecated.map( ( deprecation ) =>\n\t\t\t\tObject.fromEntries(\n\t\t\t\t\tObject.entries(\n\t\t\t\t\t\t// Only keep valid deprecation keys.\n\t\t\t\t\t\tapplyFilters(\n\t\t\t\t\t\t\t'blocks.registerBlockType',\n\t\t\t\t\t\t\t// Merge deprecation keys with pre-filter settings\n\t\t\t\t\t\t\t// so that filters that depend on specific keys being\n\t\t\t\t\t\t\t// present don't fail.\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t// Omit deprecation keys here so that deprecations\n\t\t\t\t\t\t\t\t// can opt out of specific keys like \"supports\".\n\t\t\t\t\t\t\t\t...omit( blockType, DEPRECATED_ENTRY_KEYS ),\n\t\t\t\t\t\t\t\t...deprecation,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tblockType.name,\n\t\t\t\t\t\t\tdeprecation\n\t\t\t\t\t\t)\n\t\t\t\t\t).filter( ( [ key ] ) =>\n\t\t\t\t\t\tDEPRECATED_ENTRY_KEYS.includes( key )\n\t\t\t\t\t)\n\t\t\t\t)\n\t\t\t);\n\t\t}\n\n\t\tif ( ! isPlainObject( settings ) ) {\n\t\t\terror( 'Block settings must be a valid object.' );\n\t\t\treturn;\n\t\t}\n\n\t\tif ( typeof settings.save !== 'function' ) {\n\t\t\terror( 'The \"save\" property must be a valid function.' );\n\t\t\treturn;\n\t\t}\n\t\tif ( 'edit' in settings && ! isValidElementType( settings.edit ) ) {\n\t\t\terror( 'The \"edit\" property must be a valid component.' );\n\t\t\treturn;\n\t\t}\n\n\t\t// Canonicalize legacy categories to equivalent fallback.\n\t\tif ( LEGACY_CATEGORY_MAPPING.hasOwnProperty( settings.category ) ) {\n\t\t\tsettings.category = LEGACY_CATEGORY_MAPPING[ settings.category ];\n\t\t}\n\n\t\tif (\n\t\t\t'category' in settings &&\n\t\t\t! select\n\t\t\t\t.getCategories()\n\t\t\t\t.some( ( { slug } ) => slug === settings.category )\n\t\t) {\n\t\t\twarn(\n\t\t\t\t'The block \"' +\n\t\t\t\t\tname +\n\t\t\t\t\t'\" is registered with an invalid category \"' +\n\t\t\t\t\tsettings.category +\n\t\t\t\t\t'\".'\n\t\t\t);\n\t\t\tdelete settings.category;\n\t\t}\n\n\t\tif ( ! ( 'title' in settings ) || settings.title === '' ) {\n\t\t\terror( 'The block \"' + name + '\" must have a title.' );\n\t\t\treturn;\n\t\t}\n\t\tif ( typeof settings.title !== 'string' ) {\n\t\t\terror( 'Block titles must be strings.' );\n\t\t\treturn;\n\t\t}\n\n\t\tsettings.icon = normalizeIconObject( settings.icon );\n\t\tif ( ! isValidIcon( settings.icon.src ) ) {\n\t\t\terror(\n\t\t\t\t'The icon passed is invalid. ' +\n\t\t\t\t\t'The icon should be a string, an element, a function, or an object following the specifications documented in https://developer.wordpress.org/block-editor/developers/block-api/block-registration/#icon-optional'\n\t\t\t);\n\t\t\treturn;\n\t\t}\n\n\t\treturn settings;\n\t};\n"],"mappings":"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"}