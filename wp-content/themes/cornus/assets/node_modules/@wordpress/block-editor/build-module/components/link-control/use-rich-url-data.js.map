{"version":3,"names":["store","blockEditorStore","useSelect","useEffect","useReducer","reducer","state","action","type","isFetching","richData","Error","useRemoteUrlData","url","dispatch","fetchRichUrlData","select","getSettings","__experimentalFetchRichUrlData","length","AbortController","controller","window","signal","then","urlData","catch","aborted","abort"],"sources":["@wordpress/block-editor/src/components/link-control/use-rich-url-data.js"],"sourcesContent":["/**\n * Internal dependencies\n */\nimport { store as blockEditorStore } from '../../store';\n\n/**\n * WordPress dependencies\n */\nimport { useSelect } from '@wordpress/data';\nimport { useEffect, useReducer } from '@wordpress/element';\n\nfunction reducer( state, action ) {\n\tswitch ( action.type ) {\n\t\tcase 'RESOLVED':\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tisFetching: false,\n\t\t\t\trichData: action.richData,\n\t\t\t};\n\t\tcase 'ERROR':\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tisFetching: false,\n\t\t\t\trichData: null,\n\t\t\t};\n\t\tcase 'LOADING':\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tisFetching: true,\n\t\t\t};\n\t\tdefault:\n\t\t\tthrow new Error( `Unexpected action type ${ action.type }` );\n\t}\n}\n\nfunction useRemoteUrlData( url ) {\n\tconst [ state, dispatch ] = useReducer( reducer, {\n\t\trichData: null,\n\t\tisFetching: false,\n\t} );\n\n\tconst { fetchRichUrlData } = useSelect( ( select ) => {\n\t\tconst { getSettings } = select( blockEditorStore );\n\t\treturn {\n\t\t\tfetchRichUrlData: getSettings().__experimentalFetchRichUrlData,\n\t\t};\n\t}, [] );\n\n\tuseEffect( () => {\n\t\t// Only make the request if we have an actual URL\n\t\t// and the fetching util is available. In some editors\n\t\t// there may not be such a util.\n\t\tif (\n\t\t\turl?.length &&\n\t\t\tfetchRichUrlData &&\n\t\t\ttypeof AbortController !== 'undefined'\n\t\t) {\n\t\t\tdispatch( {\n\t\t\t\ttype: 'LOADING',\n\t\t\t} );\n\n\t\t\tconst controller = new window.AbortController();\n\n\t\t\tconst signal = controller.signal;\n\n\t\t\tfetchRichUrlData( url, {\n\t\t\t\tsignal,\n\t\t\t} )\n\t\t\t\t.then( ( urlData ) => {\n\t\t\t\t\tdispatch( {\n\t\t\t\t\t\ttype: 'RESOLVED',\n\t\t\t\t\t\trichData: urlData,\n\t\t\t\t\t} );\n\t\t\t\t} )\n\t\t\t\t.catch( () => {\n\t\t\t\t\t// Avoid setting state on unmounted component\n\t\t\t\t\tif ( ! signal.aborted ) {\n\t\t\t\t\t\tdispatch( {\n\t\t\t\t\t\t\ttype: 'ERROR',\n\t\t\t\t\t\t} );\n\t\t\t\t\t}\n\t\t\t\t} );\n\t\t\t// Cleanup: when the URL changes the abort the current request.\n\t\t\treturn () => {\n\t\t\t\tcontroller.abort();\n\t\t\t};\n\t\t}\n\t}, [ url ] );\n\n\treturn state;\n}\n\nexport default useRemoteUrlData;\n"],"mappings":"AAAA;AACA;AACA;AACA,SAASA,KAAK,IAAIC,gBAAgB,QAAQ,aAAa;;AAEvD;AACA;AACA;AACA,SAASC,SAAS,QAAQ,iBAAiB;AAC3C,SAASC,SAAS,EAAEC,UAAU,QAAQ,oBAAoB;AAE1D,SAASC,OAAOA,CAAEC,KAAK,EAAEC,MAAM,EAAG;EACjC,QAASA,MAAM,CAACC,IAAI;IACnB,KAAK,UAAU;MACd,OAAO;QACN,GAAGF,KAAK;QACRG,UAAU,EAAE,KAAK;QACjBC,QAAQ,EAAEH,MAAM,CAACG;MAClB,CAAC;IACF,KAAK,OAAO;MACX,OAAO;QACN,GAAGJ,KAAK;QACRG,UAAU,EAAE,KAAK;QACjBC,QAAQ,EAAE;MACX,CAAC;IACF,KAAK,SAAS;MACb,OAAO;QACN,GAAGJ,KAAK;QACRG,UAAU,EAAE;MACb,CAAC;IACF;MACC,MAAM,IAAIE,KAAK,CAAG,0BAA0BJ,MAAM,CAACC,IAAM,EAAE,CAAC;EAC9D;AACD;AAEA,SAASI,gBAAgBA,CAAEC,GAAG,EAAG;EAChC,MAAM,CAAEP,KAAK,EAAEQ,QAAQ,CAAE,GAAGV,UAAU,CAAEC,OAAO,EAAE;IAChDK,QAAQ,EAAE,IAAI;IACdD,UAAU,EAAE;EACb,CAAE,CAAC;EAEH,MAAM;IAAEM;EAAiB,CAAC,GAAGb,SAAS,CAAIc,MAAM,IAAM;IACrD,MAAM;MAAEC;IAAY,CAAC,GAAGD,MAAM,CAAEf,gBAAiB,CAAC;IAClD,OAAO;MACNc,gBAAgB,EAAEE,WAAW,CAAC,CAAC,CAACC;IACjC,CAAC;EACF,CAAC,EAAE,EAAG,CAAC;EAEPf,SAAS,CAAE,MAAM;IAChB;IACA;IACA;IACA,IACCU,GAAG,EAAEM,MAAM,IACXJ,gBAAgB,IAChB,OAAOK,eAAe,KAAK,WAAW,EACrC;MACDN,QAAQ,CAAE;QACTN,IAAI,EAAE;MACP,CAAE,CAAC;MAEH,MAAMa,UAAU,GAAG,IAAIC,MAAM,CAACF,eAAe,CAAC,CAAC;MAE/C,MAAMG,MAAM,GAAGF,UAAU,CAACE,MAAM;MAEhCR,gBAAgB,CAAEF,GAAG,EAAE;QACtBU;MACD,CAAE,CAAC,CACDC,IAAI,CAAIC,OAAO,IAAM;QACrBX,QAAQ,CAAE;UACTN,IAAI,EAAE,UAAU;UAChBE,QAAQ,EAAEe;QACX,CAAE,CAAC;MACJ,CAAE,CAAC,CACFC,KAAK,CAAE,MAAM;QACb;QACA,IAAK,CAAEH,MAAM,CAACI,OAAO,EAAG;UACvBb,QAAQ,CAAE;YACTN,IAAI,EAAE;UACP,CAAE,CAAC;QACJ;MACD,CAAE,CAAC;MACJ;MACA,OAAO,MAAM;QACZa,UAAU,CAACO,KAAK,CAAC,CAAC;MACnB,CAAC;IACF;EACD,CAAC,EAAE,CAAEf,GAAG,CAAG,CAAC;EAEZ,OAAOP,KAAK;AACb;AAEA,eAAeM,gBAAgB"}