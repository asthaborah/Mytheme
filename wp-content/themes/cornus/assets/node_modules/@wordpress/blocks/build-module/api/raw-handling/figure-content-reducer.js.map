{"version":3,"names":["isTextContent","isFigureContent","node","schema","_schema$figure$childr","tag","nodeName","toLowerCase","figure","children","canHaveAnchor","_schema$figure$childr2","a","wrapFigureContent","element","beforeElement","ownerDocument","createElement","parentNode","insertBefore","appendChild","figureContentReducer","doc","nodeToInsert","childNodes","length","wrapper","closest","classList","contains","textContent","trim"],"sources":["@wordpress/blocks/src/api/raw-handling/figure-content-reducer.js"],"sourcesContent":["/**\n * WordPress dependencies\n */\nimport { isTextContent } from '@wordpress/dom';\n\n/**\n * Whether or not the given node is figure content.\n *\n * @param {Node}   node   The node to check.\n * @param {Object} schema The schema to use.\n *\n * @return {boolean} True if figure content, false if not.\n */\nfunction isFigureContent( node, schema ) {\n\tconst tag = node.nodeName.toLowerCase();\n\n\t// We are looking for tags that can be a child of the figure tag, excluding\n\t// `figcaption` and any phrasing content.\n\tif ( tag === 'figcaption' || isTextContent( node ) ) {\n\t\treturn false;\n\t}\n\n\treturn tag in ( schema?.figure?.children ?? {} );\n}\n\n/**\n * Whether or not the given node can have an anchor.\n *\n * @param {Node}   node   The node to check.\n * @param {Object} schema The schema to use.\n *\n * @return {boolean} True if it can, false if not.\n */\nfunction canHaveAnchor( node, schema ) {\n\tconst tag = node.nodeName.toLowerCase();\n\n\treturn tag in ( schema?.figure?.children?.a?.children ?? {} );\n}\n\n/**\n * Wraps the given element in a figure element.\n *\n * @param {Element} element       The element to wrap.\n * @param {Element} beforeElement The element before which to place the figure.\n */\nfunction wrapFigureContent( element, beforeElement = element ) {\n\tconst figure = element.ownerDocument.createElement( 'figure' );\n\tbeforeElement.parentNode.insertBefore( figure, beforeElement );\n\tfigure.appendChild( element );\n}\n\n/**\n * This filter takes figure content out of paragraphs, wraps it in a figure\n * element, and moves any anchors with it if needed.\n *\n * @param {Node}     node   The node to filter.\n * @param {Document} doc    The document of the node.\n * @param {Object}   schema The schema to use.\n *\n * @return {void}\n */\nexport default function figureContentReducer( node, doc, schema ) {\n\tif ( ! isFigureContent( node, schema ) ) {\n\t\treturn;\n\t}\n\n\tlet nodeToInsert = node;\n\tconst parentNode = node.parentNode;\n\n\t// If the figure content can have an anchor and its parent is an anchor with\n\t// only the figure content, take the anchor out instead of just the content.\n\tif (\n\t\tcanHaveAnchor( node, schema ) &&\n\t\tparentNode.nodeName === 'A' &&\n\t\tparentNode.childNodes.length === 1\n\t) {\n\t\tnodeToInsert = node.parentNode;\n\t}\n\n\tconst wrapper = nodeToInsert.closest( 'p,div' );\n\n\t// If wrapped in a paragraph or div, only extract if it's aligned or if\n\t// there is no text content.\n\t// Otherwise, if directly at the root, wrap in a figure element.\n\tif ( wrapper ) {\n\t\t// In jsdom-jscore, 'node.classList' can be undefined.\n\t\t// In this case, default to extract as it offers a better UI experience on mobile.\n\t\tif ( ! node.classList ) {\n\t\t\twrapFigureContent( nodeToInsert, wrapper );\n\t\t} else if (\n\t\t\tnode.classList.contains( 'alignright' ) ||\n\t\t\tnode.classList.contains( 'alignleft' ) ||\n\t\t\tnode.classList.contains( 'aligncenter' ) ||\n\t\t\t! wrapper.textContent.trim()\n\t\t) {\n\t\t\twrapFigureContent( nodeToInsert, wrapper );\n\t\t}\n\t} else if ( nodeToInsert.parentNode.nodeName === 'BODY' ) {\n\t\twrapFigureContent( nodeToInsert );\n\t}\n}\n"],"mappings":"AAAA;AACA;AACA;AACA,SAASA,aAAa,QAAQ,gBAAgB;;AAE9C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAASC,eAAeA,CAAEC,IAAI,EAAEC,MAAM,EAAG;EAAA,IAAAC,qBAAA;EACxC,MAAMC,GAAG,GAAGH,IAAI,CAACI,QAAQ,CAACC,WAAW,CAAC,CAAC;;EAEvC;EACA;EACA,IAAKF,GAAG,KAAK,YAAY,IAAIL,aAAa,CAAEE,IAAK,CAAC,EAAG;IACpD,OAAO,KAAK;EACb;EAEA,OAAOG,GAAG,MAAAD,qBAAA,GAAMD,MAAM,EAAEK,MAAM,EAAEC,QAAQ,cAAAL,qBAAA,cAAAA,qBAAA,GAAI,CAAC,CAAC,CAAE;AACjD;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAASM,aAAaA,CAAER,IAAI,EAAEC,MAAM,EAAG;EAAA,IAAAQ,sBAAA;EACtC,MAAMN,GAAG,GAAGH,IAAI,CAACI,QAAQ,CAACC,WAAW,CAAC,CAAC;EAEvC,OAAOF,GAAG,MAAAM,sBAAA,GAAMR,MAAM,EAAEK,MAAM,EAAEC,QAAQ,EAAEG,CAAC,EAAEH,QAAQ,cAAAE,sBAAA,cAAAA,sBAAA,GAAI,CAAC,CAAC,CAAE;AAC9D;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,SAASE,iBAAiBA,CAAEC,OAAO,EAAEC,aAAa,GAAGD,OAAO,EAAG;EAC9D,MAAMN,MAAM,GAAGM,OAAO,CAACE,aAAa,CAACC,aAAa,CAAE,QAAS,CAAC;EAC9DF,aAAa,CAACG,UAAU,CAACC,YAAY,CAAEX,MAAM,EAAEO,aAAc,CAAC;EAC9DP,MAAM,CAACY,WAAW,CAAEN,OAAQ,CAAC;AAC9B;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,eAAe,SAASO,oBAAoBA,CAAEnB,IAAI,EAAEoB,GAAG,EAAEnB,MAAM,EAAG;EACjE,IAAK,CAAEF,eAAe,CAAEC,IAAI,EAAEC,MAAO,CAAC,EAAG;IACxC;EACD;EAEA,IAAIoB,YAAY,GAAGrB,IAAI;EACvB,MAAMgB,UAAU,GAAGhB,IAAI,CAACgB,UAAU;;EAElC;EACA;EACA,IACCR,aAAa,CAAER,IAAI,EAAEC,MAAO,CAAC,IAC7Be,UAAU,CAACZ,QAAQ,KAAK,GAAG,IAC3BY,UAAU,CAACM,UAAU,CAACC,MAAM,KAAK,CAAC,EACjC;IACDF,YAAY,GAAGrB,IAAI,CAACgB,UAAU;EAC/B;EAEA,MAAMQ,OAAO,GAAGH,YAAY,CAACI,OAAO,CAAE,OAAQ,CAAC;;EAE/C;EACA;EACA;EACA,IAAKD,OAAO,EAAG;IACd;IACA;IACA,IAAK,CAAExB,IAAI,CAAC0B,SAAS,EAAG;MACvBf,iBAAiB,CAAEU,YAAY,EAAEG,OAAQ,CAAC;IAC3C,CAAC,MAAM,IACNxB,IAAI,CAAC0B,SAAS,CAACC,QAAQ,CAAE,YAAa,CAAC,IACvC3B,IAAI,CAAC0B,SAAS,CAACC,QAAQ,CAAE,WAAY,CAAC,IACtC3B,IAAI,CAAC0B,SAAS,CAACC,QAAQ,CAAE,aAAc,CAAC,IACxC,CAAEH,OAAO,CAACI,WAAW,CAACC,IAAI,CAAC,CAAC,EAC3B;MACDlB,iBAAiB,CAAEU,YAAY,EAAEG,OAAQ,CAAC;IAC3C;EACD,CAAC,MAAM,IAAKH,YAAY,CAACL,UAAU,CAACZ,QAAQ,KAAK,MAAM,EAAG;IACzDO,iBAAiB,CAAEU,YAAa,CAAC;EAClC;AACD"}