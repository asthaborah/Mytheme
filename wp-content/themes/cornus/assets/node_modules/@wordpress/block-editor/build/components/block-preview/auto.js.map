{"version":3,"names":["_compose","require","_data","_element","_components","_blockList","_interopRequireDefault","_iframe","_editorStyles","_store","MemoizedBlockList","MAX_HEIGHT","EMPTY_ADDITIONAL_STYLES","ScaledBlockPreview","viewportWidth","containerWidth","minHeight","additionalStyles","contentResizeListener","height","contentHeight","useResizeObserver","styles","useSelect","select","settings","store","getSettings","editorStyles","useMemo","css","__unstableType","memo","BlockList","scale","aspectRatio","_react","createElement","Disabled","className","style","transform","maxHeight","undefined","default","contentRef","useRefEffect","bodyElement","ownerDocument","documentElement","classList","add","position","width","boxSizing","tabIndex","pointerEvents","renderAppender","AutoBlockPreview","props","containerResizeListener","Fragment"],"sources":["@wordpress/block-editor/src/components/block-preview/auto.js"],"sourcesContent":["/**\n * WordPress dependencies\n */\nimport { useResizeObserver, useRefEffect } from '@wordpress/compose';\nimport { useSelect } from '@wordpress/data';\nimport { memo, useMemo } from '@wordpress/element';\nimport { Disabled } from '@wordpress/components';\n\n/**\n * Internal dependencies\n */\nimport BlockList from '../block-list';\nimport Iframe from '../iframe';\nimport EditorStyles from '../editor-styles';\nimport { store } from '../../store';\n\n// This is used to avoid rendering the block list if the sizes change.\nlet MemoizedBlockList;\n\nconst MAX_HEIGHT = 2000;\nconst EMPTY_ADDITIONAL_STYLES = [];\n\nfunction ScaledBlockPreview( {\n\tviewportWidth,\n\tcontainerWidth,\n\tminHeight,\n\tadditionalStyles = EMPTY_ADDITIONAL_STYLES,\n} ) {\n\tif ( ! viewportWidth ) {\n\t\tviewportWidth = containerWidth;\n\t}\n\n\tconst [ contentResizeListener, { height: contentHeight } ] =\n\t\tuseResizeObserver();\n\tconst { styles } = useSelect( ( select ) => {\n\t\tconst settings = select( store ).getSettings();\n\t\treturn {\n\t\t\tstyles: settings.styles,\n\t\t};\n\t}, [] );\n\n\t// Avoid scrollbars for pattern previews.\n\tconst editorStyles = useMemo( () => {\n\t\tif ( styles ) {\n\t\t\treturn [\n\t\t\t\t...styles,\n\t\t\t\t{\n\t\t\t\t\tcss: 'body{height:auto;overflow:hidden;border:none;padding:0;}',\n\t\t\t\t\t__unstableType: 'presets',\n\t\t\t\t},\n\t\t\t\t...additionalStyles,\n\t\t\t];\n\t\t}\n\n\t\treturn styles;\n\t}, [ styles, additionalStyles ] );\n\n\t// Initialize on render instead of module top level, to avoid circular dependency issues.\n\tMemoizedBlockList = MemoizedBlockList || memo( BlockList );\n\n\tconst scale = containerWidth / viewportWidth;\n\tconst aspectRatio = contentHeight\n\t\t? containerWidth / ( contentHeight * scale )\n\t\t: 0;\n\treturn (\n\t\t<Disabled\n\t\t\tclassName=\"block-editor-block-preview__content\"\n\t\t\tstyle={ {\n\t\t\t\ttransform: `scale(${ scale })`,\n\t\t\t\t// Using width + aspect-ratio instead of height here triggers browsers' native\n\t\t\t\t// handling of scrollbar's visibility. It prevents the flickering issue seen\n\t\t\t\t// in https://github.com/WordPress/gutenberg/issues/52027.\n\t\t\t\t// See https://github.com/WordPress/gutenberg/pull/52921 for more info.\n\t\t\t\taspectRatio,\n\t\t\t\tmaxHeight:\n\t\t\t\t\tcontentHeight > MAX_HEIGHT ? MAX_HEIGHT * scale : undefined,\n\t\t\t\tminHeight,\n\t\t\t} }\n\t\t>\n\t\t\t<Iframe\n\t\t\t\tcontentRef={ useRefEffect( ( bodyElement ) => {\n\t\t\t\t\tconst {\n\t\t\t\t\t\townerDocument: { documentElement },\n\t\t\t\t\t} = bodyElement;\n\t\t\t\t\tdocumentElement.classList.add(\n\t\t\t\t\t\t'block-editor-block-preview__content-iframe'\n\t\t\t\t\t);\n\t\t\t\t\tdocumentElement.style.position = 'absolute';\n\t\t\t\t\tdocumentElement.style.width = '100%';\n\n\t\t\t\t\t// Necessary for contentResizeListener to work.\n\t\t\t\t\tbodyElement.style.boxSizing = 'border-box';\n\t\t\t\t\tbodyElement.style.position = 'absolute';\n\t\t\t\t\tbodyElement.style.width = '100%';\n\t\t\t\t}, [] ) }\n\t\t\t\taria-hidden\n\t\t\t\ttabIndex={ -1 }\n\t\t\t\tstyle={ {\n\t\t\t\t\tposition: 'absolute',\n\t\t\t\t\twidth: viewportWidth,\n\t\t\t\t\theight: contentHeight,\n\t\t\t\t\tpointerEvents: 'none',\n\t\t\t\t\t// This is a catch-all max-height for patterns.\n\t\t\t\t\t// See: https://github.com/WordPress/gutenberg/pull/38175.\n\t\t\t\t\tmaxHeight: MAX_HEIGHT,\n\t\t\t\t\tminHeight:\n\t\t\t\t\t\tscale !== 0 && scale < 1 && minHeight\n\t\t\t\t\t\t\t? minHeight / scale\n\t\t\t\t\t\t\t: minHeight,\n\t\t\t\t} }\n\t\t\t>\n\t\t\t\t<EditorStyles styles={ editorStyles } />\n\t\t\t\t{ contentResizeListener }\n\t\t\t\t<MemoizedBlockList renderAppender={ false } />\n\t\t\t</Iframe>\n\t\t</Disabled>\n\t);\n}\n\nexport default function AutoBlockPreview( props ) {\n\tconst [ containerResizeListener, { width: containerWidth } ] =\n\t\tuseResizeObserver();\n\n\treturn (\n\t\t<>\n\t\t\t<div style={ { position: 'relative', width: '100%', height: 0 } }>\n\t\t\t\t{ containerResizeListener }\n\t\t\t</div>\n\t\t\t<div className=\"block-editor-block-preview__container\">\n\t\t\t\t{ !! containerWidth && (\n\t\t\t\t\t<ScaledBlockPreview\n\t\t\t\t\t\t{ ...props }\n\t\t\t\t\t\tcontainerWidth={ containerWidth }\n\t\t\t\t\t/>\n\t\t\t\t) }\n\t\t\t</div>\n\t\t</>\n\t);\n}\n"],"mappings":"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"}