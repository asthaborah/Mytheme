{"version":3,"names":["_url","require","_element","_data","_isUrlLike","_interopRequireDefault","_constants","_store","handleNoop","Promise","resolve","exports","handleDirectEntry","val","type","URL_TYPE","protocol","getProtocol","includes","MAILTO_TYPE","TEL_TYPE","startsWith","INTERNAL_TYPE","id","title","url","prependHTTP","handleEntitySearch","suggestionsQuery","fetchSearchSuggestions","withCreateSuggestion","pageOnFront","pageForPosts","isInitialSuggestions","results","map","result","Number","isFrontPage","isBlogHome","isURLLike","concat","CREATE_TYPE","useSearchHandler","allowDirectEntry","useSelect","select","getSettings","blockEditorStore","__experimentalFetchLinkSuggestions","directEntryHandler","useCallback"],"sources":["@wordpress/block-editor/src/components/link-control/use-search-handler.js"],"sourcesContent":["/**\n * WordPress dependencies\n */\nimport { getProtocol, prependHTTP } from '@wordpress/url';\nimport { useCallback } from '@wordpress/element';\nimport { useSelect } from '@wordpress/data';\n\n/**\n * Internal dependencies\n */\nimport isURLLike from './is-url-like';\nimport {\n\tCREATE_TYPE,\n\tTEL_TYPE,\n\tMAILTO_TYPE,\n\tINTERNAL_TYPE,\n\tURL_TYPE,\n} from './constants';\nimport { store as blockEditorStore } from '../../store';\n\nexport const handleNoop = () => Promise.resolve( [] );\n\nexport const handleDirectEntry = ( val ) => {\n\tlet type = URL_TYPE;\n\n\tconst protocol = getProtocol( val ) || '';\n\n\tif ( protocol.includes( 'mailto' ) ) {\n\t\ttype = MAILTO_TYPE;\n\t}\n\n\tif ( protocol.includes( 'tel' ) ) {\n\t\ttype = TEL_TYPE;\n\t}\n\n\tif ( val?.startsWith( '#' ) ) {\n\t\ttype = INTERNAL_TYPE;\n\t}\n\n\treturn Promise.resolve( [\n\t\t{\n\t\t\tid: val,\n\t\t\ttitle: val,\n\t\t\turl: type === 'URL' ? prependHTTP( val ) : val,\n\t\t\ttype,\n\t\t},\n\t] );\n};\n\nconst handleEntitySearch = async (\n\tval,\n\tsuggestionsQuery,\n\tfetchSearchSuggestions,\n\twithCreateSuggestion,\n\tpageOnFront,\n\tpageForPosts\n) => {\n\tconst { isInitialSuggestions } = suggestionsQuery;\n\n\tconst results = await fetchSearchSuggestions( val, suggestionsQuery );\n\n\t// Identify front page and update type to match.\n\tresults.map( ( result ) => {\n\t\tif ( Number( result.id ) === pageOnFront ) {\n\t\t\tresult.isFrontPage = true;\n\t\t\treturn result;\n\t\t} else if ( Number( result.id ) === pageForPosts ) {\n\t\t\tresult.isBlogHome = true;\n\t\t\treturn result;\n\t\t}\n\n\t\treturn result;\n\t} );\n\n\t// If displaying initial suggestions just return plain results.\n\tif ( isInitialSuggestions ) {\n\t\treturn results;\n\t}\n\n\t// Here we append a faux suggestion to represent a \"CREATE\" option. This\n\t// is detected in the rendering of the search results and handled as a\n\t// special case. This is currently necessary because the suggestions\n\t// dropdown will only appear if there are valid suggestions and\n\t// therefore unless the create option is a suggestion it will not\n\t// display in scenarios where there are no results returned from the\n\t// API. In addition promoting CREATE to a first class suggestion affords\n\t// the a11y benefits afforded by `URLInput` to all suggestions (eg:\n\t// keyboard handling, ARIA roles...etc).\n\t//\n\t// Note also that the value of the `title` and `url` properties must correspond\n\t// to the text value of the `<input>`. This is because `title` is used\n\t// when creating the suggestion. Similarly `url` is used when using keyboard to select\n\t// the suggestion (the <form> `onSubmit` handler falls-back to `url`).\n\treturn isURLLike( val ) || ! withCreateSuggestion\n\t\t? results\n\t\t: results.concat( {\n\t\t\t\t// the `id` prop is intentionally ommitted here because it\n\t\t\t\t// is never exposed as part of the component's public API.\n\t\t\t\t// see: https://github.com/WordPress/gutenberg/pull/19775#discussion_r378931316.\n\t\t\t\ttitle: val, // Must match the existing `<input>`s text value.\n\t\t\t\turl: val, // Must match the existing `<input>`s text value.\n\t\t\t\ttype: CREATE_TYPE,\n\t\t  } );\n};\n\nexport default function useSearchHandler(\n\tsuggestionsQuery,\n\tallowDirectEntry,\n\twithCreateSuggestion\n) {\n\tconst { fetchSearchSuggestions, pageOnFront, pageForPosts } = useSelect(\n\t\t( select ) => {\n\t\t\tconst { getSettings } = select( blockEditorStore );\n\n\t\t\treturn {\n\t\t\t\tpageOnFront: getSettings().pageOnFront,\n\t\t\t\tpageForPosts: getSettings().pageForPosts,\n\t\t\t\tfetchSearchSuggestions:\n\t\t\t\t\tgetSettings().__experimentalFetchLinkSuggestions,\n\t\t\t};\n\t\t},\n\t\t[]\n\t);\n\n\tconst directEntryHandler = allowDirectEntry\n\t\t? handleDirectEntry\n\t\t: handleNoop;\n\n\treturn useCallback(\n\t\t( val, { isInitialSuggestions } ) => {\n\t\t\treturn isURLLike( val )\n\t\t\t\t? directEntryHandler( val, { isInitialSuggestions } )\n\t\t\t\t: handleEntitySearch(\n\t\t\t\t\t\tval,\n\t\t\t\t\t\t{ ...suggestionsQuery, isInitialSuggestions },\n\t\t\t\t\t\tfetchSearchSuggestions,\n\t\t\t\t\t\twithCreateSuggestion,\n\t\t\t\t\t\tpageOnFront,\n\t\t\t\t\t\tpageForPosts\n\t\t\t\t  );\n\t\t},\n\t\t[\n\t\t\tdirectEntryHandler,\n\t\t\tfetchSearchSuggestions,\n\t\t\tpageOnFront,\n\t\t\tpageForPosts,\n\t\t\tsuggestionsQuery,\n\t\t\twithCreateSuggestion,\n\t\t]\n\t);\n}\n"],"mappings":"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"}