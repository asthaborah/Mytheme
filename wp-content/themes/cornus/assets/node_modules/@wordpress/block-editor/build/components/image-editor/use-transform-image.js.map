{"version":3,"names":["_element","require","_hooks","useTransformImage","url","naturalWidth","naturalHeight","editedUrl","setEditedUrl","useState","crop","setCrop","position","setPosition","x","y","zoom","setZoom","rotation","setRotation","defaultAspect","aspect","setAspect","rotateClockwise","useCallback","angle","naturalAspectRatio","prevPosition","editImage","event","canvas","document","createElement","translateX","translateY","width","target","height","context","getContext","translate","rotate","Math","PI","drawImage","toBlob","blob","URL","createObjectURL","el","window","Image","src","onload","imgCrossOrigin","applyFilters","undefined","crossOrigin","useMemo"],"sources":["@wordpress/block-editor/src/components/image-editor/use-transform-image.js"],"sourcesContent":["/**\n * WordPress dependencies\n */\nimport { useCallback, useMemo, useState } from '@wordpress/element';\nimport { applyFilters } from '@wordpress/hooks';\n\nexport default function useTransformImage( {\n\turl,\n\tnaturalWidth,\n\tnaturalHeight,\n} ) {\n\tconst [ editedUrl, setEditedUrl ] = useState();\n\tconst [ crop, setCrop ] = useState();\n\tconst [ position, setPosition ] = useState( { x: 0, y: 0 } );\n\tconst [ zoom, setZoom ] = useState( 100 );\n\tconst [ rotation, setRotation ] = useState( 0 );\n\tconst defaultAspect = naturalWidth / naturalHeight;\n\tconst [ aspect, setAspect ] = useState( defaultAspect );\n\n\tconst rotateClockwise = useCallback( () => {\n\t\tconst angle = ( rotation + 90 ) % 360;\n\n\t\tlet naturalAspectRatio = defaultAspect;\n\n\t\tif ( rotation % 180 === 90 ) {\n\t\t\tnaturalAspectRatio = 1 / defaultAspect;\n\t\t}\n\n\t\tif ( angle === 0 ) {\n\t\t\tsetEditedUrl();\n\t\t\tsetRotation( angle );\n\t\t\tsetAspect( defaultAspect );\n\t\t\tsetPosition( ( prevPosition ) => ( {\n\t\t\t\tx: -( prevPosition.y * naturalAspectRatio ),\n\t\t\t\ty: prevPosition.x * naturalAspectRatio,\n\t\t\t} ) );\n\t\t\treturn;\n\t\t}\n\n\t\tfunction editImage( event ) {\n\t\t\tconst canvas = document.createElement( 'canvas' );\n\n\t\t\tlet translateX = 0;\n\t\t\tlet translateY = 0;\n\n\t\t\tif ( angle % 180 ) {\n\t\t\t\tcanvas.width = event.target.height;\n\t\t\t\tcanvas.height = event.target.width;\n\t\t\t} else {\n\t\t\t\tcanvas.width = event.target.width;\n\t\t\t\tcanvas.height = event.target.height;\n\t\t\t}\n\n\t\t\tif ( angle === 90 || angle === 180 ) {\n\t\t\t\ttranslateX = canvas.width;\n\t\t\t}\n\n\t\t\tif ( angle === 270 || angle === 180 ) {\n\t\t\t\ttranslateY = canvas.height;\n\t\t\t}\n\n\t\t\tconst context = canvas.getContext( '2d' );\n\n\t\t\tcontext.translate( translateX, translateY );\n\t\t\tcontext.rotate( ( angle * Math.PI ) / 180 );\n\t\t\tcontext.drawImage( event.target, 0, 0 );\n\n\t\t\tcanvas.toBlob( ( blob ) => {\n\t\t\t\tsetEditedUrl( URL.createObjectURL( blob ) );\n\t\t\t\tsetRotation( angle );\n\t\t\t\tsetAspect( canvas.width / canvas.height );\n\t\t\t\tsetPosition( ( prevPosition ) => ( {\n\t\t\t\t\tx: -( prevPosition.y * naturalAspectRatio ),\n\t\t\t\t\ty: prevPosition.x * naturalAspectRatio,\n\t\t\t\t} ) );\n\t\t\t} );\n\t\t}\n\n\t\tconst el = new window.Image();\n\t\tel.src = url;\n\t\tel.onload = editImage;\n\n\t\tconst imgCrossOrigin = applyFilters(\n\t\t\t'media.crossOrigin',\n\t\t\tundefined,\n\t\t\turl\n\t\t);\n\t\tif ( typeof imgCrossOrigin === 'string' ) {\n\t\t\tel.crossOrigin = imgCrossOrigin;\n\t\t}\n\t}, [ rotation, defaultAspect, url ] );\n\n\treturn useMemo(\n\t\t() => ( {\n\t\t\teditedUrl,\n\t\t\tsetEditedUrl,\n\t\t\tcrop,\n\t\t\tsetCrop,\n\t\t\tposition,\n\t\t\tsetPosition,\n\t\t\tzoom,\n\t\t\tsetZoom,\n\t\t\trotation,\n\t\t\tsetRotation,\n\t\t\trotateClockwise,\n\t\t\taspect,\n\t\t\tsetAspect,\n\t\t\tdefaultAspect,\n\t\t} ),\n\t\t[\n\t\t\teditedUrl,\n\t\t\tcrop,\n\t\t\tposition,\n\t\t\tzoom,\n\t\t\trotation,\n\t\t\trotateClockwise,\n\t\t\taspect,\n\t\t\tdefaultAspect,\n\t\t]\n\t);\n}\n"],"mappings":"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"}