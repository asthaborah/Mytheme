{"version":3,"names":["useSelect","useEffect","useState","useMemo","useCallback","__","useGlobalStyles","store","blockEditorStore","PanelColorGradientSettings","useColorsPerOrigin","useGradientsPerOrigin","getValueFromVariable","setImmutably","ContrastChecker","InspectorControls","useHasColorPanel","useHasTextPanel","useHasBackgroundPanel","ColorPanel","value","inheritedValue","onChange","settings","colors","gradients","globalStyles","detectedBackgroundColor","setDetectedBackgroundColor","detectedTextColor","setDetectedTextColor","baseGlobalStyles","select","getSettings","__experimentalGlobalStylesBaseStyles","color","decodeValue","rawValue","encodeColorValue","colorValue","allColors","flatMap","originColors","colorObject","find","slug","encodeGradientValue","gradientValue","allGradients","originGradients","gradientObject","gradient","showTextPanel","textColor","text","setTextColor","newColor","resetTextColor","undefined","showBackgroundPanel","backgroundColor","background","setBackgroundColor","newValue","setGradient","newGradient","resetBackground","currentGradients","withoutGradientsSupport","Array","isArray","length","items","label","onColorChange","onColorCleared","onGradientChange","filter","Boolean","currentDetectedTextColor","currentDetectedBackgroundColor","createElement","title","initialOpen"],"sources":["@wordpress/block-editor/src/components/global-styles/color-panel.native.js"],"sourcesContent":["/**\n * WordPress dependencies\n */\nimport { useSelect } from '@wordpress/data';\nimport { useEffect, useState, useMemo, useCallback } from '@wordpress/element';\nimport { __ } from '@wordpress/i18n';\nimport { useGlobalStyles } from '@wordpress/components';\nimport { store as blockEditorStore } from '@wordpress/block-editor';\n\n/**\n * Internal dependencies\n */\nimport PanelColorGradientSettings from '../colors-gradients/panel-color-gradient-settings';\nimport { useColorsPerOrigin, useGradientsPerOrigin } from './hooks';\nimport { getValueFromVariable } from './utils';\nimport { setImmutably } from '../../utils/object';\nimport ContrastChecker from '../contrast-checker';\nimport InspectorControls from '../inspector-controls';\nimport {\n\tuseHasColorPanel,\n\tuseHasTextPanel,\n\tuseHasBackgroundPanel,\n} from './color-panel.js';\n\nconst ColorPanel = ( {\n\tvalue,\n\tinheritedValue = value,\n\tonChange,\n\tsettings,\n} ) => {\n\tconst colors = useColorsPerOrigin( settings );\n\tconst gradients = useGradientsPerOrigin( settings );\n\tconst globalStyles = useGlobalStyles();\n\n\tconst [ detectedBackgroundColor, setDetectedBackgroundColor ] = useState();\n\tconst [ detectedTextColor, setDetectedTextColor ] = useState();\n\n\tconst { baseGlobalStyles } = useSelect( ( select ) => {\n\t\tconst { getSettings } = select( blockEditorStore );\n\t\treturn {\n\t\t\tbaseGlobalStyles:\n\t\t\t\tgetSettings()?.__experimentalGlobalStylesBaseStyles?.color,\n\t\t};\n\t} );\n\n\tconst decodeValue = ( rawValue ) =>\n\t\tgetValueFromVariable( { settings }, '', rawValue );\n\tconst encodeColorValue = useCallback(\n\t\t( colorValue ) => {\n\t\t\tconst allColors = colors.flatMap(\n\t\t\t\t( { colors: originColors } ) => originColors\n\t\t\t);\n\t\t\tconst colorObject = allColors.find(\n\t\t\t\t( { color } ) => color === colorValue\n\t\t\t);\n\t\t\treturn colorObject\n\t\t\t\t? 'var:preset|color|' + colorObject.slug\n\t\t\t\t: colorValue;\n\t\t},\n\t\t[ colors ]\n\t);\n\tconst encodeGradientValue = useCallback(\n\t\t( gradientValue ) => {\n\t\t\tconst allGradients = gradients.flatMap(\n\t\t\t\t( { gradients: originGradients } ) => originGradients\n\t\t\t);\n\t\t\tconst gradientObject = allGradients.find(\n\t\t\t\t( { gradient } ) => gradient === gradientValue\n\t\t\t);\n\t\t\treturn gradientObject\n\t\t\t\t? 'var:preset|gradient|' + gradientObject.slug\n\t\t\t\t: gradientValue;\n\t\t},\n\t\t[ gradients ]\n\t);\n\n\t// Text Color\n\tconst showTextPanel = useHasTextPanel( settings );\n\tconst textColor = decodeValue( inheritedValue?.color?.text );\n\tconst setTextColor = useCallback(\n\t\t( newColor ) => {\n\t\t\tonChange(\n\t\t\t\tsetImmutably(\n\t\t\t\t\tvalue,\n\t\t\t\t\t[ 'color', 'text' ],\n\t\t\t\t\tencodeColorValue( newColor )\n\t\t\t\t)\n\t\t\t);\n\t\t},\n\t\t[ encodeColorValue, onChange, value ]\n\t);\n\tconst resetTextColor = useCallback(\n\t\t() => setTextColor( undefined ),\n\t\t[ setTextColor ]\n\t);\n\n\t// BackgroundColor\n\tconst showBackgroundPanel = useHasBackgroundPanel( settings );\n\tconst backgroundColor = decodeValue( inheritedValue?.color?.background );\n\tconst gradient = decodeValue( inheritedValue?.color?.gradient );\n\tconst setBackgroundColor = useCallback(\n\t\t( newColor ) => {\n\t\t\tconst newValue = setImmutably(\n\t\t\t\tvalue,\n\t\t\t\t[ 'color', 'background' ],\n\t\t\t\tencodeColorValue( newColor )\n\t\t\t);\n\t\t\tnewValue.color.gradient = undefined;\n\t\t\tonChange( newValue );\n\t\t},\n\t\t[ encodeColorValue, onChange, value ]\n\t);\n\tconst setGradient = useCallback(\n\t\t( newGradient ) => {\n\t\t\tconst newValue = setImmutably(\n\t\t\t\tvalue,\n\t\t\t\t[ 'color', 'gradient' ],\n\t\t\t\tencodeGradientValue( newGradient )\n\t\t\t);\n\t\t\tnewValue.color.background = undefined;\n\t\t\tonChange( newValue );\n\t\t},\n\t\t[ encodeGradientValue, onChange, value ]\n\t);\n\tconst resetBackground = useCallback( () => {\n\t\tconst newValue = setImmutably(\n\t\t\tvalue,\n\t\t\t[ 'color', 'background' ],\n\t\t\tundefined\n\t\t);\n\t\tnewValue.color.gradient = undefined;\n\t\tonChange( newValue );\n\t}, [ onChange, value ] );\n\tconst currentGradients = settings?.color?.gradients;\n\tconst withoutGradientsSupport =\n\t\tArray.isArray( currentGradients ) && currentGradients.length === 0;\n\n\tconst items = useMemo(\n\t\t() =>\n\t\t\t[\n\t\t\t\tshowTextPanel && {\n\t\t\t\t\tlabel: __( 'Text' ),\n\t\t\t\t\tcolorValue: textColor,\n\t\t\t\t\tonColorChange: setTextColor,\n\t\t\t\t\tonColorCleared: resetTextColor,\n\t\t\t\t},\n\t\t\t\tshowBackgroundPanel && {\n\t\t\t\t\tlabel: __( 'Background' ),\n\t\t\t\t\tcolorValue: backgroundColor,\n\t\t\t\t\tonColorChange: setBackgroundColor,\n\t\t\t\t\tonColorCleared: resetBackground,\n\t\t\t\t\tonGradientChange: ! withoutGradientsSupport\n\t\t\t\t\t\t? setGradient\n\t\t\t\t\t\t: undefined,\n\t\t\t\t\tgradientValue: gradient,\n\t\t\t\t},\n\t\t\t].filter( Boolean ),\n\t\t[\n\t\t\tbackgroundColor,\n\t\t\tgradient,\n\t\t\tresetBackground,\n\t\t\tresetTextColor,\n\t\t\tsetBackgroundColor,\n\t\t\tsetGradient,\n\t\t\tsetTextColor,\n\t\t\tshowBackgroundPanel,\n\t\t\tshowTextPanel,\n\t\t\ttextColor,\n\t\t\twithoutGradientsSupport,\n\t\t]\n\t);\n\n\tuseEffect( () => {\n\t\t// The following logic is used to determine current text/background colors:\n\t\t// 1. The globalStyles object is queried to determine whether a color has been\n\t\t// set via a block's settings.\n\t\t// 2. If a block-based theme is in use and no globalStyles exist, the theme's\n\t\t// default/base colors are used.\n\t\t// 3. If no globalStyles exist and a theme isn't block-based, there is no way\n\t\t// to determine the default text/background color and the checker won't run.\n\t\tconst currentDetectedTextColor =\n\t\t\tglobalStyles?.color || baseGlobalStyles?.text;\n\t\tconst currentDetectedBackgroundColor =\n\t\t\tglobalStyles?.backgroundColor || baseGlobalStyles?.background;\n\n\t\tsetDetectedTextColor( currentDetectedTextColor );\n\t\tsetDetectedBackgroundColor( currentDetectedBackgroundColor );\n\t}, [ globalStyles, baseGlobalStyles ] );\n\n\treturn (\n\t\t<InspectorControls>\n\t\t\t<PanelColorGradientSettings\n\t\t\t\ttitle={ __( 'Color' ) }\n\t\t\t\tinitialOpen={ false }\n\t\t\t\tsettings={ items }\n\t\t\t>\n\t\t\t\t<ContrastChecker\n\t\t\t\t\tbackgroundColor={ detectedBackgroundColor }\n\t\t\t\t\ttextColor={ detectedTextColor }\n\t\t\t\t/>\n\t\t\t</PanelColorGradientSettings>\n\t\t</InspectorControls>\n\t);\n};\n\nexport { useHasColorPanel };\nexport default ColorPanel;\n"],"mappings":"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"}