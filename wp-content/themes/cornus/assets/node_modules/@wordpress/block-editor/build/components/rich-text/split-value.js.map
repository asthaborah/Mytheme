{"version":3,"names":["_richText","require","splitValue","value","pastedBlocks","onReplace","onSplit","start","end","valueWithEnsuredSelection","blocks","before","after","split","hasPastedBlocks","length","lastPastedBlockIndex","isAfterOriginal","isEmpty","push","toHTMLString","indexToSelect","initialPosition"],"sources":["@wordpress/block-editor/src/components/rich-text/split-value.js"],"sourcesContent":["/**\n * WordPress dependencies\n */\nimport { isEmpty, split, toHTMLString } from '@wordpress/rich-text';\n\n/*\n * Signals to the RichText owner that the block can be replaced with two blocks\n * as a result of splitting the block by pressing enter, or with blocks as a\n * result of splitting the block by pasting block content in the instance.\n */\nexport function splitValue( { value, pastedBlocks = [], onReplace, onSplit } ) {\n\tif ( ! onReplace || ! onSplit ) {\n\t\treturn;\n\t}\n\n\t// Ensure the value has a selection. This might happen when trying to split\n\t// an empty value before there was a `selectionchange` event.\n\tconst { start = 0, end = 0 } = value;\n\tconst valueWithEnsuredSelection = { ...value, start, end };\n\tconst blocks = [];\n\tconst [ before, after ] = split( valueWithEnsuredSelection );\n\tconst hasPastedBlocks = pastedBlocks.length > 0;\n\tlet lastPastedBlockIndex = -1;\n\n\t// Consider the after value to be the original it is not empty and the\n\t// before value *is* empty.\n\tconst isAfterOriginal = isEmpty( before ) && ! isEmpty( after );\n\n\t// Create a block with the content before the caret if there's no pasted\n\t// blocks, or if there are pasted blocks and the value is not empty. We do\n\t// not want a leading empty block on paste, but we do if we split with e.g.\n\t// the enter key.\n\tif ( ! hasPastedBlocks || ! isEmpty( before ) ) {\n\t\tblocks.push(\n\t\t\tonSplit( toHTMLString( { value: before } ), ! isAfterOriginal )\n\t\t);\n\t\tlastPastedBlockIndex += 1;\n\t}\n\n\tif ( hasPastedBlocks ) {\n\t\tblocks.push( ...pastedBlocks );\n\t\tlastPastedBlockIndex += pastedBlocks.length;\n\t}\n\n\t// Create a block with the content after the caret if there's no pasted\n\t// blocks, or if there are pasted blocks and the value is not empty. We do\n\t// not want a trailing empty block on paste, but we do if we split with e.g.\n\t// the enter key.\n\tif ( ! hasPastedBlocks || ! isEmpty( after ) ) {\n\t\tblocks.push(\n\t\t\tonSplit( toHTMLString( { value: after } ), isAfterOriginal )\n\t\t);\n\t}\n\n\t// If there are pasted blocks, set the selection to the last one. Otherwise,\n\t// set the selection to the second block.\n\tconst indexToSelect = hasPastedBlocks ? lastPastedBlockIndex : 1;\n\n\t// If there are pasted blocks, move the caret to the end of the selected\n\t// block Otherwise, retain the default value.\n\tconst initialPosition = hasPastedBlocks ? -1 : 0;\n\n\tonReplace( blocks, indexToSelect, initialPosition );\n}\n"],"mappings":";;;;;;AAGA,IAAAA,SAAA,GAAAC,OAAA;AAHA;AACA;AACA;;AAGA;AACA;AACA;AACA;AACA;AACO,SAASC,UAAUA,CAAE;EAAEC,KAAK;EAAEC,YAAY,GAAG,EAAE;EAAEC,SAAS;EAAEC;AAAQ,CAAC,EAAG;EAC9E,IAAK,CAAED,SAAS,IAAI,CAAEC,OAAO,EAAG;IAC/B;EACD;;EAEA;EACA;EACA,MAAM;IAAEC,KAAK,GAAG,CAAC;IAAEC,GAAG,GAAG;EAAE,CAAC,GAAGL,KAAK;EACpC,MAAMM,yBAAyB,GAAG;IAAE,GAAGN,KAAK;IAAEI,KAAK;IAAEC;EAAI,CAAC;EAC1D,MAAME,MAAM,GAAG,EAAE;EACjB,MAAM,CAAEC,MAAM,EAAEC,KAAK,CAAE,GAAG,IAAAC,eAAK,EAAEJ,yBAA0B,CAAC;EAC5D,MAAMK,eAAe,GAAGV,YAAY,CAACW,MAAM,GAAG,CAAC;EAC/C,IAAIC,oBAAoB,GAAG,CAAC,CAAC;;EAE7B;EACA;EACA,MAAMC,eAAe,GAAG,IAAAC,iBAAO,EAAEP,MAAO,CAAC,IAAI,CAAE,IAAAO,iBAAO,EAAEN,KAAM,CAAC;;EAE/D;EACA;EACA;EACA;EACA,IAAK,CAAEE,eAAe,IAAI,CAAE,IAAAI,iBAAO,EAAEP,MAAO,CAAC,EAAG;IAC/CD,MAAM,CAACS,IAAI,CACVb,OAAO,CAAE,IAAAc,sBAAY,EAAE;MAAEjB,KAAK,EAAEQ;IAAO,CAAE,CAAC,EAAE,CAAEM,eAAgB,CAC/D,CAAC;IACDD,oBAAoB,IAAI,CAAC;EAC1B;EAEA,IAAKF,eAAe,EAAG;IACtBJ,MAAM,CAACS,IAAI,CAAE,GAAGf,YAAa,CAAC;IAC9BY,oBAAoB,IAAIZ,YAAY,CAACW,MAAM;EAC5C;;EAEA;EACA;EACA;EACA;EACA,IAAK,CAAED,eAAe,IAAI,CAAE,IAAAI,iBAAO,EAAEN,KAAM,CAAC,EAAG;IAC9CF,MAAM,CAACS,IAAI,CACVb,OAAO,CAAE,IAAAc,sBAAY,EAAE;MAAEjB,KAAK,EAAES;IAAM,CAAE,CAAC,EAAEK,eAAgB,CAC5D,CAAC;EACF;;EAEA;EACA;EACA,MAAMI,aAAa,GAAGP,eAAe,GAAGE,oBAAoB,GAAG,CAAC;;EAEhE;EACA;EACA,MAAMM,eAAe,GAAGR,eAAe,GAAG,CAAC,CAAC,GAAG,CAAC;EAEhDT,SAAS,CAAEK,MAAM,EAAEW,aAAa,EAAEC,eAAgB,CAAC;AACpD"}