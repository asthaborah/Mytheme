{"version":3,"names":["__","useEffect","useState","useRef","useCreatePage","handleCreatePage","cancelableCreateSuggestion","isCreatingPage","setIsCreatingPage","errorMessage","setErrorMessage","createPage","suggestionTitle","current","makeCancelable","Promise","resolve","promise","error","isCanceled","message","cancel","hasCanceled_","wrappedPromise","reject","then","val"],"sources":["@wordpress/block-editor/src/components/link-control/use-create-page.js"],"sourcesContent":["/**\n * WordPress dependencies\n */\nimport { __ } from '@wordpress/i18n';\nimport { useEffect, useState, useRef } from '@wordpress/element';\n\nexport default function useCreatePage( handleCreatePage ) {\n\tconst cancelableCreateSuggestion = useRef();\n\tconst [ isCreatingPage, setIsCreatingPage ] = useState( false );\n\tconst [ errorMessage, setErrorMessage ] = useState( null );\n\n\tconst createPage = async function ( suggestionTitle ) {\n\t\tsetIsCreatingPage( true );\n\t\tsetErrorMessage( null );\n\n\t\ttry {\n\t\t\t// Make cancellable in order that we can avoid setting State\n\t\t\t// if the component unmounts during the call to `createSuggestion`\n\t\t\tcancelableCreateSuggestion.current = makeCancelable(\n\t\t\t\t// Using Promise.resolve to allow createSuggestion to return a\n\t\t\t\t// non-Promise based value.\n\t\t\t\tPromise.resolve( handleCreatePage( suggestionTitle ) )\n\t\t\t);\n\n\t\t\treturn await cancelableCreateSuggestion.current.promise;\n\t\t} catch ( error ) {\n\t\t\tif ( error && error.isCanceled ) {\n\t\t\t\treturn; // bail if canceled to avoid setting state\n\t\t\t}\n\n\t\t\tsetErrorMessage(\n\t\t\t\terror.message ||\n\t\t\t\t\t__(\n\t\t\t\t\t\t'An unknown error occurred during creation. Please try again.'\n\t\t\t\t\t)\n\t\t\t);\n\t\t\tthrow error;\n\t\t} finally {\n\t\t\tsetIsCreatingPage( false );\n\t\t}\n\t};\n\n\t/**\n\t * Handles cancelling any pending Promises that have been made cancelable.\n\t */\n\tuseEffect( () => {\n\t\treturn () => {\n\t\t\t// componentDidUnmount\n\t\t\tif ( cancelableCreateSuggestion.current ) {\n\t\t\t\tcancelableCreateSuggestion.current.cancel();\n\t\t\t}\n\t\t};\n\t}, [] );\n\n\treturn {\n\t\tcreatePage,\n\t\tisCreatingPage,\n\t\terrorMessage,\n\t};\n}\n\n/**\n * Creates a wrapper around a promise which allows it to be programmatically\n * cancelled.\n * See: https://reactjs.org/blog/2015/12/16/ismounted-antipattern.html\n *\n * @param {Promise} promise the Promise to make cancelable\n */\nconst makeCancelable = ( promise ) => {\n\tlet hasCanceled_ = false;\n\n\tconst wrappedPromise = new Promise( ( resolve, reject ) => {\n\t\tpromise.then(\n\t\t\t( val ) =>\n\t\t\t\thasCanceled_ ? reject( { isCanceled: true } ) : resolve( val ),\n\t\t\t( error ) =>\n\t\t\t\thasCanceled_ ? reject( { isCanceled: true } ) : reject( error )\n\t\t);\n\t} );\n\n\treturn {\n\t\tpromise: wrappedPromise,\n\t\tcancel() {\n\t\t\thasCanceled_ = true;\n\t\t},\n\t};\n};\n"],"mappings":"AAAA;AACA;AACA;AACA,SAASA,EAAE,QAAQ,iBAAiB;AACpC,SAASC,SAAS,EAAEC,QAAQ,EAAEC,MAAM,QAAQ,oBAAoB;AAEhE,eAAe,SAASC,aAAaA,CAAEC,gBAAgB,EAAG;EACzD,MAAMC,0BAA0B,GAAGH,MAAM,CAAC,CAAC;EAC3C,MAAM,CAAEI,cAAc,EAAEC,iBAAiB,CAAE,GAAGN,QAAQ,CAAE,KAAM,CAAC;EAC/D,MAAM,CAAEO,YAAY,EAAEC,eAAe,CAAE,GAAGR,QAAQ,CAAE,IAAK,CAAC;EAE1D,MAAMS,UAAU,GAAG,eAAAA,CAAiBC,eAAe,EAAG;IACrDJ,iBAAiB,CAAE,IAAK,CAAC;IACzBE,eAAe,CAAE,IAAK,CAAC;IAEvB,IAAI;MACH;MACA;MACAJ,0BAA0B,CAACO,OAAO,GAAGC,cAAc;MAClD;MACA;MACAC,OAAO,CAACC,OAAO,CAAEX,gBAAgB,CAAEO,eAAgB,CAAE,CACtD,CAAC;MAED,OAAO,MAAMN,0BAA0B,CAACO,OAAO,CAACI,OAAO;IACxD,CAAC,CAAC,OAAQC,KAAK,EAAG;MACjB,IAAKA,KAAK,IAAIA,KAAK,CAACC,UAAU,EAAG;QAChC,OAAO,CAAC;MACT;MAEAT,eAAe,CACdQ,KAAK,CAACE,OAAO,IACZpB,EAAE,CACD,8DACD,CACF,CAAC;MACD,MAAMkB,KAAK;IACZ,CAAC,SAAS;MACTV,iBAAiB,CAAE,KAAM,CAAC;IAC3B;EACD,CAAC;;EAED;AACD;AACA;EACCP,SAAS,CAAE,MAAM;IAChB,OAAO,MAAM;MACZ;MACA,IAAKK,0BAA0B,CAACO,OAAO,EAAG;QACzCP,0BAA0B,CAACO,OAAO,CAACQ,MAAM,CAAC,CAAC;MAC5C;IACD,CAAC;EACF,CAAC,EAAE,EAAG,CAAC;EAEP,OAAO;IACNV,UAAU;IACVJ,cAAc;IACdE;EACD,CAAC;AACF;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAMK,cAAc,GAAKG,OAAO,IAAM;EACrC,IAAIK,YAAY,GAAG,KAAK;EAExB,MAAMC,cAAc,GAAG,IAAIR,OAAO,CAAE,CAAEC,OAAO,EAAEQ,MAAM,KAAM;IAC1DP,OAAO,CAACQ,IAAI,CACTC,GAAG,IACJJ,YAAY,GAAGE,MAAM,CAAE;MAAEL,UAAU,EAAE;IAAK,CAAE,CAAC,GAAGH,OAAO,CAAEU,GAAI,CAAC,EAC7DR,KAAK,IACNI,YAAY,GAAGE,MAAM,CAAE;MAAEL,UAAU,EAAE;IAAK,CAAE,CAAC,GAAGK,MAAM,CAAEN,KAAM,CAChE,CAAC;EACF,CAAE,CAAC;EAEH,OAAO;IACND,OAAO,EAAEM,cAAc;IACvBF,MAAMA,CAAA,EAAG;MACRC,YAAY,GAAG,IAAI;IACpB;EACD,CAAC;AACF,CAAC"}