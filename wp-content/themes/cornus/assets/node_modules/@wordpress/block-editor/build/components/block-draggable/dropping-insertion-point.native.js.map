{"version":3,"names":["_reactNativeReanimated","_interopRequireWildcard","require","_reactNativeSafeAreaContext","_data","_reactNativeBridge","_store","_blockListContext","_droppingInsertionPoint","_interopRequireDefault","_getRequireWildcardCache","e","WeakMap","r","t","__esModule","default","has","get","n","__proto__","a","Object","defineProperty","getOwnPropertyDescriptor","u","prototype","hasOwnProperty","call","i","set","DroppingInsertionPoint","scroll","currentYPosition","isDragging","targetBlockIndex","getBlockOrder","isBlockBeingDragged","isDraggingBlocks","getPreviousBlockClientId","getNextBlockClientId","useSelect","blockEditorStore","blocksLayouts","findBlockLayoutByClientId","useBlockListContext","top","bottom","useSafeAreaInsets","height","useSafeAreaFrame","safeAreaOffset","maxHeight","styles","blockYPosition","useSharedValue","opacity","useAnimatedReaction","value","getSelectedBlockIndicatorPosition","positions","currentYPositionWithScroll","offsetY","midpoint","setIndicatorPosition","index","insertionPointIndex","order","isDraggingAnyBlocks","length","previousClientId","nextClientId","previousElement","current","nextElement","previousElementPosition","y","nextElementPosition","elementsPositions","Math","floor","nextPosition","withTiming","generateHapticFeedback","previous","runOnJS","animatedStyles","useAnimatedStyle","translationY","shouldHideIndicator","transform","translateY","insertionPointStyles","_react","createElement","View","pointerEvents","style"],"sources":["@wordpress/block-editor/src/components/block-draggable/dropping-insertion-point.native.js"],"sourcesContent":["/**\n * External dependencies\n */\nimport Animated, {\n\tuseSharedValue,\n\tuseAnimatedStyle,\n\twithTiming,\n\tuseAnimatedReaction,\n\trunOnJS,\n} from 'react-native-reanimated';\nimport {\n\tuseSafeAreaInsets,\n\tuseSafeAreaFrame,\n} from 'react-native-safe-area-context';\n\n/**\n * WordPress dependencies\n */\nimport { useSelect } from '@wordpress/data';\nimport { generateHapticFeedback } from '@wordpress/react-native-bridge';\n\n/**\n * Internal dependencies\n */\nimport { store as blockEditorStore } from '../../store';\nimport { useBlockListContext } from '../block-list/block-list-context';\nimport styles from './dropping-insertion-point.scss';\n\n/**\n * Dropping zone indicator component.\n *\n * This component shows where a block can be dropped when it's being dragged.\n *\n * @param {Object}                                        props                  Component props.\n * @param {Object}                                        props.scroll           Scroll offset object.\n * @param {Object}                                        props.currentYPosition Current Y coordinate position when dragging.\n * @param {import('react-native-reanimated').SharedValue} props.isDragging       Whether or not dragging has started.\n * @param {import('react-native-reanimated').SharedValue} props.targetBlockIndex Current block target index.\n *\n * @return {JSX.Element} The component to be rendered.\n */\nexport default function DroppingInsertionPoint( {\n\tscroll,\n\tcurrentYPosition,\n\tisDragging,\n\ttargetBlockIndex,\n} ) {\n\tconst {\n\t\tgetBlockOrder,\n\t\tisBlockBeingDragged,\n\t\tisDraggingBlocks,\n\t\tgetPreviousBlockClientId,\n\t\tgetNextBlockClientId,\n\t} = useSelect( blockEditorStore );\n\n\tconst { blocksLayouts, findBlockLayoutByClientId } = useBlockListContext();\n\tconst { top, bottom } = useSafeAreaInsets();\n\tconst { height } = useSafeAreaFrame();\n\tconst safeAreaOffset = top + bottom;\n\tconst maxHeight =\n\t\theight -\n\t\t( safeAreaOffset + styles[ 'dropping-insertion-point' ].height );\n\n\tconst blockYPosition = useSharedValue( 0 );\n\tconst opacity = useSharedValue( 0 );\n\n\tuseAnimatedReaction(\n\t\t() => isDragging.value,\n\t\t( value ) => {\n\t\t\tif ( ! value ) {\n\t\t\t\topacity.value = 0;\n\t\t\t\tblockYPosition.value = 0;\n\t\t\t}\n\t\t}\n\t);\n\n\tfunction getSelectedBlockIndicatorPosition( positions ) {\n\t\tconst currentYPositionWithScroll =\n\t\t\tcurrentYPosition.value + scroll.offsetY.value;\n\t\tconst midpoint = ( positions.top + positions.bottom ) / 2;\n\n\t\treturn midpoint < currentYPositionWithScroll\n\t\t\t? positions.bottom\n\t\t\t: positions.top;\n\t}\n\n\tfunction setIndicatorPosition( index ) {\n\t\tconst insertionPointIndex = index;\n\t\tconst order = getBlockOrder();\n\t\tconst isDraggingAnyBlocks = isDraggingBlocks();\n\n\t\tif (\n\t\t\t! isDraggingAnyBlocks ||\n\t\t\tinsertionPointIndex === null ||\n\t\t\t! order.length\n\t\t) {\n\t\t\treturn;\n\t\t}\n\n\t\tlet previousClientId = order[ insertionPointIndex - 1 ];\n\t\tlet nextClientId = order[ insertionPointIndex ];\n\n\t\twhile ( isBlockBeingDragged( previousClientId ) ) {\n\t\t\tpreviousClientId = getPreviousBlockClientId( previousClientId );\n\t\t}\n\n\t\twhile ( isBlockBeingDragged( nextClientId ) ) {\n\t\t\tnextClientId = getNextBlockClientId( nextClientId );\n\t\t}\n\n\t\tconst previousElement = previousClientId\n\t\t\t? findBlockLayoutByClientId(\n\t\t\t\t\tblocksLayouts.current,\n\t\t\t\t\tpreviousClientId\n\t\t\t  )\n\t\t\t: null;\n\t\tconst nextElement = nextClientId\n\t\t\t? findBlockLayoutByClientId( blocksLayouts.current, nextClientId )\n\t\t\t: null;\n\n\t\tconst previousElementPosition = previousElement\n\t\t\t? previousElement.y + previousElement.height\n\t\t\t: 0;\n\t\tconst nextElementPosition = nextElement ? nextElement.y : 0;\n\n\t\tconst elementsPositions = {\n\t\t\ttop: Math.floor(\n\t\t\t\tpreviousElement ? previousElementPosition : nextElementPosition\n\t\t\t),\n\t\t\tbottom: Math.floor(\n\t\t\t\tnextElement ? nextElementPosition : previousElementPosition\n\t\t\t),\n\t\t};\n\n\t\tconst nextPosition =\n\t\t\telementsPositions.top !== elementsPositions.bottom\n\t\t\t\t? getSelectedBlockIndicatorPosition( elementsPositions )\n\t\t\t\t: elementsPositions.top;\n\n\t\tif ( nextPosition && blockYPosition.value !== nextPosition ) {\n\t\t\topacity.value = 0;\n\t\t\tblockYPosition.value = nextPosition;\n\t\t\topacity.value = withTiming( 1 );\n\t\t\tgenerateHapticFeedback();\n\t\t}\n\t}\n\n\tuseAnimatedReaction(\n\t\t() => targetBlockIndex.value,\n\t\t( value, previous ) => {\n\t\t\tif ( value !== previous ) {\n\t\t\t\trunOnJS( setIndicatorPosition )( value );\n\t\t\t}\n\t\t}\n\t);\n\n\tconst animatedStyles = useAnimatedStyle( () => {\n\t\tconst translationY = blockYPosition.value - scroll.offsetY.value;\n\t\t// Prevents overflowing behind the header/footer\n\t\tconst shouldHideIndicator =\n\t\t\ttranslationY < 0 || translationY > maxHeight;\n\n\t\treturn {\n\t\t\topacity: shouldHideIndicator ? 0 : opacity.value,\n\t\t\ttransform: [\n\t\t\t\t{\n\t\t\t\t\ttranslateY: translationY,\n\t\t\t\t},\n\t\t\t],\n\t\t};\n\t} );\n\n\tconst insertionPointStyles = [\n\t\tstyles[ 'dropping-insertion-point' ],\n\t\tanimatedStyles,\n\t];\n\n\treturn (\n\t\t<Animated.View pointerEvents=\"none\" style={ insertionPointStyles } />\n\t);\n}\n"],"mappings":"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"}