{"version":3,"names":["getScrollContainer","useCallback","useEffect","useRef","SCROLL_INACTIVE_DISTANCE_PX","SCROLL_INTERVAL_MS","PIXELS_PER_SECOND_PER_PERCENTAGE","VELOCITY_MULTIPLIER","useScrollWhenDragging","dragStartY","velocityY","scrollParentY","scrollEditorInterval","current","clearInterval","startScrolling","event","clientY","target","setInterval","newTop","scrollTop","scroll","top","scrollOnDragOver","scrollParentHeight","offsetHeight","offsetDragStartPosition","offsetTop","offsetDragPosition","moveableDistance","Math","max","dragDistance","distancePercentage","stopScrolling"],"sources":["@wordpress/block-editor/src/components/block-draggable/use-scroll-when-dragging.js"],"sourcesContent":["/**\n * WordPress dependencies\n */\nimport { getScrollContainer } from '@wordpress/dom';\nimport { useCallback, useEffect, useRef } from '@wordpress/element';\n\nconst SCROLL_INACTIVE_DISTANCE_PX = 50;\nconst SCROLL_INTERVAL_MS = 25;\nconst PIXELS_PER_SECOND_PER_PERCENTAGE = 1000;\nconst VELOCITY_MULTIPLIER =\n\tPIXELS_PER_SECOND_PER_PERCENTAGE * ( SCROLL_INTERVAL_MS / 1000 );\n\n/**\n * React hook that scrolls the scroll container when a block is being dragged.\n *\n * @return {Function[]} `startScrolling`, `scrollOnDragOver`, `stopScrolling`\n *                      functions to be called in `onDragStart`, `onDragOver`\n *                      and `onDragEnd` events respectively.\n */\nexport default function useScrollWhenDragging() {\n\tconst dragStartY = useRef( null );\n\tconst velocityY = useRef( null );\n\tconst scrollParentY = useRef( null );\n\tconst scrollEditorInterval = useRef( null );\n\n\t// Clear interval when unmounting.\n\tuseEffect(\n\t\t() => () => {\n\t\t\tif ( scrollEditorInterval.current ) {\n\t\t\t\tclearInterval( scrollEditorInterval.current );\n\t\t\t\tscrollEditorInterval.current = null;\n\t\t\t}\n\t\t},\n\t\t[]\n\t);\n\n\tconst startScrolling = useCallback( ( event ) => {\n\t\tdragStartY.current = event.clientY;\n\n\t\t// Find nearest parent(s) to scroll.\n\t\tscrollParentY.current = getScrollContainer( event.target );\n\n\t\tscrollEditorInterval.current = setInterval( () => {\n\t\t\tif ( scrollParentY.current && velocityY.current ) {\n\t\t\t\tconst newTop =\n\t\t\t\t\tscrollParentY.current.scrollTop + velocityY.current;\n\n\t\t\t\t// Setting `behavior: 'smooth'` as a scroll property seems to hurt performance.\n\t\t\t\t// Better to use a small scroll interval.\n\t\t\t\tscrollParentY.current.scroll( {\n\t\t\t\t\ttop: newTop,\n\t\t\t\t} );\n\t\t\t}\n\t\t}, SCROLL_INTERVAL_MS );\n\t}, [] );\n\n\tconst scrollOnDragOver = useCallback( ( event ) => {\n\t\tif ( ! scrollParentY.current ) {\n\t\t\treturn;\n\t\t}\n\t\tconst scrollParentHeight = scrollParentY.current.offsetHeight;\n\t\tconst offsetDragStartPosition =\n\t\t\tdragStartY.current - scrollParentY.current.offsetTop;\n\t\tconst offsetDragPosition =\n\t\t\tevent.clientY - scrollParentY.current.offsetTop;\n\n\t\tif ( event.clientY > offsetDragStartPosition ) {\n\t\t\t// User is dragging downwards.\n\t\t\tconst moveableDistance = Math.max(\n\t\t\t\tscrollParentHeight -\n\t\t\t\t\toffsetDragStartPosition -\n\t\t\t\t\tSCROLL_INACTIVE_DISTANCE_PX,\n\t\t\t\t0\n\t\t\t);\n\t\t\tconst dragDistance = Math.max(\n\t\t\t\toffsetDragPosition -\n\t\t\t\t\toffsetDragStartPosition -\n\t\t\t\t\tSCROLL_INACTIVE_DISTANCE_PX,\n\t\t\t\t0\n\t\t\t);\n\t\t\tconst distancePercentage =\n\t\t\t\tmoveableDistance === 0 || dragDistance === 0\n\t\t\t\t\t? 0\n\t\t\t\t\t: dragDistance / moveableDistance;\n\t\t\tvelocityY.current = VELOCITY_MULTIPLIER * distancePercentage;\n\t\t} else if ( event.clientY < offsetDragStartPosition ) {\n\t\t\t// User is dragging upwards.\n\t\t\tconst moveableDistance = Math.max(\n\t\t\t\toffsetDragStartPosition - SCROLL_INACTIVE_DISTANCE_PX,\n\t\t\t\t0\n\t\t\t);\n\t\t\tconst dragDistance = Math.max(\n\t\t\t\toffsetDragStartPosition -\n\t\t\t\t\toffsetDragPosition -\n\t\t\t\t\tSCROLL_INACTIVE_DISTANCE_PX,\n\t\t\t\t0\n\t\t\t);\n\t\t\tconst distancePercentage =\n\t\t\t\tmoveableDistance === 0 || dragDistance === 0\n\t\t\t\t\t? 0\n\t\t\t\t\t: dragDistance / moveableDistance;\n\t\t\tvelocityY.current = -VELOCITY_MULTIPLIER * distancePercentage;\n\t\t} else {\n\t\t\tvelocityY.current = 0;\n\t\t}\n\t}, [] );\n\n\tconst stopScrolling = () => {\n\t\tdragStartY.current = null;\n\t\tscrollParentY.current = null;\n\n\t\tif ( scrollEditorInterval.current ) {\n\t\t\tclearInterval( scrollEditorInterval.current );\n\t\t\tscrollEditorInterval.current = null;\n\t\t}\n\t};\n\n\treturn [ startScrolling, scrollOnDragOver, stopScrolling ];\n}\n"],"mappings":"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"}