{"version":3,"names":["useSelect","useDispatch","useState","useRef","useEffect","store","blockEditorStore","clearTimeout","setTimeout","window","DEBOUNCE_TIMEOUT","useDebouncedShowGestures","ref","isFocused","highlightParent","debounceTimeout","getSelectedBlockClientId","getBlockRootClientId","toggleBlockHighlight","timeoutRef","isDistractionFree","select","getSettings","handleOnChange","nextIsFocused","selectedBlockClientId","clientId","getIsHovered","current","matches","shouldHideGestures","isHovered","clearTimeoutRef","timeout","debouncedShowGestures","event","stopPropagation","debouncedHideGestures","useShowHoveredOrFocusedGestures","setIsFocused","registerRef","isFocusedWithin","contains","ownerDocument","activeElement","node","handleOnFocus","handleOnBlur","addEventListener","removeEventListener","onMouseMove","onMouseLeave"],"sources":["@wordpress/block-editor/src/components/block-toolbar/utils.js"],"sourcesContent":["/**\n * WordPress dependencies\n */\nimport { useSelect, useDispatch } from '@wordpress/data';\nimport { useState, useRef, useEffect } from '@wordpress/element';\n\n/**\n * Internal dependencies\n */\nimport { store as blockEditorStore } from '../../store';\n\nconst { clearTimeout, setTimeout } = window;\nconst DEBOUNCE_TIMEOUT = 200;\n\n/**\n * Hook that creates debounced callbacks when the node is hovered or focused.\n *\n * @param {Object}  props                       Component props.\n * @param {Object}  props.ref                   Element reference.\n * @param {boolean} props.isFocused             Whether the component has current focus.\n * @param {number}  props.highlightParent       Whether to highlight the parent block. It defaults in highlighting the selected block.\n * @param {number}  [props.debounceTimeout=250] Debounce timeout in milliseconds.\n */\nfunction useDebouncedShowGestures( {\n\tref,\n\tisFocused,\n\thighlightParent,\n\tdebounceTimeout = DEBOUNCE_TIMEOUT,\n} ) {\n\tconst { getSelectedBlockClientId, getBlockRootClientId } =\n\t\tuseSelect( blockEditorStore );\n\tconst { toggleBlockHighlight } = useDispatch( blockEditorStore );\n\tconst timeoutRef = useRef();\n\tconst isDistractionFree = useSelect(\n\t\t( select ) =>\n\t\t\tselect( blockEditorStore ).getSettings().isDistractionFree,\n\t\t[]\n\t);\n\tconst handleOnChange = ( nextIsFocused ) => {\n\t\tif ( nextIsFocused && isDistractionFree ) {\n\t\t\treturn;\n\t\t}\n\t\tconst selectedBlockClientId = getSelectedBlockClientId();\n\t\tconst clientId = highlightParent\n\t\t\t? getBlockRootClientId( selectedBlockClientId )\n\t\t\t: selectedBlockClientId;\n\t\ttoggleBlockHighlight( clientId, nextIsFocused );\n\t};\n\n\tconst getIsHovered = () => {\n\t\treturn ref?.current && ref.current.matches( ':hover' );\n\t};\n\n\tconst shouldHideGestures = () => {\n\t\tconst isHovered = getIsHovered();\n\t\treturn ! isFocused && ! isHovered;\n\t};\n\n\tconst clearTimeoutRef = () => {\n\t\tconst timeout = timeoutRef.current;\n\n\t\tif ( timeout && clearTimeout ) {\n\t\t\tclearTimeout( timeout );\n\t\t}\n\t};\n\n\tconst debouncedShowGestures = ( event ) => {\n\t\tif ( event ) {\n\t\t\tevent.stopPropagation();\n\t\t}\n\n\t\tclearTimeoutRef();\n\t\thandleOnChange( true );\n\t};\n\n\tconst debouncedHideGestures = ( event ) => {\n\t\tif ( event ) {\n\t\t\tevent.stopPropagation();\n\t\t}\n\n\t\tclearTimeoutRef();\n\n\t\ttimeoutRef.current = setTimeout( () => {\n\t\t\tif ( shouldHideGestures() ) {\n\t\t\t\thandleOnChange( false );\n\t\t\t}\n\t\t}, debounceTimeout );\n\t};\n\n\tuseEffect(\n\t\t() => () => {\n\t\t\t/**\n\t\t\t * We need to call the change handler with `isFocused`\n\t\t\t * set to false on unmount because we also clear the\n\t\t\t * timeout that would handle that.\n\t\t\t */\n\t\t\thandleOnChange( false );\n\t\t\tclearTimeoutRef();\n\t\t},\n\t\t[]\n\t);\n\n\treturn {\n\t\tdebouncedShowGestures,\n\t\tdebouncedHideGestures,\n\t};\n}\n\n/**\n * Hook that provides gesture events for DOM elements\n * that interact with the isFocused state.\n *\n * @param {Object} props                         Component props.\n * @param {Object} props.ref                     Element reference.\n * @param {number} [props.highlightParent=false] Whether to highlight the parent block. It defaults to highlighting the selected block.\n * @param {number} [props.debounceTimeout=250]   Debounce timeout in milliseconds.\n */\nexport function useShowHoveredOrFocusedGestures( {\n\tref,\n\thighlightParent = false,\n\tdebounceTimeout = DEBOUNCE_TIMEOUT,\n} ) {\n\tconst [ isFocused, setIsFocused ] = useState( false );\n\tconst { debouncedShowGestures, debouncedHideGestures } =\n\t\tuseDebouncedShowGestures( {\n\t\t\tref,\n\t\t\tdebounceTimeout,\n\t\t\tisFocused,\n\t\t\thighlightParent,\n\t\t} );\n\n\tconst registerRef = useRef( false );\n\n\tconst isFocusedWithin = () => {\n\t\treturn (\n\t\t\tref?.current &&\n\t\t\tref.current.contains( ref.current.ownerDocument.activeElement )\n\t\t);\n\t};\n\n\tuseEffect( () => {\n\t\tconst node = ref.current;\n\n\t\tconst handleOnFocus = () => {\n\t\t\tif ( isFocusedWithin() ) {\n\t\t\t\tsetIsFocused( true );\n\t\t\t\tdebouncedShowGestures();\n\t\t\t}\n\t\t};\n\n\t\tconst handleOnBlur = () => {\n\t\t\tif ( ! isFocusedWithin() ) {\n\t\t\t\tsetIsFocused( false );\n\t\t\t\tdebouncedHideGestures();\n\t\t\t}\n\t\t};\n\n\t\t/**\n\t\t * Events are added via DOM events (vs. React synthetic events),\n\t\t * as the child React components swallow mouse events.\n\t\t */\n\t\tif ( node && ! registerRef.current ) {\n\t\t\tnode.addEventListener( 'focus', handleOnFocus, true );\n\t\t\tnode.addEventListener( 'blur', handleOnBlur, true );\n\t\t\tregisterRef.current = true;\n\t\t}\n\n\t\treturn () => {\n\t\t\tif ( node ) {\n\t\t\t\tnode.removeEventListener( 'focus', handleOnFocus );\n\t\t\t\tnode.removeEventListener( 'blur', handleOnBlur );\n\t\t\t}\n\t\t};\n\t}, [\n\t\tref,\n\t\tregisterRef,\n\t\tsetIsFocused,\n\t\tdebouncedShowGestures,\n\t\tdebouncedHideGestures,\n\t] );\n\n\treturn {\n\t\tonMouseMove: debouncedShowGestures,\n\t\tonMouseLeave: debouncedHideGestures,\n\t};\n}\n"],"mappings":"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"}