{"version":3,"names":["_reactNativeReanimated","require","_data","_element","_store","_blockListContext","_math","_useOnBlockDrop","_interopRequireDefault","UPDATE_TARGET_BLOCK_INDEX_THRESHOLD","getNearestBlockIndex","blocksLayouts","position","orientation","isRTL","allowedEdges","isRightToLeft","candidateIndex","candidateDistance","forEach","element","index","x","y","width","height","rect","top","right","bottom","left","distance","edge","getDistanceToNearestEdge","undefined","isTrailingEdge","offset","useBlockDropZone","rootClientId","targetRootClientId","targetBlockIndex","useSharedValue","dragPosition","prevDragPosition","getBlockListSettings","getSettings","useSelect","blockEditorStore","getBlockLayoutsOrderedByYCoord","useBlockListContext","getSortedBlocksLayouts","useCallback","current","onBlockDrop","useOnBlockDrop","updateTargetBlockIndex","event","sortedBlockLayouts","targetIndex","value","useDerivedValue","prevX","prevY","Math","abs","runOnJS","onBlockDragOver","onBlockDragOverWorklet","onBlockDragEnd"],"sources":["@wordpress/block-editor/src/components/use-block-drop-zone/index.native.js"],"sourcesContent":["/**\n * External dependencies\n */\nimport {\n\trunOnJS,\n\tuseDerivedValue,\n\tuseSharedValue,\n} from 'react-native-reanimated';\n\n/**\n * WordPress dependencies\n */\nimport { useSelect } from '@wordpress/data';\nimport { useCallback } from '@wordpress/element';\n\n/**\n * Internal dependencies\n */\nimport { store as blockEditorStore } from '../../store';\nimport { useBlockListContext } from '../block-list/block-list-context';\nimport { getDistanceToNearestEdge } from '../../utils/math';\nimport useOnBlockDrop from '../use-on-block-drop';\n\nconst UPDATE_TARGET_BLOCK_INDEX_THRESHOLD = 20; // In pixels\n\n/** @typedef {import('../../utils/math').WPPoint} WPPoint */\n\n/**\n * The orientation of a block list.\n *\n * @typedef {'horizontal'|'vertical'|undefined} WPBlockListOrientation\n */\n\n/**\n * Given a list of blocks layouts finds the index that a block should be dropped at.\n *\n * @param {Object}                 blocksLayouts Blocks layouts object.\n * @param {WPPoint}                position      The position of the item being dragged.\n * @param {WPBlockListOrientation} orientation   The orientation of a block list.\n * @param {boolean}                isRTL         Check if current locale is RTL.\n *\n * @return {number|undefined} The block index that's closest to the drag position.\n */\nexport function getNearestBlockIndex(\n\tblocksLayouts,\n\tposition,\n\torientation,\n\tisRTL\n) {\n\tconst allowedEdges =\n\t\torientation === 'horizontal'\n\t\t\t? [ 'left', 'right' ]\n\t\t\t: [ 'top', 'bottom' ];\n\n\tconst isRightToLeft = isRTL;\n\n\tlet candidateIndex;\n\tlet candidateDistance;\n\n\t// Only enabled for root level blocks.\n\tblocksLayouts.forEach( ( element, index ) => {\n\t\tconst { x, y, width, height } = element;\n\t\tconst rect = {\n\t\t\tx: element.x,\n\t\t\ty: element.y,\n\t\t\ttop: y,\n\t\t\tright: x + width,\n\t\t\tbottom: y + height,\n\t\t\tleft: x,\n\t\t\twidth,\n\t\t\theight,\n\t\t};\n\t\tconst [ distance, edge ] = getDistanceToNearestEdge(\n\t\t\tposition,\n\t\t\trect,\n\t\t\tallowedEdges\n\t\t);\n\n\t\tif ( candidateDistance === undefined || distance < candidateDistance ) {\n\t\t\t// If the user is dropping to the trailing edge of the block\n\t\t\t// add 1 to the index to represent dragging after.\n\t\t\t// Take RTL languages into account where the left edge is\n\t\t\t// the trailing edge.\n\t\t\tconst isTrailingEdge =\n\t\t\t\tedge === 'bottom' ||\n\t\t\t\t( ! isRightToLeft && edge === 'right' ) ||\n\t\t\t\t( isRightToLeft && edge === 'left' );\n\t\t\tconst offset = isTrailingEdge ? 1 : 0;\n\n\t\t\t// Update the currently known best candidate.\n\t\t\tcandidateDistance = distance;\n\t\t\tcandidateIndex = index + offset;\n\t\t}\n\t} );\n\treturn candidateIndex;\n}\n\n/**\n * @typedef  {Object} WPBlockDropZoneConfig\n * @property {string} rootClientId The root client id for the block list.\n */\n\n/**\n * A React hook that can be used to make a block list handle drag and drop.\n *\n * @param {WPBlockDropZoneConfig} dropZoneConfig configuration data for the drop zone.\n *\n * @return {Object} An object that contains `targetBlockIndex` and the event\n * handlers `onBlockDragOver`, `onBlockDragEnd` and `onBlockDrop`.\n */\nexport default function useBlockDropZone( {\n\t// An undefined value represents a top-level block. Default to an empty\n\t// string for this so that `targetRootClientId` can be easily compared to\n\t// values returned by the `getRootBlockClientId` selector, which also uses\n\t// an empty string to represent top-level blocks.\n\trootClientId: targetRootClientId = '',\n} = {} ) {\n\tconst targetBlockIndex = useSharedValue( null );\n\tconst dragPosition = {\n\t\tx: useSharedValue( 0 ),\n\t\ty: useSharedValue( 0 ),\n\t};\n\tconst prevDragPosition = {\n\t\tx: useSharedValue( 0 ),\n\t\ty: useSharedValue( 0 ),\n\t};\n\n\tconst { getBlockListSettings, getSettings } = useSelect( blockEditorStore );\n\tconst { blocksLayouts, getBlockLayoutsOrderedByYCoord } =\n\t\tuseBlockListContext();\n\n\tconst getSortedBlocksLayouts = useCallback( () => {\n\t\treturn getBlockLayoutsOrderedByYCoord( blocksLayouts.current );\n\t\t// We use the value of `blocksLayouts` as the dependency.\n\t\t// eslint-disable-next-line react-hooks/exhaustive-deps\n\t}, [ blocksLayouts.current ] );\n\n\tconst isRTL = getSettings().isRTL;\n\n\tconst onBlockDrop = useOnBlockDrop();\n\n\tconst updateTargetBlockIndex = useCallback(\n\t\t( event ) => {\n\t\t\tconst sortedBlockLayouts = getSortedBlocksLayouts();\n\n\t\t\tconst targetIndex = getNearestBlockIndex(\n\t\t\t\tsortedBlockLayouts,\n\t\t\t\t{ x: event.x, y: event.y },\n\t\t\t\tgetBlockListSettings( targetRootClientId )?.orientation,\n\t\t\t\tisRTL\n\t\t\t);\n\t\t\tif ( targetIndex !== null ) {\n\t\t\t\ttargetBlockIndex.value = targetIndex ?? 0;\n\t\t\t}\n\t\t},\n\t\t[\n\t\t\tgetSortedBlocksLayouts,\n\t\t\tgetBlockListSettings,\n\t\t\ttargetRootClientId,\n\t\t\tisRTL,\n\t\t\ttargetBlockIndex,\n\t\t]\n\t);\n\n\tuseDerivedValue( () => {\n\t\tconst x = dragPosition.x.value;\n\t\tconst y = dragPosition.y.value;\n\t\tconst prevX = prevDragPosition.x.value;\n\t\tconst prevY = prevDragPosition.y.value;\n\t\t// `updateTargetBlockIndex` performs expensive calculations, so we throttle\n\t\t// the call using a offset threshold based on the dragging position.\n\t\tif (\n\t\t\tMath.abs( x - prevX ) >= UPDATE_TARGET_BLOCK_INDEX_THRESHOLD ||\n\t\t\tMath.abs( y - prevY ) >= UPDATE_TARGET_BLOCK_INDEX_THRESHOLD\n\t\t) {\n\t\t\trunOnJS( updateTargetBlockIndex )( { x, y } );\n\t\t\tprevDragPosition.x.value = x;\n\t\t\tprevDragPosition.y.value = y;\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t} );\n\n\treturn {\n\t\tonBlockDragOver( { x, y } ) {\n\t\t\tdragPosition.x.value = x;\n\t\t\tdragPosition.y.value = y;\n\t\t},\n\t\tonBlockDragOverWorklet( { x, y } ) {\n\t\t\t'worklet';\n\t\t\tdragPosition.x.value = x;\n\t\t\tdragPosition.y.value = y;\n\t\t},\n\t\tonBlockDragEnd() {\n\t\t\ttargetBlockIndex.value = null;\n\t\t},\n\t\tonBlockDrop: ( event ) => {\n\t\t\tif ( targetBlockIndex.value !== null ) {\n\t\t\t\tonBlockDrop( {\n\t\t\t\t\t...event,\n\t\t\t\t\ttargetRootClientId,\n\t\t\t\t\ttargetBlockIndex: targetBlockIndex.value,\n\t\t\t\t} );\n\t\t\t}\n\t\t},\n\t\ttargetBlockIndex,\n\t};\n}\n"],"mappings":"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"}