{"version":3,"names":["_registration","require","_serializer","_getBlockAttributes","CLASS_ATTR_SCHEMA","type","source","selector","attribute","getHTMLRootElementClasses","innerHTML","parsed","parseWithAttributeSchema","trim","split","fixCustomClassname","blockAttributes","blockType","hasBlockSupport","className","omittedClassName","attributesSansClassName","serialized","getSaveContent","defaultClasses","actualClasses","customClasses","filter","includes","length","join"],"sources":["@wordpress/blocks/src/api/parser/fix-custom-classname.js"],"sourcesContent":["/**\n * Internal dependencies\n */\nimport { hasBlockSupport } from '../registration';\nimport { getSaveContent } from '../serializer';\nimport { parseWithAttributeSchema } from './get-block-attributes';\n\nconst CLASS_ATTR_SCHEMA = {\n\ttype: 'string',\n\tsource: 'attribute',\n\tselector: '[data-custom-class-name] > *',\n\tattribute: 'class',\n};\n\n/**\n * Given an HTML string, returns an array of class names assigned to the root\n * element in the markup.\n *\n * @param {string} innerHTML Markup string from which to extract classes.\n *\n * @return {string[]} Array of class names assigned to the root element.\n */\nexport function getHTMLRootElementClasses( innerHTML ) {\n\tconst parsed = parseWithAttributeSchema(\n\t\t`<div data-custom-class-name>${ innerHTML }</div>`,\n\t\tCLASS_ATTR_SCHEMA\n\t);\n\n\treturn parsed ? parsed.trim().split( /\\s+/ ) : [];\n}\n\n/**\n * Given a parsed set of block attributes, if the block supports custom class\n * names and an unknown class (per the block's serialization behavior) is\n * found, the unknown classes are treated as custom classes. This prevents the\n * block from being considered as invalid.\n *\n * @param {Object} blockAttributes Original block attributes.\n * @param {Object} blockType       Block type settings.\n * @param {string} innerHTML       Original block markup.\n *\n * @return {Object} Filtered block attributes.\n */\nexport function fixCustomClassname( blockAttributes, blockType, innerHTML ) {\n\tif ( hasBlockSupport( blockType, 'customClassName', true ) ) {\n\t\t// To determine difference, serialize block given the known set of\n\t\t// attributes, with the exception of `className`. This will determine\n\t\t// the default set of classes. From there, any difference in innerHTML\n\t\t// can be considered as custom classes.\n\t\tconst { className: omittedClassName, ...attributesSansClassName } =\n\t\t\tblockAttributes;\n\t\tconst serialized = getSaveContent( blockType, attributesSansClassName );\n\t\tconst defaultClasses = getHTMLRootElementClasses( serialized );\n\t\tconst actualClasses = getHTMLRootElementClasses( innerHTML );\n\n\t\tconst customClasses = actualClasses.filter(\n\t\t\t( className ) => ! defaultClasses.includes( className )\n\t\t);\n\n\t\tif ( customClasses.length ) {\n\t\t\tblockAttributes.className = customClasses.join( ' ' );\n\t\t} else if ( serialized ) {\n\t\t\tdelete blockAttributes.className;\n\t\t}\n\t}\n\n\treturn blockAttributes;\n}\n"],"mappings":";;;;;;;AAGA,IAAAA,aAAA,GAAAC,OAAA;AACA,IAAAC,WAAA,GAAAD,OAAA;AACA,IAAAE,mBAAA,GAAAF,OAAA;AALA;AACA;AACA;;AAKA,MAAMG,iBAAiB,GAAG;EACzBC,IAAI,EAAE,QAAQ;EACdC,MAAM,EAAE,WAAW;EACnBC,QAAQ,EAAE,8BAA8B;EACxCC,SAAS,EAAE;AACZ,CAAC;;AAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACO,SAASC,yBAAyBA,CAAEC,SAAS,EAAG;EACtD,MAAMC,MAAM,GAAG,IAAAC,4CAAwB,EACrC,+BAA+BF,SAAW,QAAO,EAClDN,iBACD,CAAC;EAED,OAAOO,MAAM,GAAGA,MAAM,CAACE,IAAI,CAAC,CAAC,CAACC,KAAK,CAAE,KAAM,CAAC,GAAG,EAAE;AAClD;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACO,SAASC,kBAAkBA,CAAEC,eAAe,EAAEC,SAAS,EAAEP,SAAS,EAAG;EAC3E,IAAK,IAAAQ,6BAAe,EAAED,SAAS,EAAE,iBAAiB,EAAE,IAAK,CAAC,EAAG;IAC5D;IACA;IACA;IACA;IACA,MAAM;MAAEE,SAAS,EAAEC,gBAAgB;MAAE,GAAGC;IAAwB,CAAC,GAChEL,eAAe;IAChB,MAAMM,UAAU,GAAG,IAAAC,0BAAc,EAAEN,SAAS,EAAEI,uBAAwB,CAAC;IACvE,MAAMG,cAAc,GAAGf,yBAAyB,CAAEa,UAAW,CAAC;IAC9D,MAAMG,aAAa,GAAGhB,yBAAyB,CAAEC,SAAU,CAAC;IAE5D,MAAMgB,aAAa,GAAGD,aAAa,CAACE,MAAM,CACvCR,SAAS,IAAM,CAAEK,cAAc,CAACI,QAAQ,CAAET,SAAU,CACvD,CAAC;IAED,IAAKO,aAAa,CAACG,MAAM,EAAG;MAC3Bb,eAAe,CAACG,SAAS,GAAGO,aAAa,CAACI,IAAI,CAAE,GAAI,CAAC;IACtD,CAAC,MAAM,IAAKR,UAAU,EAAG;MACxB,OAAON,eAAe,CAACG,SAAS;IACjC;EACD;EAEA,OAAOH,eAAe;AACvB"}