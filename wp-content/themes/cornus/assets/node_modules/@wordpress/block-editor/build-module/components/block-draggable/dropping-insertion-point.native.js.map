{"version":3,"names":["Animated","useSharedValue","useAnimatedStyle","withTiming","useAnimatedReaction","runOnJS","useSafeAreaInsets","useSafeAreaFrame","useSelect","generateHapticFeedback","store","blockEditorStore","useBlockListContext","styles","DroppingInsertionPoint","scroll","currentYPosition","isDragging","targetBlockIndex","getBlockOrder","isBlockBeingDragged","isDraggingBlocks","getPreviousBlockClientId","getNextBlockClientId","blocksLayouts","findBlockLayoutByClientId","top","bottom","height","safeAreaOffset","maxHeight","blockYPosition","opacity","value","getSelectedBlockIndicatorPosition","positions","currentYPositionWithScroll","offsetY","midpoint","setIndicatorPosition","index","insertionPointIndex","order","isDraggingAnyBlocks","length","previousClientId","nextClientId","previousElement","current","nextElement","previousElementPosition","y","nextElementPosition","elementsPositions","Math","floor","nextPosition","previous","animatedStyles","translationY","shouldHideIndicator","transform","translateY","insertionPointStyles","createElement","View","pointerEvents","style"],"sources":["@wordpress/block-editor/src/components/block-draggable/dropping-insertion-point.native.js"],"sourcesContent":["/**\n * External dependencies\n */\nimport Animated, {\n\tuseSharedValue,\n\tuseAnimatedStyle,\n\twithTiming,\n\tuseAnimatedReaction,\n\trunOnJS,\n} from 'react-native-reanimated';\nimport {\n\tuseSafeAreaInsets,\n\tuseSafeAreaFrame,\n} from 'react-native-safe-area-context';\n\n/**\n * WordPress dependencies\n */\nimport { useSelect } from '@wordpress/data';\nimport { generateHapticFeedback } from '@wordpress/react-native-bridge';\n\n/**\n * Internal dependencies\n */\nimport { store as blockEditorStore } from '../../store';\nimport { useBlockListContext } from '../block-list/block-list-context';\nimport styles from './dropping-insertion-point.scss';\n\n/**\n * Dropping zone indicator component.\n *\n * This component shows where a block can be dropped when it's being dragged.\n *\n * @param {Object}                                        props                  Component props.\n * @param {Object}                                        props.scroll           Scroll offset object.\n * @param {Object}                                        props.currentYPosition Current Y coordinate position when dragging.\n * @param {import('react-native-reanimated').SharedValue} props.isDragging       Whether or not dragging has started.\n * @param {import('react-native-reanimated').SharedValue} props.targetBlockIndex Current block target index.\n *\n * @return {JSX.Element} The component to be rendered.\n */\nexport default function DroppingInsertionPoint( {\n\tscroll,\n\tcurrentYPosition,\n\tisDragging,\n\ttargetBlockIndex,\n} ) {\n\tconst {\n\t\tgetBlockOrder,\n\t\tisBlockBeingDragged,\n\t\tisDraggingBlocks,\n\t\tgetPreviousBlockClientId,\n\t\tgetNextBlockClientId,\n\t} = useSelect( blockEditorStore );\n\n\tconst { blocksLayouts, findBlockLayoutByClientId } = useBlockListContext();\n\tconst { top, bottom } = useSafeAreaInsets();\n\tconst { height } = useSafeAreaFrame();\n\tconst safeAreaOffset = top + bottom;\n\tconst maxHeight =\n\t\theight -\n\t\t( safeAreaOffset + styles[ 'dropping-insertion-point' ].height );\n\n\tconst blockYPosition = useSharedValue( 0 );\n\tconst opacity = useSharedValue( 0 );\n\n\tuseAnimatedReaction(\n\t\t() => isDragging.value,\n\t\t( value ) => {\n\t\t\tif ( ! value ) {\n\t\t\t\topacity.value = 0;\n\t\t\t\tblockYPosition.value = 0;\n\t\t\t}\n\t\t}\n\t);\n\n\tfunction getSelectedBlockIndicatorPosition( positions ) {\n\t\tconst currentYPositionWithScroll =\n\t\t\tcurrentYPosition.value + scroll.offsetY.value;\n\t\tconst midpoint = ( positions.top + positions.bottom ) / 2;\n\n\t\treturn midpoint < currentYPositionWithScroll\n\t\t\t? positions.bottom\n\t\t\t: positions.top;\n\t}\n\n\tfunction setIndicatorPosition( index ) {\n\t\tconst insertionPointIndex = index;\n\t\tconst order = getBlockOrder();\n\t\tconst isDraggingAnyBlocks = isDraggingBlocks();\n\n\t\tif (\n\t\t\t! isDraggingAnyBlocks ||\n\t\t\tinsertionPointIndex === null ||\n\t\t\t! order.length\n\t\t) {\n\t\t\treturn;\n\t\t}\n\n\t\tlet previousClientId = order[ insertionPointIndex - 1 ];\n\t\tlet nextClientId = order[ insertionPointIndex ];\n\n\t\twhile ( isBlockBeingDragged( previousClientId ) ) {\n\t\t\tpreviousClientId = getPreviousBlockClientId( previousClientId );\n\t\t}\n\n\t\twhile ( isBlockBeingDragged( nextClientId ) ) {\n\t\t\tnextClientId = getNextBlockClientId( nextClientId );\n\t\t}\n\n\t\tconst previousElement = previousClientId\n\t\t\t? findBlockLayoutByClientId(\n\t\t\t\t\tblocksLayouts.current,\n\t\t\t\t\tpreviousClientId\n\t\t\t  )\n\t\t\t: null;\n\t\tconst nextElement = nextClientId\n\t\t\t? findBlockLayoutByClientId( blocksLayouts.current, nextClientId )\n\t\t\t: null;\n\n\t\tconst previousElementPosition = previousElement\n\t\t\t? previousElement.y + previousElement.height\n\t\t\t: 0;\n\t\tconst nextElementPosition = nextElement ? nextElement.y : 0;\n\n\t\tconst elementsPositions = {\n\t\t\ttop: Math.floor(\n\t\t\t\tpreviousElement ? previousElementPosition : nextElementPosition\n\t\t\t),\n\t\t\tbottom: Math.floor(\n\t\t\t\tnextElement ? nextElementPosition : previousElementPosition\n\t\t\t),\n\t\t};\n\n\t\tconst nextPosition =\n\t\t\telementsPositions.top !== elementsPositions.bottom\n\t\t\t\t? getSelectedBlockIndicatorPosition( elementsPositions )\n\t\t\t\t: elementsPositions.top;\n\n\t\tif ( nextPosition && blockYPosition.value !== nextPosition ) {\n\t\t\topacity.value = 0;\n\t\t\tblockYPosition.value = nextPosition;\n\t\t\topacity.value = withTiming( 1 );\n\t\t\tgenerateHapticFeedback();\n\t\t}\n\t}\n\n\tuseAnimatedReaction(\n\t\t() => targetBlockIndex.value,\n\t\t( value, previous ) => {\n\t\t\tif ( value !== previous ) {\n\t\t\t\trunOnJS( setIndicatorPosition )( value );\n\t\t\t}\n\t\t}\n\t);\n\n\tconst animatedStyles = useAnimatedStyle( () => {\n\t\tconst translationY = blockYPosition.value - scroll.offsetY.value;\n\t\t// Prevents overflowing behind the header/footer\n\t\tconst shouldHideIndicator =\n\t\t\ttranslationY < 0 || translationY > maxHeight;\n\n\t\treturn {\n\t\t\topacity: shouldHideIndicator ? 0 : opacity.value,\n\t\t\ttransform: [\n\t\t\t\t{\n\t\t\t\t\ttranslateY: translationY,\n\t\t\t\t},\n\t\t\t],\n\t\t};\n\t} );\n\n\tconst insertionPointStyles = [\n\t\tstyles[ 'dropping-insertion-point' ],\n\t\tanimatedStyles,\n\t];\n\n\treturn (\n\t\t<Animated.View pointerEvents=\"none\" style={ insertionPointStyles } />\n\t);\n}\n"],"mappings":"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"}