{"version":3,"names":["View","Platform","Dimensions","memize","colord","RCTAztecView","showUserSuggestions","showXpostSuggestions","BlockFormatControls","getPxFromCssUnit","Component","compose","debounce","withPreferredColorScheme","withSelect","childrenBlock","decodeEntities","BACKSPACE","DELETE","ENTER","isURL","atSymbol","plus","__","applyFormat","getActiveFormat","getActiveFormats","insert","getTextContent","isEmpty","create","toHTMLString","isCollapsed","remove","useFormatTypes","FormatEdit","getFormatColors","styles","ToolbarButtonWithOptions","flatColorPalettes","colorsPalettes","theme","custom","default","getSelectionColor","currentSelectionColor","defaultSelectionColor","baseGlobalStyles","isBlockBasedTheme","selectionColor","colordTextColor","colordBackgroundColor","color","background","isColordTextReadable","isReadable","text","gutenbergFormatNamesToAztec","EMPTY_PARAGRAPH_TAGS","DEFAULT_FONT_SIZE","MIN_LINE_HEIGHT","RichText","constructor","value","selectionStart","selectionEnd","arguments","isIOS","OS","createRecord","bind","onChangeFromAztec","onKeyDown","handleEnter","handleDelete","onPaste","onFocus","onBlur","onTextUpdate","onContentSizeChange","onFormatChange","formatToValue","maxSize","debounceCreateUndoLevel","onCreateUndoLevel","onSelectionChange","onSelectionChangeFromAztec","valueToFormat","getHtmlToRender","handleSuggestionFunc","handleUserSuggestion","handleXpostSuggestion","suggestionOptions","insertString","manipulateEventCounterToForceNativeToRefresh","shouldDropEventFromAztec","state","activeFormats","selectedFormat","height","currentFontSize","getFontSize","needsSelectionUpdate","savedContent","isTouched","lastAztecEventType","lastHistoryValue","getRecord","start","end","colorPalette","props","currentValue","formats","replacements","newFormats","preserveWhiteSpace","html","range","Math","min","length","removeRootTagsProducedByAztec","getActiveFormatNames","record","formatTypes","map","name","filter","undefined","Boolean","changeHandlers","Object","fromEntries","entries","key","startsWith","values","forEach","changeHandler","onChange","setState","string","toInsert","__unstableOnCreateUndoLevel","toString","result","removeRootTag","tagName","tagsToEliminate","element","removeTag","tag","openingTagRegexp","RegExp","closingTagRegexp","replace","event","contentWithoutRootTag","nativeEvent","lastEventCount","eventCount","comesFromAztec","firedAfterTextChanged","refresh","contentSize","defaultPrevented","customEditableOnKeyDown","preventDefault","KeyCodes","keyCode","handleTriggerKeyCodes","onEnter","shiftKey","isReverse","onDelete","newValue","triggeredOption","find","option","triggeredKeyCode","triggerChar","charCodeAt","useTrigger","charAt","onClick","areMentionsSupported","areXPostsSupported","allOptions","supported","title","label","icon","op","suggestionFunction","prefix","then","suggestion","catch","pastedText","pastedHtml","files","currentRecord","trimmedText","trim","linkedRecord","type","attributes","href","window","console","log","plainText","unstableOnFocus","hasChanged","isManual","logText","shouldDrop","shouldFocusTextInputAfterMerge","prevProps","__unstableIsSelected","isSelected","blockIsSelected","__unstableMobileNoFocusOnMount","prevIsSelected","prevBlockIsSelected","noSelectionValues","textInputWasNotFocused","realStart","realEnd","max","Array","isArray","toHTML","format","shouldComponentUpdate","nextProps","nextState","reversed","fontSize","style","lineHeight","componentDidMount","_editor","focus","componentDidUpdate","_this$value$toString$","lastCharacterPosition","blur","currentFontSizeStyle","getParsedFontSize","prevFontSizeStyle","isDifferentTag","extraAttributes","getEditableProps","className","_getPxFromCssUnit","width","get","cssUnitOptions","selectedPxValue","parseFloat","tagNameFontSize","elements","typography","newFontSize","getLineHeight","tagNameLineHeight","newLineHeight","getIsBlockBasedTheme","isNaN","getBlockUseDefaultFont","tagsToMatch","test","getLinkTextColor","defaultColor","customColor","linkColor","isValid","toHex","getPlaceholderTextColor","_ref","_ref2","getStylesFromColorScheme","placeholderTextColor","placeholderStyle","richTextPlaceholder","richTextPlaceholderDark","defaultPlaceholderTextColor","placeholderOpacity","inheritPlaceholderColor","placeholderColor","globalStylesPlaceholderColor","render","children","minWidth","maxWidth","parentBlockStyles","accessibilityLabel","disableEditingMenu","disableSuggestions","containerWidth","editableProps","blockUseDefaultFont","textDecorationColor","defaultTextDecorationColor","fontFamily","defaultFontFamily","richText","richTextDark","linkTextColor","currentSelectionStart","currentSelectionEnd","selection","brBeforeParaMatches","match","warn","count","newSelectionStart","newSelectionEnd","containerStyles","padding","backgroundColor","EditableView","createElement","Fragment","editableTagName","ref","setRef","minHeight","placeholder","deleteEnter","triggerKeyCodes","blockType","maxImagesWidth","fontWeight","fontStyle","isMultiline","textAlign","id","disableAutocorrection","forwardedRef","options","defaultProps","withFormatTypes","WrappedComponent","clientId","identifier","withoutInteractiveFormatting","allowedFormats","select","getBlockParents","getBlock","getSettings","parents","parentBlock","childrenStyles","settings","__experimentalGlobalStylesBaseStyles","colorPalettes","__experimentalFeatures","palette","colors","capabilities","mentions","xposts"],"sources":["@wordpress/block-editor/src/components/rich-text/native/index.native.js"],"sourcesContent":["/* eslint no-console: [\"error\", { allow: [\"warn\"] }] */\n\n/**\n * External dependencies\n */\nimport { View, Platform, Dimensions } from 'react-native';\nimport memize from 'memize';\nimport { colord } from 'colord';\n\n/**\n * WordPress dependencies\n */\nimport RCTAztecView from '@wordpress/react-native-aztec';\nimport {\n\tshowUserSuggestions,\n\tshowXpostSuggestions,\n} from '@wordpress/react-native-bridge';\nimport { BlockFormatControls } from '@wordpress/block-editor';\nimport { getPxFromCssUnit } from '@wordpress/components';\nimport { Component } from '@wordpress/element';\nimport {\n\tcompose,\n\tdebounce,\n\twithPreferredColorScheme,\n} from '@wordpress/compose';\nimport { withSelect } from '@wordpress/data';\nimport { childrenBlock } from '@wordpress/blocks';\nimport { decodeEntities } from '@wordpress/html-entities';\nimport { BACKSPACE, DELETE, ENTER } from '@wordpress/keycodes';\nimport { isURL } from '@wordpress/url';\nimport { atSymbol, plus } from '@wordpress/icons';\nimport { __ } from '@wordpress/i18n';\nimport {\n\tapplyFormat,\n\tgetActiveFormat,\n\tgetActiveFormats,\n\tinsert,\n\tgetTextContent,\n\tisEmpty,\n\tcreate,\n\ttoHTMLString,\n\tisCollapsed,\n\tremove,\n} from '@wordpress/rich-text';\n\n/**\n * Internal dependencies\n */\nimport { useFormatTypes } from './use-format-types';\nimport FormatEdit from './format-edit';\nimport { getFormatColors } from './get-format-colors';\nimport styles from './style.scss';\nimport ToolbarButtonWithOptions from './toolbar-button-with-options';\n\n// The flattened color palettes array is memoized to ensure that the same array instance is\n// returned for the colors palettes. This value might be used as a prop, so having the same\n// instance will prevent unnecessary re-renders of the RichText component.\nconst flatColorPalettes = memize( ( colorsPalettes ) => [\n\t...( colorsPalettes?.theme || [] ),\n\t...( colorsPalettes?.custom || [] ),\n\t...( colorsPalettes?.default || [] ),\n] );\n\nconst getSelectionColor = memize(\n\t(\n\t\tcurrentSelectionColor,\n\t\tdefaultSelectionColor,\n\t\tbaseGlobalStyles,\n\t\tisBlockBasedTheme\n\t) => {\n\t\tlet selectionColor = defaultSelectionColor;\n\t\tif ( currentSelectionColor ) {\n\t\t\tselectionColor = currentSelectionColor;\n\t\t}\n\n\t\tif ( isBlockBasedTheme ) {\n\t\t\tconst colordTextColor = colord( selectionColor );\n\t\t\tconst colordBackgroundColor = colord(\n\t\t\t\tbaseGlobalStyles?.color?.background\n\t\t\t);\n\t\t\tconst isColordTextReadable = colordTextColor.isReadable(\n\t\t\t\tcolordBackgroundColor\n\t\t\t);\n\t\t\tif ( ! isColordTextReadable ) {\n\t\t\t\tselectionColor = baseGlobalStyles?.color?.text;\n\t\t\t}\n\t\t}\n\n\t\treturn selectionColor;\n\t}\n);\n\nconst gutenbergFormatNamesToAztec = {\n\t'core/bold': 'bold',\n\t'core/italic': 'italic',\n\t'core/strikethrough': 'strikethrough',\n\t'core/text-color': 'mark',\n};\n\nconst EMPTY_PARAGRAPH_TAGS = '<p></p>';\nconst DEFAULT_FONT_SIZE = 16;\nconst MIN_LINE_HEIGHT = 1;\n\nexport class RichText extends Component {\n\tconstructor( { value, selectionStart, selectionEnd } ) {\n\t\tsuper( ...arguments );\n\n\t\tthis.isIOS = Platform.OS === 'ios';\n\t\tthis.createRecord = this.createRecord.bind( this );\n\t\tthis.onChangeFromAztec = this.onChangeFromAztec.bind( this );\n\t\tthis.onKeyDown = this.onKeyDown.bind( this );\n\t\tthis.handleEnter = this.handleEnter.bind( this );\n\t\tthis.handleDelete = this.handleDelete.bind( this );\n\t\tthis.onPaste = this.onPaste.bind( this );\n\t\tthis.onFocus = this.onFocus.bind( this );\n\t\tthis.onBlur = this.onBlur.bind( this );\n\t\tthis.onTextUpdate = this.onTextUpdate.bind( this );\n\t\tthis.onContentSizeChange = this.onContentSizeChange.bind( this );\n\t\tthis.onFormatChange = this.onFormatChange.bind( this );\n\t\tthis.formatToValue = memize( this.formatToValue.bind( this ), {\n\t\t\tmaxSize: 1,\n\t\t} );\n\t\tthis.debounceCreateUndoLevel = debounce( this.onCreateUndoLevel, 1000 );\n\t\t// This prevents a bug in Aztec which triggers onSelectionChange twice on format change.\n\t\tthis.onSelectionChange = this.onSelectionChange.bind( this );\n\t\tthis.onSelectionChangeFromAztec =\n\t\t\tthis.onSelectionChangeFromAztec.bind( this );\n\t\tthis.valueToFormat = this.valueToFormat.bind( this );\n\t\tthis.getHtmlToRender = this.getHtmlToRender.bind( this );\n\t\tthis.handleSuggestionFunc = this.handleSuggestionFunc.bind( this );\n\t\tthis.handleUserSuggestion = this.handleSuggestionFunc(\n\t\t\tshowUserSuggestions,\n\t\t\t'@'\n\t\t).bind( this );\n\t\tthis.handleXpostSuggestion = this.handleSuggestionFunc(\n\t\t\tshowXpostSuggestions,\n\t\t\t'+'\n\t\t).bind( this );\n\t\tthis.suggestionOptions = this.suggestionOptions.bind( this );\n\t\tthis.insertString = this.insertString.bind( this );\n\t\tthis.manipulateEventCounterToForceNativeToRefresh =\n\t\t\tthis.manipulateEventCounterToForceNativeToRefresh.bind( this );\n\t\tthis.shouldDropEventFromAztec =\n\t\t\tthis.shouldDropEventFromAztec.bind( this );\n\t\tthis.state = {\n\t\t\tactiveFormats: [],\n\t\t\tselectedFormat: null,\n\t\t\theight: 0,\n\t\t\tcurrentFontSize: this.getFontSize( arguments[ 0 ] ),\n\t\t};\n\t\tthis.needsSelectionUpdate = false;\n\t\tthis.savedContent = '';\n\t\tthis.isTouched = false;\n\t\tthis.lastAztecEventType = null;\n\n\t\tthis.lastHistoryValue = value;\n\n\t\t// Internal values that are update synchronously, unlike props.\n\t\tthis.value = value;\n\t\tthis.selectionStart = selectionStart;\n\t\tthis.selectionEnd = selectionEnd;\n\t}\n\n\t/**\n\t * Get the current record (value and selection) from props and state.\n\t *\n\t * @return {Object} The current record (value and selection).\n\t */\n\tgetRecord() {\n\t\tconst {\n\t\t\tselectionStart: start,\n\t\t\tselectionEnd: end,\n\t\t\tcolorPalette,\n\t\t} = this.props;\n\t\tconst { value } = this.props;\n\t\tconst currentValue = this.formatToValue( value );\n\n\t\tconst { formats, replacements, text } = currentValue;\n\t\tconst { activeFormats } = this.state;\n\t\tconst newFormats = getFormatColors( formats, colorPalette );\n\n\t\treturn {\n\t\t\tformats: newFormats,\n\t\t\treplacements,\n\t\t\ttext,\n\t\t\tstart,\n\t\t\tend,\n\t\t\tactiveFormats,\n\t\t};\n\t}\n\n\t/**\n\t * Creates a RichText value \"record\" from the current content and selection\n\t * information\n\t *\n\t *\n\t * @return {Object} A RichText value with formats and selection.\n\t */\n\tcreateRecord() {\n\t\tconst { preserveWhiteSpace } = this.props;\n\t\tconst value = {\n\t\t\tstart: this.selectionStart,\n\t\t\tend: this.selectionEnd,\n\t\t\t...create( {\n\t\t\t\thtml: this.value,\n\t\t\t\trange: null,\n\t\t\t\tpreserveWhiteSpace,\n\t\t\t} ),\n\t\t};\n\t\tconst start = Math.min( this.selectionStart, value.text.length );\n\t\tconst end = Math.min( this.selectionEnd, value.text.length );\n\t\treturn { ...value, start, end };\n\t}\n\n\tvalueToFormat( value ) {\n\t\t// Remove the outer root tags.\n\t\treturn this.removeRootTagsProducedByAztec( toHTMLString( { value } ) );\n\t}\n\n\tgetActiveFormatNames( record ) {\n\t\tconst { formatTypes } = this.props;\n\n\t\treturn formatTypes\n\t\t\t.map( ( { name } ) => name )\n\t\t\t.filter( ( name ) => {\n\t\t\t\treturn getActiveFormat( record, name ) !== undefined;\n\t\t\t} )\n\t\t\t.map( ( name ) => gutenbergFormatNamesToAztec[ name ] )\n\t\t\t.filter( Boolean );\n\t}\n\n\tonFormatChange( record ) {\n\t\tconst { start = 0, end = 0, activeFormats = [] } = record;\n\t\tconst changeHandlers = Object.fromEntries(\n\t\t\tObject.entries( this.props ).filter( ( [ key ] ) =>\n\t\t\t\tkey.startsWith( 'format_on_change_functions_' )\n\t\t\t)\n\t\t);\n\n\t\tObject.values( changeHandlers ).forEach( ( changeHandler ) => {\n\t\t\tchangeHandler( record.formats, record.text );\n\t\t} );\n\n\t\tthis.value = this.valueToFormat( record );\n\t\tthis.props.onChange( this.value );\n\t\tthis.setState( { activeFormats } );\n\t\tthis.props.onSelectionChange( start, end );\n\t\tthis.selectionStart = start;\n\t\tthis.selectionEnd = end;\n\n\t\tthis.onCreateUndoLevel();\n\n\t\tthis.lastAztecEventType = 'format change';\n\t}\n\n\tinsertString( record, string ) {\n\t\tif ( record && string ) {\n\t\t\tthis.manipulateEventCounterToForceNativeToRefresh(); // force a refresh on the native side\n\t\t\tconst toInsert = insert( record, string );\n\t\t\tthis.onFormatChange( toInsert );\n\t\t}\n\t}\n\n\tonCreateUndoLevel() {\n\t\tconst { __unstableOnCreateUndoLevel: onCreateUndoLevel } = this.props;\n\t\t// If the content is the same, no level needs to be created.\n\t\tif ( this.lastHistoryValue?.toString() === this.value?.toString() ) {\n\t\t\treturn;\n\t\t}\n\n\t\tonCreateUndoLevel();\n\t\tthis.lastHistoryValue = this.value;\n\t}\n\n\t/*\n\t * Cleans up any root tags produced by aztec.\n\t * TODO: This should be removed on a later version when aztec doesn't return the top tag of the text being edited\n\t */\n\tremoveRootTagsProducedByAztec( html ) {\n\t\tlet result = this.removeRootTag( this.props.tagName, html );\n\n\t\tif ( this.props.tagsToEliminate ) {\n\t\t\tthis.props.tagsToEliminate.forEach( ( element ) => {\n\t\t\t\tresult = this.removeTag( element, result );\n\t\t\t} );\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tremoveRootTag( tag, html ) {\n\t\tconst openingTagRegexp = RegExp( '^<' + tag + '[^>]*>', 'gim' );\n\t\tconst closingTagRegexp = RegExp( '</' + tag + '>$', 'gim' );\n\n\t\treturn html\n\t\t\t.replace( openingTagRegexp, '' )\n\t\t\t.replace( closingTagRegexp, '' );\n\t}\n\n\tremoveTag( tag, html ) {\n\t\tconst openingTagRegexp = RegExp( '<' + tag + '>', 'gim' );\n\t\tconst closingTagRegexp = RegExp( '</' + tag + '>', 'gim' );\n\t\treturn html\n\t\t\t.replace( openingTagRegexp, '' )\n\t\t\t.replace( closingTagRegexp, '' );\n\t}\n\n\t/*\n\t * Handles any case where the content of the AztecRN instance has changed\n\t */\n\tonChangeFromAztec( event ) {\n\t\tif ( this.shouldDropEventFromAztec( event, 'onChange' ) ) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst contentWithoutRootTag = this.removeRootTagsProducedByAztec(\n\t\t\tevent.nativeEvent.text\n\t\t);\n\t\t// On iOS, onChange can be triggered after selection changes, even though there are no content changes.\n\t\tif ( contentWithoutRootTag === this.value?.toString() ) {\n\t\t\treturn;\n\t\t}\n\t\tthis.lastEventCount = event.nativeEvent.eventCount;\n\t\tthis.comesFromAztec = true;\n\t\tthis.firedAfterTextChanged = true; // The onChange event always fires after the fact.\n\t\tthis.onTextUpdate( event );\n\t\tthis.lastAztecEventType = 'input';\n\t}\n\n\tonTextUpdate( event ) {\n\t\tconst contentWithoutRootTag = this.removeRootTagsProducedByAztec(\n\t\t\tevent.nativeEvent.text\n\t\t);\n\n\t\tthis.debounceCreateUndoLevel();\n\t\tconst refresh = this.value?.toString() !== contentWithoutRootTag;\n\t\tthis.value = contentWithoutRootTag;\n\n\t\t// We don't want to refresh if our goal is just to create a record.\n\t\tif ( refresh ) {\n\t\t\tthis.props.onChange( contentWithoutRootTag );\n\t\t}\n\t}\n\n\t/*\n\t * Handles any case where the content of the AztecRN instance has changed in size\n\t */\n\tonContentSizeChange( contentSize ) {\n\t\tthis.setState( contentSize );\n\t\tthis.lastAztecEventType = 'content size change';\n\t}\n\n\tonKeyDown( event ) {\n\t\tif ( event.defaultPrevented ) {\n\t\t\treturn;\n\t\t}\n\n\t\t// Add stubs for conformance in downstream autocompleters logic.\n\t\tthis.customEditableOnKeyDown?.( {\n\t\t\tpreventDefault: () => undefined,\n\t\t\t...event,\n\t\t\tkey: RCTAztecView.KeyCodes[ event?.keyCode ],\n\t\t} );\n\n\t\tthis.handleDelete( event );\n\t\tthis.handleEnter( event );\n\t\tthis.handleTriggerKeyCodes( event );\n\t}\n\n\thandleEnter( event ) {\n\t\tif ( event.keyCode !== ENTER ) {\n\t\t\treturn;\n\t\t}\n\t\tconst { onEnter } = this.props;\n\n\t\tif ( ! onEnter ) {\n\t\t\treturn;\n\t\t}\n\n\t\tonEnter( {\n\t\t\tvalue: this.createRecord(),\n\t\t\tonChange: this.onFormatChange,\n\t\t\tshiftKey: event.shiftKey,\n\t\t} );\n\t\tthis.lastAztecEventType = 'input';\n\t}\n\n\thandleDelete( event ) {\n\t\tif ( this.shouldDropEventFromAztec( event, 'handleDelete' ) ) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst { keyCode } = event;\n\n\t\tif ( keyCode !== DELETE && keyCode !== BACKSPACE ) {\n\t\t\treturn;\n\t\t}\n\t\tconst isReverse = keyCode === BACKSPACE;\n\n\t\tconst { onDelete } = this.props;\n\t\tthis.lastEventCount = event.nativeEvent.eventCount;\n\t\tthis.comesFromAztec = true;\n\t\tthis.firedAfterTextChanged = event.nativeEvent.firedAfterTextChanged;\n\t\tconst value = this.createRecord();\n\t\tconst { start, end, text } = value;\n\t\tlet newValue;\n\n\t\t// Always handle full content deletion ourselves.\n\t\tif ( start === 0 && end !== 0 && end >= text.length ) {\n\t\t\tnewValue = remove( value );\n\t\t\tthis.onFormatChange( newValue );\n\t\t\tevent.preventDefault();\n\t\t\treturn;\n\t\t}\n\n\t\t// Only process delete if the key press occurs at an uncollapsed edge.\n\t\tif (\n\t\t\t! onDelete ||\n\t\t\t! isCollapsed( value ) ||\n\t\t\t( isReverse && start !== 0 ) ||\n\t\t\t( ! isReverse && end !== text.length )\n\t\t) {\n\t\t\treturn;\n\t\t}\n\n\t\tonDelete( { isReverse, value } );\n\n\t\tevent.preventDefault();\n\t\tthis.lastAztecEventType = 'input';\n\t}\n\n\thandleTriggerKeyCodes( event ) {\n\t\tconst { keyCode } = event;\n\t\tconst triggeredOption = this.suggestionOptions().find( ( option ) => {\n\t\t\tconst triggeredKeyCode = option.triggerChar.charCodeAt( 0 );\n\t\t\treturn triggeredKeyCode === keyCode;\n\t\t} );\n\n\t\tif ( triggeredOption ) {\n\t\t\tconst record = this.getRecord();\n\t\t\tconst text = getTextContent( record );\n\t\t\t// Only respond to the trigger if the selection is on the start of text or line\n\t\t\t// or if the character before is a space.\n\t\t\tconst useTrigger =\n\t\t\t\ttext.length === 0 ||\n\t\t\t\trecord.start === 0 ||\n\t\t\t\ttext.charAt( record.start - 1 ) === '\\n' ||\n\t\t\t\ttext.charAt( record.start - 1 ) === ' ';\n\n\t\t\tif ( useTrigger && triggeredOption.onClick ) {\n\t\t\t\ttriggeredOption.onClick();\n\t\t\t} else {\n\t\t\t\tthis.insertString( record, triggeredOption.triggerChar );\n\t\t\t}\n\t\t}\n\t}\n\n\tsuggestionOptions() {\n\t\tconst { areMentionsSupported, areXPostsSupported } = this.props;\n\t\tconst allOptions = [\n\t\t\t{\n\t\t\t\tsupported: areMentionsSupported,\n\t\t\t\ttitle: __( 'Insert mention' ),\n\t\t\t\tonClick: this.handleUserSuggestion,\n\t\t\t\ttriggerChar: '@',\n\t\t\t\tvalue: 'mention',\n\t\t\t\tlabel: __( 'Mention' ),\n\t\t\t\ticon: atSymbol,\n\t\t\t},\n\t\t\t{\n\t\t\t\tsupported: areXPostsSupported,\n\t\t\t\ttitle: __( 'Insert crosspost' ),\n\t\t\t\tonClick: this.handleXpostSuggestion,\n\t\t\t\ttriggerChar: '+',\n\t\t\t\tvalue: 'crosspost',\n\t\t\t\tlabel: __( 'Crosspost' ),\n\t\t\t\ticon: plus,\n\t\t\t},\n\t\t];\n\t\treturn allOptions.filter( ( op ) => op.supported );\n\t}\n\n\thandleSuggestionFunc( suggestionFunction, prefix ) {\n\t\treturn () => {\n\t\t\tconst record = this.getRecord();\n\t\t\tsuggestionFunction()\n\t\t\t\t.then( ( suggestion ) => {\n\t\t\t\t\tthis.insertString( record, `${ prefix }${ suggestion } ` );\n\t\t\t\t} )\n\t\t\t\t.catch( () => {} );\n\t\t};\n\t}\n\n\t/**\n\t * Handles a paste event from the native Aztec Wrapper.\n\t *\n\t * @param {Object} event The paste event which wraps `nativeEvent`.\n\t */\n\tonPaste( event ) {\n\t\tconst { onPaste, onChange } = this.props;\n\t\tconst { activeFormats = [] } = this.state;\n\n\t\tconst { pastedText, pastedHtml, files } = event.nativeEvent;\n\t\tconst currentRecord = this.createRecord();\n\n\t\tevent.preventDefault();\n\n\t\t// There is a selection, check if a URL is pasted.\n\t\tif ( ! isCollapsed( currentRecord ) ) {\n\t\t\tconst trimmedText = ( pastedHtml || pastedText )\n\t\t\t\t.replace( /<[^>]+>/g, '' )\n\t\t\t\t.trim();\n\n\t\t\t// A URL was pasted, turn the selection into a link.\n\t\t\tif ( isURL( trimmedText ) ) {\n\t\t\t\tconst linkedRecord = applyFormat( currentRecord, {\n\t\t\t\t\ttype: 'a',\n\t\t\t\t\tattributes: {\n\t\t\t\t\t\thref: decodeEntities( trimmedText ),\n\t\t\t\t\t},\n\t\t\t\t} );\n\t\t\t\tthis.value = this.valueToFormat( linkedRecord );\n\t\t\t\tonChange( this.value );\n\n\t\t\t\t// Allows us to ask for this information when we get a report.\n\t\t\t\twindow.console.log( 'Created link:\\n\\n', trimmedText );\n\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tif ( onPaste ) {\n\t\t\tonPaste( {\n\t\t\t\tvalue: currentRecord,\n\t\t\t\tonChange: this.onFormatChange,\n\t\t\t\thtml: pastedHtml,\n\t\t\t\tplainText: pastedText,\n\t\t\t\tfiles,\n\t\t\t\tactiveFormats,\n\t\t\t} );\n\t\t}\n\t}\n\n\tonFocus() {\n\t\tthis.isTouched = true;\n\n\t\tconst { unstableOnFocus, onSelectionChange } = this.props;\n\n\t\tif ( unstableOnFocus ) {\n\t\t\tunstableOnFocus();\n\t\t}\n\n\t\t// We know for certain that on focus, the old selection is invalid. It\n\t\t// will be recalculated on `selectionchange`.\n\n\t\tonSelectionChange( this.selectionStart, this.selectionEnd );\n\n\t\tthis.lastAztecEventType = 'focus';\n\t}\n\n\tonBlur( event ) {\n\t\tthis.isTouched = false;\n\n\t\t// Check if value is up to date with latest state of native AztecView.\n\t\tif (\n\t\t\tevent.nativeEvent.text &&\n\t\t\tevent.nativeEvent.text !== this.props.value?.toString()\n\t\t) {\n\t\t\tthis.onTextUpdate( event );\n\t\t}\n\n\t\tif ( this.props.onBlur ) {\n\t\t\tthis.props.onBlur( event );\n\t\t}\n\n\t\tthis.lastAztecEventType = 'blur';\n\t}\n\n\tonSelectionChange( start, end ) {\n\t\tconst hasChanged =\n\t\t\tthis.selectionStart !== start || this.selectionEnd !== end;\n\n\t\tthis.selectionStart = start;\n\t\tthis.selectionEnd = end;\n\n\t\t// This is a manual selection change event if onChange was not triggered just before\n\t\t// and we did not just trigger a text update\n\t\t// `onChange` could be the last event and could have been triggered a long time ago so\n\t\t// this approach is not perfectly reliable.\n\t\tconst isManual =\n\t\t\tthis.lastAztecEventType !== 'input' &&\n\t\t\tthis.props.value?.toString() === this.value?.toString();\n\t\tif ( hasChanged && isManual ) {\n\t\t\tconst value = this.createRecord();\n\t\t\tconst activeFormats = getActiveFormats( value );\n\t\t\tthis.setState( { activeFormats } );\n\t\t}\n\n\t\tthis.props.onSelectionChange( start, end );\n\t}\n\n\tshouldDropEventFromAztec( event, logText ) {\n\t\tconst shouldDrop =\n\t\t\t! this.isIOS && event.nativeEvent.eventCount <= this.lastEventCount;\n\t\tif ( shouldDrop ) {\n\t\t\twindow.console.log(\n\t\t\t\t`Dropping ${ logText } from Aztec as its event counter is older than latest sent to the native side. Got ${ event.nativeEvent.eventCount } but lastEventCount is ${ this.lastEventCount }.`\n\t\t\t);\n\t\t}\n\t\treturn shouldDrop;\n\t}\n\n\t/**\n\t * Determines whether the text input should receive focus after an update.\n\t * For cases where a RichText with a value is merged with an empty one.\n\t *\n\t * @param {Object} prevProps - The previous props of the component.\n\t * @return {boolean} True if the text input should receive focus, false otherwise.\n\t */\n\tshouldFocusTextInputAfterMerge( prevProps ) {\n\t\tconst {\n\t\t\t__unstableIsSelected: isSelected,\n\t\t\tblockIsSelected,\n\t\t\tselectionStart,\n\t\t\tselectionEnd,\n\t\t\t__unstableMobileNoFocusOnMount,\n\t\t} = this.props;\n\n\t\tconst {\n\t\t\t__unstableIsSelected: prevIsSelected,\n\t\t\tblockIsSelected: prevBlockIsSelected,\n\t\t} = prevProps;\n\n\t\tconst noSelectionValues =\n\t\t\tselectionStart === undefined && selectionEnd === undefined;\n\t\tconst textInputWasNotFocused = ! prevIsSelected && ! isSelected;\n\n\t\treturn (\n\t\t\t! __unstableMobileNoFocusOnMount &&\n\t\t\tnoSelectionValues &&\n\t\t\ttextInputWasNotFocused &&\n\t\t\t! prevBlockIsSelected &&\n\t\t\tblockIsSelected\n\t\t);\n\t}\n\n\tonSelectionChangeFromAztec( start, end, text, event ) {\n\t\tif ( this.shouldDropEventFromAztec( event, 'onSelectionChange' ) ) {\n\t\t\treturn;\n\t\t}\n\n\t\t// `end` can be less than `start` on iOS\n\t\t// Let's fix that here so `rich-text/slice` can work properly.\n\t\tconst realStart = Math.min( start, end );\n\t\tconst realEnd = Math.max( start, end );\n\n\t\t// Check and dicsard stray event, where the text and selection is equal to the ones already cached.\n\t\tconst contentWithoutRootTag = this.removeRootTagsProducedByAztec(\n\t\t\tevent.nativeEvent.text\n\t\t);\n\t\tif (\n\t\t\tcontentWithoutRootTag === this.value?.toString() &&\n\t\t\trealStart === this.selectionStart &&\n\t\t\trealEnd === this.selectionEnd\n\t\t) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.comesFromAztec = true;\n\t\tthis.firedAfterTextChanged = true; // Selection change event always fires after the fact.\n\n\t\t// Update text before updating selection\n\t\t// Make sure there are changes made to the content before upgrading it upward.\n\t\tthis.onTextUpdate( event );\n\n\t\t// Aztec can send us selection change events after it has lost focus.\n\t\t// For instance the autocorrect feature will complete a partially written\n\t\t// word when resigning focus, causing a selection change event.\n\t\t// Forwarding this selection change could cause this RichText to regain\n\t\t// focus and start a focus loop.\n\t\t//\n\t\t// See https://github.com/wordpress-mobile/gutenberg-mobile/issues/1696\n\t\tif ( this.props.__unstableIsSelected ) {\n\t\t\tthis.onSelectionChange( realStart, realEnd );\n\t\t}\n\t\t// Update lastEventCount to prevent Aztec from re-rendering the content it just sent.\n\t\tthis.lastEventCount = event.nativeEvent.eventCount;\n\n\t\tthis.lastAztecEventType = 'selection change';\n\t}\n\n\tisEmpty() {\n\t\treturn isEmpty( this.formatToValue( this.props.value ) );\n\t}\n\n\tformatToValue( value ) {\n\t\tconst { preserveWhiteSpace } = this.props;\n\t\t// Handle deprecated `children` and `node` sources.\n\t\tif ( Array.isArray( value ) ) {\n\t\t\treturn create( {\n\t\t\t\thtml: childrenBlock.toHTML( value ),\n\t\t\t\tpreserveWhiteSpace,\n\t\t\t} );\n\t\t}\n\n\t\tif ( this.props.format === 'string' ) {\n\t\t\treturn create( {\n\t\t\t\thtml: value,\n\t\t\t\tpreserveWhiteSpace,\n\t\t\t} );\n\t\t}\n\n\t\t// Guard for blocks passing `null` in onSplit callbacks. May be removed\n\t\t// if onSplit is revised to not pass a `null` value.\n\t\tif ( value === null ) {\n\t\t\treturn create();\n\t\t}\n\n\t\treturn value;\n\t}\n\n\tmanipulateEventCounterToForceNativeToRefresh() {\n\t\tif ( this.isIOS ) {\n\t\t\tthis.lastEventCount = undefined;\n\t\t\treturn;\n\t\t}\n\n\t\tif ( typeof this.lastEventCount !== 'undefined' ) {\n\t\t\tthis.lastEventCount += 100; // bump by a hundred, hopefully native hasn't bombarded the JS side in the meantime.\n\t\t} // no need to bump when 'undefined' as native side won't receive the key when the value is undefined, and that will cause force updating anyway,\n\t\t//   see https://github.com/WordPress/gutenberg/blob/82e578dcc75e67891c750a41a04c1e31994192fc/packages/react-native-aztec/android/src/main/java/org/wordpress/mobile/ReactNativeAztec/ReactAztecManager.java#L213-L215\n\t}\n\n\tshouldComponentUpdate( nextProps, nextState ) {\n\t\tif (\n\t\t\tnextProps.tagName !== this.props.tagName ||\n\t\t\tnextProps.reversed !== this.props.reversed ||\n\t\t\tnextProps.start !== this.props.start\n\t\t) {\n\t\t\tthis.manipulateEventCounterToForceNativeToRefresh(); // force a refresh on the native side\n\t\t\tthis.value = undefined;\n\t\t\treturn true;\n\t\t}\n\n\t\t// TODO: Please re-introduce the check to avoid updating the content right after an `onChange` call.\n\t\t// It was removed in https://github.com/WordPress/gutenberg/pull/12417 to fix undo/redo problem.\n\n\t\t// If the component is changed React side (undo/redo/merging/splitting/custom text actions)\n\t\t// we need to make sure the native is updated as well.\n\n\t\t// Also, don't trust the \"this.lastContent\" as on Android, incomplete text events arrive\n\t\t//  with only some of the text, while the virtual keyboard's suggestion system does its magic.\n\t\t// ** compare with this.lastContent for optimizing performance by not forcing Aztec with text it already has\n\t\t// , but compare with props.value to not lose \"half word\" text because of Android virtual keyb autosuggestion behavior\n\t\tif (\n\t\t\ttypeof nextProps.value !== 'undefined' &&\n\t\t\ttypeof this.props.value !== 'undefined' &&\n\t\t\t( ! this.comesFromAztec || ! this.firedAfterTextChanged ) &&\n\t\t\tnextProps.value?.toString() !== this.props.value?.toString()\n\t\t) {\n\t\t\t// Gutenberg seems to try to mirror the caret state even on events that only change the content so,\n\t\t\t//  let's force caret update if state has selection set.\n\t\t\tif (\n\t\t\t\ttypeof nextProps.selectionStart !== 'undefined' &&\n\t\t\t\ttypeof nextProps.selectionEnd !== 'undefined'\n\t\t\t) {\n\t\t\t\tthis.needsSelectionUpdate = true;\n\t\t\t}\n\n\t\t\tthis.manipulateEventCounterToForceNativeToRefresh(); // force a refresh on the native side\n\t\t}\n\n\t\tif ( ! this.comesFromAztec ) {\n\t\t\tif (\n\t\t\t\ttypeof nextProps.selectionStart !== 'undefined' &&\n\t\t\t\ttypeof nextProps.selectionEnd !== 'undefined' &&\n\t\t\t\tnextProps.selectionStart !== this.props.selectionStart &&\n\t\t\t\tnextProps.selectionStart !== this.selectionStart &&\n\t\t\t\tnextProps.__unstableIsSelected\n\t\t\t) {\n\t\t\t\tthis.needsSelectionUpdate = true;\n\t\t\t\tthis.manipulateEventCounterToForceNativeToRefresh(); // force a refresh on the native side\n\t\t\t}\n\n\t\t\t// For font size changes from a prop value a force refresh\n\t\t\t// is needed without the selection update.\n\t\t\tif ( nextProps?.fontSize !== this.props?.fontSize ) {\n\t\t\t\tthis.manipulateEventCounterToForceNativeToRefresh(); // force a refresh on the native side\n\t\t\t}\n\n\t\t\tif (\n\t\t\t\t( nextProps?.style?.fontSize !== this.props?.style?.fontSize &&\n\t\t\t\t\tnextState.currentFontSize !==\n\t\t\t\t\t\tthis.state.currentFontSize ) ||\n\t\t\t\tnextState.currentFontSize !== this.state.currentFontSize ||\n\t\t\t\tnextProps?.style?.lineHeight !== this.props?.style?.lineHeight\n\t\t\t) {\n\t\t\t\tthis.needsSelectionUpdate = true;\n\t\t\t\tthis.manipulateEventCounterToForceNativeToRefresh(); // force a refresh on the native side\n\t\t\t}\n\t\t}\n\n\t\treturn true;\n\t}\n\n\tcomponentDidMount() {\n\t\t// Request focus if wrapping block is selected and parent hasn't inhibited the focus request. This method of focusing\n\t\t//  is trying to implement the web-side counterpart of BlockList's `focusTabbable` where the BlockList is focusing an\n\t\t//  inputbox by searching the DOM. We don't have the DOM in RN so, using the combination of blockIsSelected and __unstableMobileNoFocusOnMount\n\t\t//  to determine if we should focus the RichText.\n\t\tif (\n\t\t\tthis.props.blockIsSelected &&\n\t\t\t! this.props.__unstableMobileNoFocusOnMount\n\t\t) {\n\t\t\tthis._editor.focus();\n\t\t\tthis.onSelectionChange(\n\t\t\t\tthis.props.selectionStart || 0,\n\t\t\t\tthis.props.selectionEnd || 0\n\t\t\t);\n\t\t}\n\t}\n\n\tcomponentDidUpdate( prevProps ) {\n\t\tconst { style, tagName } = this.props;\n\t\tconst { currentFontSize } = this.state;\n\n\t\tif ( this.props.value?.toString() !== this.value?.toString() ) {\n\t\t\tthis.value = this.props.value;\n\t\t}\n\t\tconst { __unstableIsSelected: prevIsSelected } = prevProps;\n\t\tconst { __unstableIsSelected: isSelected } = this.props;\n\n\t\tif ( isSelected && ! prevIsSelected ) {\n\t\t\tthis._editor.focus();\n\t\t\t// Update selection props explicitly when component is selected as Aztec won't call onSelectionChange\n\t\t\t// if its internal value hasn't change. When created, default value is 0, 0.\n\t\t\tthis.onSelectionChange(\n\t\t\t\tthis.props.selectionStart || 0,\n\t\t\t\tthis.props.selectionEnd || 0\n\t\t\t);\n\t\t} else if ( this.shouldFocusTextInputAfterMerge( prevProps ) ) {\n\t\t\t// Since this is happening when merging blocks, the selection should be at the last character position.\n\t\t\t// As a fallback the internal selectionEnd value is used.\n\t\t\tconst lastCharacterPosition =\n\t\t\t\tthis.value?.toString().length ?? this.selectionEnd;\n\t\t\tthis._editor.focus();\n\t\t\tthis.props.onSelectionChange(\n\t\t\t\tlastCharacterPosition,\n\t\t\t\tlastCharacterPosition\n\t\t\t);\n\t\t} else if ( ! isSelected && prevIsSelected ) {\n\t\t\tthis._editor.blur();\n\t\t}\n\n\t\t// For font size values changes from the font size picker\n\t\t// we compare previous values to refresh the selected font size,\n\t\t// this is also used when the tag name changes\n\t\t// e.g Heading block and a level change like h1->h2.\n\t\tconst currentFontSizeStyle = this.getParsedFontSize( style?.fontSize );\n\t\tconst prevFontSizeStyle = this.getParsedFontSize(\n\t\t\tprevProps?.style?.fontSize\n\t\t);\n\t\tconst isDifferentTag = prevProps.tagName !== tagName;\n\t\tif (\n\t\t\t( currentFontSize &&\n\t\t\t\t( currentFontSizeStyle || prevFontSizeStyle ) &&\n\t\t\t\tcurrentFontSizeStyle !== currentFontSize ) ||\n\t\t\tisDifferentTag\n\t\t) {\n\t\t\tthis.setState( {\n\t\t\t\tcurrentFontSize: this.getFontSize( this.props ),\n\t\t\t} );\n\t\t}\n\t}\n\n\tgetHtmlToRender( record, tagName ) {\n\t\t// Save back to HTML from React tree.\n\t\tlet value = this.valueToFormat( record );\n\n\t\tif ( value === undefined ) {\n\t\t\tthis.manipulateEventCounterToForceNativeToRefresh(); // force a refresh on the native side\n\t\t\tvalue = '';\n\t\t}\n\t\t// On android if content is empty we need to send no content or else the placeholder will not show.\n\t\tif (\n\t\t\t! this.isIOS &&\n\t\t\t( value?.toString() === '' ||\n\t\t\t\tvalue?.toString() === EMPTY_PARAGRAPH_TAGS )\n\t\t) {\n\t\t\treturn '';\n\t\t}\n\n\t\tif ( tagName ) {\n\t\t\tlet extraAttributes = ``;\n\t\t\tif ( tagName === `ol` ) {\n\t\t\t\tif ( this.props.reversed ) {\n\t\t\t\t\textraAttributes += ` reversed`;\n\t\t\t\t}\n\t\t\t\tif ( this.props.start ) {\n\t\t\t\t\textraAttributes += ` start=${ this.props.start }`;\n\t\t\t\t}\n\t\t\t}\n\t\t\tvalue = `<${ tagName }${ extraAttributes }>${ value }</${ tagName }>`;\n\t\t}\n\t\treturn value;\n\t}\n\n\tgetEditableProps() {\n\t\treturn {\n\t\t\t// Overridable props.\n\t\t\tstyle: {},\n\t\t\tclassName: 'rich-text',\n\t\t\tonKeyDown: () => null,\n\t\t};\n\t}\n\n\tgetParsedFontSize( fontSize ) {\n\t\tconst { height, width } = Dimensions.get( 'window' );\n\t\tconst cssUnitOptions = { height, width, fontSize: DEFAULT_FONT_SIZE };\n\n\t\tif ( ! fontSize ) {\n\t\t\treturn fontSize;\n\t\t}\n\n\t\tconst selectedPxValue =\n\t\t\tgetPxFromCssUnit( fontSize, cssUnitOptions ) ?? DEFAULT_FONT_SIZE;\n\n\t\treturn parseFloat( selectedPxValue );\n\t}\n\n\tgetFontSize( props ) {\n\t\tconst { baseGlobalStyles, tagName, fontSize, style } = props;\n\t\tconst tagNameFontSize =\n\t\t\tbaseGlobalStyles?.elements?.[ tagName ]?.typography?.fontSize;\n\n\t\tlet newFontSize = DEFAULT_FONT_SIZE;\n\n\t\t// Disables line-height rendering for pre elements until we fix some issues with AztecAndroid.\n\t\tif ( tagName === 'pre' && ! this.isIOS ) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\t// For block-based themes, get the default editor font size.\n\t\tif ( baseGlobalStyles?.typography?.fontSize && tagName === 'p' ) {\n\t\t\tnewFontSize = baseGlobalStyles?.typography?.fontSize;\n\t\t}\n\n\t\t// For block-based themes, get the default element font size\n\t\t// e.g h1, h2.\n\t\tif ( tagNameFontSize ) {\n\t\t\tnewFontSize = tagNameFontSize;\n\t\t}\n\n\t\t// For font size values provided from the styles,\n\t\t// usually from values set from the font size picker.\n\t\tif ( style?.fontSize ) {\n\t\t\tnewFontSize = style.fontSize;\n\t\t}\n\n\t\t// Fall-back to a font size provided from its props (if there's any)\n\t\t// and there are no other default values to use.\n\t\tif ( fontSize && ! tagNameFontSize && ! style?.fontSize ) {\n\t\t\tnewFontSize = fontSize;\n\t\t}\n\n\t\t// We need to always convert to px units because the selected value\n\t\t// could be coming from the web where it could be stored as a different unit.\n\t\tconst selectedPxValue = this.getParsedFontSize( newFontSize );\n\n\t\treturn selectedPxValue;\n\t}\n\n\tgetLineHeight() {\n\t\tconst { baseGlobalStyles, tagName, lineHeight, style } = this.props;\n\t\tconst tagNameLineHeight =\n\t\t\tbaseGlobalStyles?.elements?.[ tagName ]?.typography?.lineHeight;\n\t\tlet newLineHeight;\n\n\t\t// Disables line-height rendering for pre elements until we fix some issues with AztecAndroid.\n\t\tif ( tagName === 'pre' && ! this.isIOS ) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\tif ( ! this.getIsBlockBasedTheme() ) {\n\t\t\treturn;\n\t\t}\n\n\t\t// For block-based themes, get the default editor line height.\n\t\tif ( baseGlobalStyles?.typography?.lineHeight && tagName === 'p' ) {\n\t\t\tnewLineHeight = parseFloat(\n\t\t\t\tbaseGlobalStyles?.typography?.lineHeight\n\t\t\t);\n\t\t}\n\n\t\t// For block-based themes, get the default element line height\n\t\t// e.g h1, h2.\n\t\tif ( tagNameLineHeight ) {\n\t\t\tnewLineHeight = parseFloat( tagNameLineHeight );\n\t\t}\n\n\t\t// For line height values provided from the styles,\n\t\t// usually from values set from the line height picker.\n\t\tif ( style?.lineHeight ) {\n\t\t\tnewLineHeight = parseFloat( style.lineHeight );\n\t\t}\n\n\t\t// Fall-back to a line height provided from its props (if there's any)\n\t\t// and there are no other default values to use.\n\t\tif ( lineHeight && ! tagNameLineHeight && ! style?.lineHeight ) {\n\t\t\tnewLineHeight = lineHeight;\n\t\t}\n\n\t\t// Check the final value is not over the minimum supported value.\n\t\tif ( newLineHeight && newLineHeight < MIN_LINE_HEIGHT ) {\n\t\t\tnewLineHeight = MIN_LINE_HEIGHT;\n\t\t}\n\n\t\t// Until we parse CSS values correctly, avoid passing NaN values to Aztec\n\t\tif ( isNaN( newLineHeight ) ) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\treturn newLineHeight;\n\t}\n\n\tgetIsBlockBasedTheme() {\n\t\tconst { baseGlobalStyles } = this.props;\n\n\t\treturn (\n\t\t\tbaseGlobalStyles && Object.entries( baseGlobalStyles ).length !== 0\n\t\t);\n\t}\n\n\tgetBlockUseDefaultFont() {\n\t\t// For block-based themes it enables using the defaultFont\n\t\t// in Aztec for iOS so it allows customizing the font size\n\t\t// for the Preformatted/Code and Heading blocks.\n\t\tif ( ! this.isIOS ) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst { tagName } = this.props;\n\t\tconst isBlockBasedTheme = this.getIsBlockBasedTheme();\n\t\tconst tagsToMatch = /pre|h([1-6])$/gm;\n\n\t\treturn isBlockBasedTheme && tagsToMatch.test( tagName );\n\t}\n\n\tgetLinkTextColor( defaultColor ) {\n\t\tconst { style } = this.props;\n\t\tconst customColor = style?.linkColor && colord( style.linkColor );\n\n\t\treturn customColor && customColor.isValid()\n\t\t\t? customColor.toHex()\n\t\t\t: defaultColor;\n\t}\n\n\tgetPlaceholderTextColor() {\n\t\tconst {\n\t\t\tbaseGlobalStyles,\n\t\t\tgetStylesFromColorScheme,\n\t\t\tplaceholderTextColor,\n\t\t\tstyle,\n\t\t} = this.props;\n\n\t\t// Default placeholder text color.\n\t\tconst placeholderStyle = getStylesFromColorScheme(\n\t\t\tstyles.richTextPlaceholder,\n\t\t\tstyles.richTextPlaceholderDark\n\t\t);\n\t\tconst { color: defaultPlaceholderTextColor } = placeholderStyle;\n\t\t// Custom 63% opacity for theme and inherited colors.\n\t\tconst placeholderOpacity = 'A1';\n\n\t\t// Determine inherited placeholder color if available.\n\t\tconst inheritPlaceholderColor = style?.placeholderColor\n\t\t\t? `${ style.placeholderColor }${ placeholderOpacity }`\n\t\t\t: undefined;\n\n\t\t// If using block-based themes, derive the placeholder color from global styles.\n\t\tconst globalStylesPlaceholderColor = baseGlobalStyles?.color?.text\n\t\t\t? `${ baseGlobalStyles.color.text }${ placeholderOpacity }`\n\t\t\t: undefined;\n\n\t\treturn (\n\t\t\tinheritPlaceholderColor ??\n\t\t\tplaceholderTextColor ??\n\t\t\tglobalStylesPlaceholderColor ??\n\t\t\tdefaultPlaceholderTextColor\n\t\t);\n\t}\n\n\trender() {\n\t\tconst {\n\t\t\ttagName,\n\t\t\tstyle,\n\t\t\t__unstableIsSelected: isSelected,\n\t\t\tchildren,\n\t\t\tgetStylesFromColorScheme,\n\t\t\tminWidth,\n\t\t\tmaxWidth,\n\t\t\tformatTypes,\n\t\t\tparentBlockStyles,\n\t\t\taccessibilityLabel,\n\t\t\tdisableEditingMenu = false,\n\t\t\tbaseGlobalStyles,\n\t\t\tselectionStart,\n\t\t\tselectionEnd,\n\t\t\tdisableSuggestions,\n\t\t\tcontainerWidth,\n\t\t} = this.props;\n\t\tconst { currentFontSize } = this.state;\n\n\t\tconst record = this.getRecord();\n\t\tconst html = this.getHtmlToRender( record, tagName );\n\t\tconst editableProps = this.getEditableProps();\n\t\tconst blockUseDefaultFont = this.getBlockUseDefaultFont();\n\n\t\tconst fontSize = currentFontSize;\n\t\tconst lineHeight = this.getLineHeight();\n\n\t\tconst {\n\t\t\tcolor: defaultColor,\n\t\t\ttextDecorationColor: defaultTextDecorationColor,\n\t\t\tfontFamily: defaultFontFamily,\n\t\t} = getStylesFromColorScheme( styles.richText, styles.richTextDark );\n\t\tconst linkTextColor = this.getLinkTextColor(\n\t\t\tdefaultTextDecorationColor\n\t\t);\n\n\t\tconst currentSelectionStart = selectionStart ?? 0;\n\t\tconst currentSelectionEnd = selectionEnd ?? 0;\n\t\tlet selection = null;\n\t\tif ( this.needsSelectionUpdate ) {\n\t\t\tthis.needsSelectionUpdate = false;\n\t\t\tselection = {\n\t\t\t\tstart: currentSelectionStart,\n\t\t\t\tend: currentSelectionEnd,\n\t\t\t};\n\n\t\t\t// On AztecAndroid, setting the caret to an out-of-bounds position will crash the editor so, let's check for some cases.\n\t\t\tif ( ! this.isIOS ) {\n\t\t\t\t// The following regular expression is used in Aztec here:\n\t\t\t\t// https://github.com/wordpress-mobile/AztecEditor-Android/blob/b1fad439d56fa6d4aa0b78526fef355c59d00dd3/aztec/src/main/kotlin/org/wordpress/aztec/AztecParser.kt#L656\n\t\t\t\tconst brBeforeParaMatches = html.match( /(<br>)+<\\/p>$/g );\n\t\t\t\tif ( brBeforeParaMatches ) {\n\t\t\t\t\tconsole.warn(\n\t\t\t\t\t\t'Oops, BR tag(s) at the end of content. Aztec will remove them, adapting the selection...'\n\t\t\t\t\t);\n\t\t\t\t\tconst count = (\n\t\t\t\t\t\tbrBeforeParaMatches[ 0 ].match( /br/g ) || []\n\t\t\t\t\t).length;\n\t\t\t\t\tif ( count > 0 ) {\n\t\t\t\t\t\tlet newSelectionStart = currentSelectionStart - count;\n\t\t\t\t\t\tif ( newSelectionStart < 0 ) {\n\t\t\t\t\t\t\tnewSelectionStart = 0;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tlet newSelectionEnd = currentSelectionEnd - count;\n\t\t\t\t\t\tif ( newSelectionEnd < 0 ) {\n\t\t\t\t\t\t\tnewSelectionEnd = 0;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tselection = {\n\t\t\t\t\t\t\tstart: newSelectionStart,\n\t\t\t\t\t\t\tend: newSelectionEnd,\n\t\t\t\t\t\t};\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif ( this.comesFromAztec ) {\n\t\t\tthis.comesFromAztec = false;\n\t\t\tthis.firedAfterTextChanged = false;\n\t\t}\n\n\t\t// Logic below assures that `RichText` width will always have equal value when container is almost fully filled.\n\t\tconst width =\n\t\t\tmaxWidth && this.state.width && maxWidth - this.state.width < 10\n\t\t\t\t? maxWidth\n\t\t\t\t: this.state.width;\n\t\tconst containerStyles = [\n\t\t\tstyle?.padding &&\n\t\t\t\tstyle?.backgroundColor && {\n\t\t\t\t\tpadding: style.padding,\n\t\t\t\t\tbackgroundColor: style.backgroundColor,\n\t\t\t\t},\n\t\t\tcontainerWidth && {\n\t\t\t\twidth: containerWidth,\n\t\t\t},\n\t\t];\n\n\t\tconst defaultSelectionColor = getStylesFromColorScheme(\n\t\t\tstyles[ 'rich-text-selection' ],\n\t\t\tstyles[ 'rich-text-selection--dark' ]\n\t\t).color;\n\t\tconst selectionColor = getSelectionColor(\n\t\t\tthis.props.selectionColor,\n\t\t\tdefaultSelectionColor,\n\t\t\tbaseGlobalStyles,\n\t\t\tthis.getIsBlockBasedTheme()\n\t\t);\n\n\t\tconst EditableView = ( props ) => {\n\t\t\tthis.customEditableOnKeyDown = props?.onKeyDown;\n\n\t\t\treturn <></>;\n\t\t};\n\n\t\treturn (\n\t\t\t<View style={ containerStyles }>\n\t\t\t\t{ children &&\n\t\t\t\t\tchildren( {\n\t\t\t\t\t\tisSelected,\n\t\t\t\t\t\tvalue: record,\n\t\t\t\t\t\tonChange: this.onFormatChange,\n\t\t\t\t\t\tonFocus: () => {},\n\t\t\t\t\t\teditableProps,\n\t\t\t\t\t\teditableTagName: EditableView,\n\t\t\t\t\t} ) }\n\t\t\t\t<RCTAztecView\n\t\t\t\t\taccessibilityLabel={ accessibilityLabel }\n\t\t\t\t\tref={ ( ref ) => {\n\t\t\t\t\t\tthis._editor = ref;\n\n\t\t\t\t\t\tif ( this.props.setRef ) {\n\t\t\t\t\t\t\tthis.props.setRef( ref );\n\t\t\t\t\t\t}\n\t\t\t\t\t} }\n\t\t\t\t\tstyle={ {\n\t\t\t\t\t\tbackgroundColor: styles.richText.backgroundColor,\n\t\t\t\t\t\t...style,\n\t\t\t\t\t\t...( this.isIOS && minWidth && maxWidth\n\t\t\t\t\t\t\t? { width }\n\t\t\t\t\t\t\t: { maxWidth } ),\n\t\t\t\t\t\tminHeight: this.state.height,\n\t\t\t\t\t} }\n\t\t\t\t\tblockUseDefaultFont={ blockUseDefaultFont }\n\t\t\t\t\ttext={ {\n\t\t\t\t\t\ttext: html,\n\t\t\t\t\t\teventCount: this.lastEventCount,\n\t\t\t\t\t\tselection,\n\t\t\t\t\t\tlinkTextColor,\n\t\t\t\t\t\ttag: tagName,\n\t\t\t\t\t} }\n\t\t\t\t\tplaceholder={ this.props.placeholder }\n\t\t\t\t\tplaceholderTextColor={ this.getPlaceholderTextColor() }\n\t\t\t\t\tdeleteEnter={ this.props.deleteEnter }\n\t\t\t\t\tonChange={ this.onChangeFromAztec }\n\t\t\t\t\tonFocus={ this.onFocus }\n\t\t\t\t\tonBlur={ this.onBlur }\n\t\t\t\t\tonKeyDown={ this.onKeyDown }\n\t\t\t\t\ttriggerKeyCodes={\n\t\t\t\t\t\tdisableEditingMenu\n\t\t\t\t\t\t\t? []\n\t\t\t\t\t\t\t: this.suggestionOptions().map(\n\t\t\t\t\t\t\t\t\t( op ) => op.triggerChar\n\t\t\t\t\t\t\t  )\n\t\t\t\t\t}\n\t\t\t\t\tonPaste={ this.onPaste }\n\t\t\t\t\tactiveFormats={ this.getActiveFormatNames( record ) }\n\t\t\t\t\tonContentSizeChange={ this.onContentSizeChange }\n\t\t\t\t\tonSelectionChange={ this.onSelectionChangeFromAztec }\n\t\t\t\t\tblockType={ { tag: tagName } }\n\t\t\t\t\tcolor={\n\t\t\t\t\t\t( style && style.color ) ||\n\t\t\t\t\t\t( parentBlockStyles && parentBlockStyles.color ) ||\n\t\t\t\t\t\t( baseGlobalStyles && baseGlobalStyles?.color?.text ) ||\n\t\t\t\t\t\tdefaultColor\n\t\t\t\t\t}\n\t\t\t\t\tmaxImagesWidth={ 200 }\n\t\t\t\t\tfontFamily={ this.props.fontFamily || defaultFontFamily }\n\t\t\t\t\tfontSize={ fontSize }\n\t\t\t\t\tlineHeight={ lineHeight }\n\t\t\t\t\tfontWeight={ this.props.fontWeight }\n\t\t\t\t\tfontStyle={ this.props.fontStyle }\n\t\t\t\t\tdisableEditingMenu={ disableEditingMenu }\n\t\t\t\t\tisMultiline={ false }\n\t\t\t\t\ttextAlign={ this.props.textAlign }\n\t\t\t\t\t{ ...( this.isIOS ? { maxWidth } : {} ) }\n\t\t\t\t\tminWidth={ minWidth }\n\t\t\t\t\tid={ this.props.id }\n\t\t\t\t\tselectionColor={ selectionColor }\n\t\t\t\t\tdisableAutocorrection={ this.props.disableAutocorrection }\n\t\t\t\t/>\n\t\t\t\t{ isSelected && (\n\t\t\t\t\t<>\n\t\t\t\t\t\t<FormatEdit\n\t\t\t\t\t\t\tforwardedRef={ this._editor }\n\t\t\t\t\t\t\tformatTypes={ formatTypes }\n\t\t\t\t\t\t\tvalue={ record }\n\t\t\t\t\t\t\tonChange={ this.onFormatChange }\n\t\t\t\t\t\t\tonFocus={ () => {} }\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t{ ! disableSuggestions && (\n\t\t\t\t\t\t\t<BlockFormatControls>\n\t\t\t\t\t\t\t\t<ToolbarButtonWithOptions\n\t\t\t\t\t\t\t\t\toptions={ this.suggestionOptions() }\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</BlockFormatControls>\n\t\t\t\t\t\t) }\n\t\t\t\t\t</>\n\t\t\t\t) }\n\t\t\t</View>\n\t\t);\n\t}\n}\n\nRichText.defaultProps = {\n\tformat: 'string',\n\tvalue: '',\n\ttagName: 'div',\n};\n\nconst withFormatTypes = ( WrappedComponent ) => ( props ) => {\n\tconst {\n\t\tclientId,\n\t\tidentifier,\n\t\twithoutInteractiveFormatting,\n\t\tallowedFormats,\n\t} = props;\n\tconst { formatTypes } = useFormatTypes( {\n\t\tclientId,\n\t\tidentifier,\n\t\twithoutInteractiveFormatting,\n\t\tallowedFormats,\n\t} );\n\n\treturn <WrappedComponent { ...props } formatTypes={ formatTypes } />;\n};\n\nexport default compose( [\n\twithSelect( ( select, { clientId } ) => {\n\t\tconst { getBlockParents, getBlock, getSettings } =\n\t\t\tselect( 'core/block-editor' );\n\t\tconst parents = getBlockParents( clientId, true );\n\t\tconst parentBlock = parents ? getBlock( parents[ 0 ] ) : undefined;\n\t\tconst parentBlockStyles = parentBlock?.attributes?.childrenStyles;\n\n\t\tconst settings = getSettings();\n\t\tconst baseGlobalStyles = settings?.__experimentalGlobalStylesBaseStyles;\n\n\t\tconst colorPalettes = settings?.__experimentalFeatures?.color?.palette;\n\t\tconst colorPalette = colorPalettes\n\t\t\t? flatColorPalettes( colorPalettes )\n\t\t\t: settings?.colors;\n\n\t\treturn {\n\t\t\tareMentionsSupported: settings?.capabilities?.mentions === true,\n\t\t\tareXPostsSupported: settings?.capabilities?.xposts === true,\n\t\t\tparentBlockStyles,\n\t\t\tbaseGlobalStyles,\n\t\t\tcolorPalette,\n\t\t};\n\t} ),\n\twithPreferredColorScheme,\n\twithFormatTypes,\n] )( RichText );\n"],"mappings":"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"}