{"version":3,"names":["ref","valRef","proxyMap","useMemo","isShallowEqual","SlotFillContext","createSlotRegistry","slots","fills","registerSlot","name","fillProps","slot","get","set","unregisterSlot","delete","updateSlot","slotFills","forEach","fill","current","rerender","registerFill","unregisterFill","fillsForName","filter","fillRef","SlotFillProvider","children","registry","createElement","Provider","value"],"sources":["@wordpress/components/src/slot-fill/bubbles-virtually/slot-fill-provider.tsx"],"sourcesContent":["/**\n * External dependencies\n */\nimport { ref as valRef } from 'valtio';\nimport { proxyMap } from 'valtio/utils';\n\n/**\n * WordPress dependencies\n */\nimport { useMemo } from '@wordpress/element';\nimport isShallowEqual from '@wordpress/is-shallow-equal';\n\n/**\n * Internal dependencies\n */\nimport SlotFillContext from './slot-fill-context';\nimport type {\n\tSlotFillProviderProps,\n\tSlotFillBubblesVirtuallyContext,\n} from '../types';\n\nfunction createSlotRegistry(): SlotFillBubblesVirtuallyContext {\n\tconst slots: SlotFillBubblesVirtuallyContext[ 'slots' ] = proxyMap();\n\tconst fills: SlotFillBubblesVirtuallyContext[ 'fills' ] = proxyMap();\n\n\tconst registerSlot: SlotFillBubblesVirtuallyContext[ 'registerSlot' ] = (\n\t\tname,\n\t\tref,\n\t\tfillProps\n\t) => {\n\t\tconst slot = slots.get( name );\n\n\t\tslots.set(\n\t\t\tname,\n\t\t\tvalRef( {\n\t\t\t\t...slot,\n\t\t\t\tref: ref || slot?.ref,\n\t\t\t\tfillProps: fillProps || slot?.fillProps || {},\n\t\t\t} )\n\t\t);\n\t};\n\n\tconst unregisterSlot: SlotFillBubblesVirtuallyContext[ 'unregisterSlot' ] =\n\t\t( name, ref ) => {\n\t\t\t// Make sure we're not unregistering a slot registered by another element\n\t\t\t// See https://github.com/WordPress/gutenberg/pull/19242#issuecomment-590295412\n\t\t\tif ( slots.get( name )?.ref === ref ) {\n\t\t\t\tslots.delete( name );\n\t\t\t}\n\t\t};\n\n\tconst updateSlot: SlotFillBubblesVirtuallyContext[ 'updateSlot' ] = (\n\t\tname,\n\t\tfillProps\n\t) => {\n\t\tconst slot = slots.get( name );\n\t\tif ( ! slot ) {\n\t\t\treturn;\n\t\t}\n\n\t\tif ( isShallowEqual( slot.fillProps, fillProps ) ) {\n\t\t\treturn;\n\t\t}\n\n\t\tslot.fillProps = fillProps;\n\t\tconst slotFills = fills.get( name );\n\t\tif ( slotFills ) {\n\t\t\t// Force update fills.\n\t\t\tslotFills.forEach( ( fill ) => fill.current.rerender() );\n\t\t}\n\t};\n\n\tconst registerFill: SlotFillBubblesVirtuallyContext[ 'registerFill' ] = (\n\t\tname,\n\t\tref\n\t) => {\n\t\tfills.set( name, valRef( [ ...( fills.get( name ) || [] ), ref ] ) );\n\t};\n\n\tconst unregisterFill: SlotFillBubblesVirtuallyContext[ 'registerFill' ] = (\n\t\tname,\n\t\tref\n\t) => {\n\t\tconst fillsForName = fills.get( name );\n\t\tif ( ! fillsForName ) {\n\t\t\treturn;\n\t\t}\n\n\t\tfills.set(\n\t\t\tname,\n\t\t\tvalRef( fillsForName.filter( ( fillRef ) => fillRef !== ref ) )\n\t\t);\n\t};\n\n\treturn {\n\t\tslots,\n\t\tfills,\n\t\tregisterSlot,\n\t\tupdateSlot,\n\t\tunregisterSlot,\n\t\tregisterFill,\n\t\tunregisterFill,\n\t};\n}\n\nexport default function SlotFillProvider( {\n\tchildren,\n}: SlotFillProviderProps ) {\n\tconst registry = useMemo( createSlotRegistry, [] );\n\treturn (\n\t\t<SlotFillContext.Provider value={ registry }>\n\t\t\t{ children }\n\t\t</SlotFillContext.Provider>\n\t);\n}\n"],"mappings":";AAAA;AACA;AACA;AACA,SAASA,GAAG,IAAIC,MAAM,QAAQ,QAAQ;AACtC,SAASC,QAAQ,QAAQ,cAAc;;AAEvC;AACA;AACA;AACA,SAASC,OAAO,QAAQ,oBAAoB;AAC5C,OAAOC,cAAc,MAAM,6BAA6B;;AAExD;AACA;AACA;AACA,OAAOC,eAAe,MAAM,qBAAqB;AAMjD,SAASC,kBAAkBA,CAAA,EAAoC;EAC9D,MAAMC,KAAiD,GAAGL,QAAQ,CAAC,CAAC;EACpE,MAAMM,KAAiD,GAAGN,QAAQ,CAAC,CAAC;EAEpE,MAAMO,YAA+D,GAAGA,CACvEC,IAAI,EACJV,GAAG,EACHW,SAAS,KACL;IACJ,MAAMC,IAAI,GAAGL,KAAK,CAACM,GAAG,CAAEH,IAAK,CAAC;IAE9BH,KAAK,CAACO,GAAG,CACRJ,IAAI,EACJT,MAAM,CAAE;MACP,GAAGW,IAAI;MACPZ,GAAG,EAAEA,GAAG,IAAIY,IAAI,EAAEZ,GAAG;MACrBW,SAAS,EAAEA,SAAS,IAAIC,IAAI,EAAED,SAAS,IAAI,CAAC;IAC7C,CAAE,CACH,CAAC;EACF,CAAC;EAED,MAAMI,cAAmE,GACxEA,CAAEL,IAAI,EAAEV,GAAG,KAAM;IAChB;IACA;IACA,IAAKO,KAAK,CAACM,GAAG,CAAEH,IAAK,CAAC,EAAEV,GAAG,KAAKA,GAAG,EAAG;MACrCO,KAAK,CAACS,MAAM,CAAEN,IAAK,CAAC;IACrB;EACD,CAAC;EAEF,MAAMO,UAA2D,GAAGA,CACnEP,IAAI,EACJC,SAAS,KACL;IACJ,MAAMC,IAAI,GAAGL,KAAK,CAACM,GAAG,CAAEH,IAAK,CAAC;IAC9B,IAAK,CAAEE,IAAI,EAAG;MACb;IACD;IAEA,IAAKR,cAAc,CAAEQ,IAAI,CAACD,SAAS,EAAEA,SAAU,CAAC,EAAG;MAClD;IACD;IAEAC,IAAI,CAACD,SAAS,GAAGA,SAAS;IAC1B,MAAMO,SAAS,GAAGV,KAAK,CAACK,GAAG,CAAEH,IAAK,CAAC;IACnC,IAAKQ,SAAS,EAAG;MAChB;MACAA,SAAS,CAACC,OAAO,CAAIC,IAAI,IAAMA,IAAI,CAACC,OAAO,CAACC,QAAQ,CAAC,CAAE,CAAC;IACzD;EACD,CAAC;EAED,MAAMC,YAA+D,GAAGA,CACvEb,IAAI,EACJV,GAAG,KACC;IACJQ,KAAK,CAACM,GAAG,CAAEJ,IAAI,EAAET,MAAM,CAAE,CAAE,IAAKO,KAAK,CAACK,GAAG,CAAEH,IAAK,CAAC,IAAI,EAAE,CAAE,EAAEV,GAAG,CAAG,CAAE,CAAC;EACrE,CAAC;EAED,MAAMwB,cAAiE,GAAGA,CACzEd,IAAI,EACJV,GAAG,KACC;IACJ,MAAMyB,YAAY,GAAGjB,KAAK,CAACK,GAAG,CAAEH,IAAK,CAAC;IACtC,IAAK,CAAEe,YAAY,EAAG;MACrB;IACD;IAEAjB,KAAK,CAACM,GAAG,CACRJ,IAAI,EACJT,MAAM,CAAEwB,YAAY,CAACC,MAAM,CAAIC,OAAO,IAAMA,OAAO,KAAK3B,GAAI,CAAE,CAC/D,CAAC;EACF,CAAC;EAED,OAAO;IACNO,KAAK;IACLC,KAAK;IACLC,YAAY;IACZQ,UAAU;IACVF,cAAc;IACdQ,YAAY;IACZC;EACD,CAAC;AACF;AAEA,eAAe,SAASI,gBAAgBA,CAAE;EACzCC;AACsB,CAAC,EAAG;EAC1B,MAAMC,QAAQ,GAAG3B,OAAO,CAAEG,kBAAkB,EAAE,EAAG,CAAC;EAClD,OACCyB,aAAA,CAAC1B,eAAe,CAAC2B,QAAQ;IAACC,KAAK,EAAGH;EAAU,GACzCD,QACuB,CAAC;AAE7B"}