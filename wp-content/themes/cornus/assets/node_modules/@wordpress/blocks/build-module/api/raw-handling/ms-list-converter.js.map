{"version":3,"names":["deepFilterHTML","msListIgnore","isList","node","nodeName","msListConverter","doc","style","getAttribute","includes","prevNode","previousElementSibling","type","textContent","trim","slice","isNumeric","test","newListNode","createElement","setAttribute","parentNode","insertBefore","listNode","listType","listItem","receivingNode","innerHTML","matches","exec","level","parseInt","lastChild","appendChild","removeChild"],"sources":["@wordpress/blocks/src/api/raw-handling/ms-list-converter.js"],"sourcesContent":["/**\n * Internal dependencies\n */\nimport { deepFilterHTML } from './utils';\nimport msListIgnore from './ms-list-ignore';\n\nfunction isList( node ) {\n\treturn node.nodeName === 'OL' || node.nodeName === 'UL';\n}\n\nexport default function msListConverter( node, doc ) {\n\tif ( node.nodeName !== 'P' ) {\n\t\treturn;\n\t}\n\n\tconst style = node.getAttribute( 'style' );\n\n\tif ( ! style || ! style.includes( 'mso-list' ) ) {\n\t\treturn;\n\t}\n\n\tconst prevNode = node.previousElementSibling;\n\n\t// Add new list if no previous.\n\tif ( ! prevNode || ! isList( prevNode ) ) {\n\t\t// See https://html.spec.whatwg.org/multipage/grouping-content.html#attr-ol-type.\n\t\tconst type = node.textContent.trim().slice( 0, 1 );\n\t\tconst isNumeric = /[1iIaA]/.test( type );\n\t\tconst newListNode = doc.createElement( isNumeric ? 'ol' : 'ul' );\n\n\t\tif ( isNumeric ) {\n\t\t\tnewListNode.setAttribute( 'type', type );\n\t\t}\n\n\t\tnode.parentNode.insertBefore( newListNode, node );\n\t}\n\n\tconst listNode = node.previousElementSibling;\n\tconst listType = listNode.nodeName;\n\tconst listItem = doc.createElement( 'li' );\n\n\tlet receivingNode = listNode;\n\n\t// Add content.\n\tlistItem.innerHTML = deepFilterHTML( node.innerHTML, [ msListIgnore ] );\n\n\tconst matches = /mso-list\\s*:[^;]+level([0-9]+)/i.exec( style );\n\tlet level = matches ? parseInt( matches[ 1 ], 10 ) - 1 || 0 : 0;\n\n\t// Change pointer depending on indentation level.\n\twhile ( level-- ) {\n\t\treceivingNode = receivingNode.lastChild || receivingNode;\n\n\t\t// If it's a list, move pointer to the last item.\n\t\tif ( isList( receivingNode ) ) {\n\t\t\treceivingNode = receivingNode.lastChild || receivingNode;\n\t\t}\n\t}\n\n\t// Make sure we append to a list.\n\tif ( ! isList( receivingNode ) ) {\n\t\treceivingNode = receivingNode.appendChild(\n\t\t\tdoc.createElement( listType )\n\t\t);\n\t}\n\n\t// Append the list item to the list.\n\treceivingNode.appendChild( listItem );\n\n\t// Remove the wrapper paragraph.\n\tnode.parentNode.removeChild( node );\n}\n"],"mappings":"AAAA;AACA;AACA;AACA,SAASA,cAAc,QAAQ,SAAS;AACxC,OAAOC,YAAY,MAAM,kBAAkB;AAE3C,SAASC,MAAMA,CAAEC,IAAI,EAAG;EACvB,OAAOA,IAAI,CAACC,QAAQ,KAAK,IAAI,IAAID,IAAI,CAACC,QAAQ,KAAK,IAAI;AACxD;AAEA,eAAe,SAASC,eAAeA,CAAEF,IAAI,EAAEG,GAAG,EAAG;EACpD,IAAKH,IAAI,CAACC,QAAQ,KAAK,GAAG,EAAG;IAC5B;EACD;EAEA,MAAMG,KAAK,GAAGJ,IAAI,CAACK,YAAY,CAAE,OAAQ,CAAC;EAE1C,IAAK,CAAED,KAAK,IAAI,CAAEA,KAAK,CAACE,QAAQ,CAAE,UAAW,CAAC,EAAG;IAChD;EACD;EAEA,MAAMC,QAAQ,GAAGP,IAAI,CAACQ,sBAAsB;;EAE5C;EACA,IAAK,CAAED,QAAQ,IAAI,CAAER,MAAM,CAAEQ,QAAS,CAAC,EAAG;IACzC;IACA,MAAME,IAAI,GAAGT,IAAI,CAACU,WAAW,CAACC,IAAI,CAAC,CAAC,CAACC,KAAK,CAAE,CAAC,EAAE,CAAE,CAAC;IAClD,MAAMC,SAAS,GAAG,SAAS,CAACC,IAAI,CAAEL,IAAK,CAAC;IACxC,MAAMM,WAAW,GAAGZ,GAAG,CAACa,aAAa,CAAEH,SAAS,GAAG,IAAI,GAAG,IAAK,CAAC;IAEhE,IAAKA,SAAS,EAAG;MAChBE,WAAW,CAACE,YAAY,CAAE,MAAM,EAAER,IAAK,CAAC;IACzC;IAEAT,IAAI,CAACkB,UAAU,CAACC,YAAY,CAAEJ,WAAW,EAAEf,IAAK,CAAC;EAClD;EAEA,MAAMoB,QAAQ,GAAGpB,IAAI,CAACQ,sBAAsB;EAC5C,MAAMa,QAAQ,GAAGD,QAAQ,CAACnB,QAAQ;EAClC,MAAMqB,QAAQ,GAAGnB,GAAG,CAACa,aAAa,CAAE,IAAK,CAAC;EAE1C,IAAIO,aAAa,GAAGH,QAAQ;;EAE5B;EACAE,QAAQ,CAACE,SAAS,GAAG3B,cAAc,CAAEG,IAAI,CAACwB,SAAS,EAAE,CAAE1B,YAAY,CAAG,CAAC;EAEvE,MAAM2B,OAAO,GAAG,iCAAiC,CAACC,IAAI,CAAEtB,KAAM,CAAC;EAC/D,IAAIuB,KAAK,GAAGF,OAAO,GAAGG,QAAQ,CAAEH,OAAO,CAAE,CAAC,CAAE,EAAE,EAAG,CAAC,GAAG,CAAC,IAAI,CAAC,GAAG,CAAC;;EAE/D;EACA,OAAQE,KAAK,EAAE,EAAG;IACjBJ,aAAa,GAAGA,aAAa,CAACM,SAAS,IAAIN,aAAa;;IAExD;IACA,IAAKxB,MAAM,CAAEwB,aAAc,CAAC,EAAG;MAC9BA,aAAa,GAAGA,aAAa,CAACM,SAAS,IAAIN,aAAa;IACzD;EACD;;EAEA;EACA,IAAK,CAAExB,MAAM,CAAEwB,aAAc,CAAC,EAAG;IAChCA,aAAa,GAAGA,aAAa,CAACO,WAAW,CACxC3B,GAAG,CAACa,aAAa,CAAEK,QAAS,CAC7B,CAAC;EACF;;EAEA;EACAE,aAAa,CAACO,WAAW,CAAER,QAAS,CAAC;;EAErC;EACAtB,IAAI,CAACkB,UAAU,CAACa,WAAW,CAAE/B,IAAK,CAAC;AACpC"}