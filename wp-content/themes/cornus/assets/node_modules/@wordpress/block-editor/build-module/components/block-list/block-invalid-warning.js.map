{"version":3,"names":["__","_x","Button","Modal","useState","useCallback","useMemo","createBlock","rawHandler","useDispatch","useSelect","Warning","BlockCompare","store","blockEditorStore","blockToBlocks","block","HTML","originalContent","BlockInvalidWarning","clientId","canInsertHTMLBlock","canInsertClassicBlock","select","canInsertBlockType","getBlock","getBlockRootClientId","rootClientId","replaceBlock","compare","setCompare","onCompareClose","convert","toClassic","classicBlock","content","toHTML","htmlBlock","toBlocks","newBlocks","toRecoveredBlock","recoveredBlock","name","attributes","innerBlocks","secondaryActions","title","onClick","filter","Boolean","createElement","Fragment","actions","key","variant","onRequestClose","className","onKeep","onConvert","convertor","convertButtonText"],"sources":["@wordpress/block-editor/src/components/block-list/block-invalid-warning.js"],"sourcesContent":["/**\n * WordPress dependencies\n */\nimport { __, _x } from '@wordpress/i18n';\nimport { Button, Modal } from '@wordpress/components';\nimport { useState, useCallback, useMemo } from '@wordpress/element';\nimport { createBlock, rawHandler } from '@wordpress/blocks';\nimport { useDispatch, useSelect } from '@wordpress/data';\n\n/**\n * Internal dependencies\n */\nimport Warning from '../warning';\nimport BlockCompare from '../block-compare';\nimport { store as blockEditorStore } from '../../store';\n\nconst blockToBlocks = ( block ) =>\n\trawHandler( {\n\t\tHTML: block.originalContent,\n\t} );\n\nexport default function BlockInvalidWarning( { clientId } ) {\n\tconst { block, canInsertHTMLBlock, canInsertClassicBlock } = useSelect(\n\t\t( select ) => {\n\t\t\tconst { canInsertBlockType, getBlock, getBlockRootClientId } =\n\t\t\t\tselect( blockEditorStore );\n\n\t\t\tconst rootClientId = getBlockRootClientId( clientId );\n\n\t\t\treturn {\n\t\t\t\tblock: getBlock( clientId ),\n\t\t\t\tcanInsertHTMLBlock: canInsertBlockType(\n\t\t\t\t\t'core/html',\n\t\t\t\t\trootClientId\n\t\t\t\t),\n\t\t\t\tcanInsertClassicBlock: canInsertBlockType(\n\t\t\t\t\t'core/freeform',\n\t\t\t\t\trootClientId\n\t\t\t\t),\n\t\t\t};\n\t\t},\n\t\t[ clientId ]\n\t);\n\tconst { replaceBlock } = useDispatch( blockEditorStore );\n\n\tconst [ compare, setCompare ] = useState( false );\n\tconst onCompareClose = useCallback( () => setCompare( false ), [] );\n\n\tconst convert = useMemo(\n\t\t() => ( {\n\t\t\ttoClassic() {\n\t\t\t\tconst classicBlock = createBlock( 'core/freeform', {\n\t\t\t\t\tcontent: block.originalContent,\n\t\t\t\t} );\n\t\t\t\treturn replaceBlock( block.clientId, classicBlock );\n\t\t\t},\n\t\t\ttoHTML() {\n\t\t\t\tconst htmlBlock = createBlock( 'core/html', {\n\t\t\t\t\tcontent: block.originalContent,\n\t\t\t\t} );\n\t\t\t\treturn replaceBlock( block.clientId, htmlBlock );\n\t\t\t},\n\t\t\ttoBlocks() {\n\t\t\t\tconst newBlocks = blockToBlocks( block );\n\t\t\t\treturn replaceBlock( block.clientId, newBlocks );\n\t\t\t},\n\t\t\ttoRecoveredBlock() {\n\t\t\t\tconst recoveredBlock = createBlock(\n\t\t\t\t\tblock.name,\n\t\t\t\t\tblock.attributes,\n\t\t\t\t\tblock.innerBlocks\n\t\t\t\t);\n\t\t\t\treturn replaceBlock( block.clientId, recoveredBlock );\n\t\t\t},\n\t\t} ),\n\t\t[ block, replaceBlock ]\n\t);\n\n\tconst secondaryActions = useMemo(\n\t\t() =>\n\t\t\t[\n\t\t\t\t{\n\t\t\t\t\t// translators: Button to fix block content\n\t\t\t\t\ttitle: _x( 'Resolve', 'imperative verb' ),\n\t\t\t\t\tonClick: () => setCompare( true ),\n\t\t\t\t},\n\t\t\t\tcanInsertHTMLBlock && {\n\t\t\t\t\ttitle: __( 'Convert to HTML' ),\n\t\t\t\t\tonClick: convert.toHTML,\n\t\t\t\t},\n\t\t\t\tcanInsertClassicBlock && {\n\t\t\t\t\ttitle: __( 'Convert to Classic Block' ),\n\t\t\t\t\tonClick: convert.toClassic,\n\t\t\t\t},\n\t\t\t].filter( Boolean ),\n\t\t[ canInsertHTMLBlock, canInsertClassicBlock, convert ]\n\t);\n\n\treturn (\n\t\t<>\n\t\t\t<Warning\n\t\t\t\tactions={ [\n\t\t\t\t\t<Button\n\t\t\t\t\t\tkey=\"recover\"\n\t\t\t\t\t\tonClick={ convert.toRecoveredBlock }\n\t\t\t\t\t\tvariant=\"primary\"\n\t\t\t\t\t>\n\t\t\t\t\t\t{ __( 'Attempt Block Recovery' ) }\n\t\t\t\t\t</Button>,\n\t\t\t\t] }\n\t\t\t\tsecondaryActions={ secondaryActions }\n\t\t\t>\n\t\t\t\t{ __( 'This block contains unexpected or invalid content.' ) }\n\t\t\t</Warning>\n\t\t\t{ compare && (\n\t\t\t\t<Modal\n\t\t\t\t\ttitle={\n\t\t\t\t\t\t// translators: Dialog title to fix block content\n\t\t\t\t\t\t__( 'Resolve Block' )\n\t\t\t\t\t}\n\t\t\t\t\tonRequestClose={ onCompareClose }\n\t\t\t\t\tclassName=\"block-editor-block-compare\"\n\t\t\t\t>\n\t\t\t\t\t<BlockCompare\n\t\t\t\t\t\tblock={ block }\n\t\t\t\t\t\tonKeep={ convert.toHTML }\n\t\t\t\t\t\tonConvert={ convert.toBlocks }\n\t\t\t\t\t\tconvertor={ blockToBlocks }\n\t\t\t\t\t\tconvertButtonText={ __( 'Convert to Blocks' ) }\n\t\t\t\t\t/>\n\t\t\t\t</Modal>\n\t\t\t) }\n\t\t</>\n\t);\n}\n"],"mappings":"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"}