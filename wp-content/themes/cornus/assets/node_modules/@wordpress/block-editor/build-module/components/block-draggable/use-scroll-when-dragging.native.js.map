{"version":3,"names":["useWindowDimensions","useSharedValue","useAnimatedRef","scrollTo","useAnimatedReaction","withTiming","withRepeat","cancelAnimation","Easing","useBlockListContext","SCROLL_INACTIVE_DISTANCE_PX","SCROLL_INTERVAL_MS","VELOCITY_MULTIPLIER","useScrollWhenDragging","scrollRef","animatedScrollRef","scrollViewRef","height","windowHeight","velocityY","offsetY","dragStartY","animationTimer","isAnimationTimerActive","isScrollActive","scroll","maxOffsetY","scrollHandler","event","contentSize","contentOffset","layoutMeasurement","value","y","stopScrolling","startScrolling","duration","easing","linear","scrollOnDragOver","dragDistance","Math","max","abs","distancePercentage","previous","delta","newOffset","min"],"sources":["@wordpress/block-editor/src/components/block-draggable/use-scroll-when-dragging.native.js"],"sourcesContent":["/**\n * External dependencies\n */\nimport { useWindowDimensions } from 'react-native';\nimport {\n\tuseSharedValue,\n\tuseAnimatedRef,\n\tscrollTo,\n\tuseAnimatedReaction,\n\twithTiming,\n\twithRepeat,\n\tcancelAnimation,\n\tEasing,\n} from 'react-native-reanimated';\n\n/**\n * Internal dependencies\n */\nimport { useBlockListContext } from '../block-list/block-list-context';\n\nconst SCROLL_INACTIVE_DISTANCE_PX = 50;\nconst SCROLL_INTERVAL_MS = 1000;\nconst VELOCITY_MULTIPLIER = 5000;\n\n/**\n * React hook that scrolls the scroll container when a block is being dragged.\n *\n * @return {Function[]} `startScrolling`, `scrollOnDragOver`, `stopScrolling`\n *                      functions to be called in `onDragStart`, `onDragOver`\n *                      and `onDragEnd` events respectively. Additionally,\n * \t\t\t\t\t\t`scrollHandler` function is returned which should be\n * \t\t\t\t\t\tcalled in the `onScroll` event of the block list.\n */\nexport default function useScrollWhenDragging() {\n\tconst { scrollRef } = useBlockListContext();\n\tconst animatedScrollRef = useAnimatedRef();\n\tanimatedScrollRef( scrollRef?.scrollViewRef );\n\n\tconst { height: windowHeight } = useWindowDimensions();\n\n\tconst velocityY = useSharedValue( 0 );\n\tconst offsetY = useSharedValue( 0 );\n\tconst dragStartY = useSharedValue( 0 );\n\tconst animationTimer = useSharedValue( 0 );\n\tconst isAnimationTimerActive = useSharedValue( false );\n\tconst isScrollActive = useSharedValue( false );\n\n\tconst scroll = {\n\t\toffsetY: useSharedValue( 0 ),\n\t\tmaxOffsetY: useSharedValue( 0 ),\n\t};\n\tconst scrollHandler = ( event ) => {\n\t\t'worklet';\n\t\tconst { contentSize, contentOffset, layoutMeasurement } = event;\n\t\tscroll.offsetY.value = contentOffset.y;\n\t\tscroll.maxOffsetY.value = contentSize.height - layoutMeasurement.height;\n\t};\n\n\tconst stopScrolling = () => {\n\t\t'worklet';\n\t\tcancelAnimation( animationTimer );\n\n\t\tisAnimationTimerActive.value = false;\n\t\tisScrollActive.value = false;\n\t\tvelocityY.value = 0;\n\t};\n\n\tconst startScrolling = ( y ) => {\n\t\t'worklet';\n\t\tstopScrolling();\n\t\toffsetY.value = scroll.offsetY.value;\n\t\tdragStartY.value = y;\n\n\t\tanimationTimer.value = 0;\n\t\tanimationTimer.value = withRepeat(\n\t\t\twithTiming( 1, {\n\t\t\t\tduration: SCROLL_INTERVAL_MS,\n\t\t\t\teasing: Easing.linear,\n\t\t\t} ),\n\t\t\t-1,\n\t\t\ttrue\n\t\t);\n\t\tisAnimationTimerActive.value = true;\n\t};\n\n\tconst scrollOnDragOver = ( y ) => {\n\t\t'worklet';\n\t\tconst dragDistance = Math.max(\n\t\t\tMath.abs( y - dragStartY.value ) - SCROLL_INACTIVE_DISTANCE_PX,\n\t\t\t0\n\t\t);\n\t\tconst distancePercentage = dragDistance / windowHeight;\n\n\t\tif ( ! isScrollActive.value ) {\n\t\t\tisScrollActive.value = dragDistance > 0;\n\t\t} else if ( y > dragStartY.value ) {\n\t\t\t// User is dragging downwards.\n\t\t\tvelocityY.value = VELOCITY_MULTIPLIER * distancePercentage;\n\t\t} else if ( y < dragStartY.value ) {\n\t\t\t// User is dragging upwards.\n\t\t\tvelocityY.value = -VELOCITY_MULTIPLIER * distancePercentage;\n\t\t} else {\n\t\t\tvelocityY.value = 0;\n\t\t}\n\t};\n\n\tuseAnimatedReaction(\n\t\t() => animationTimer.value,\n\t\t( value, previous ) => {\n\t\t\tif ( velocityY.value === 0 ) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst delta = Math.abs( value - previous );\n\t\t\tlet newOffset = offsetY.value + delta * velocityY.value;\n\n\t\t\tif ( scroll.maxOffsetY.value !== 0 ) {\n\t\t\t\tnewOffset = Math.max(\n\t\t\t\t\t0,\n\t\t\t\t\tMath.min( scroll.maxOffsetY.value, newOffset )\n\t\t\t\t);\n\t\t\t} else {\n\t\t\t\t// Scroll values are empty until receiving the first scroll event.\n\t\t\t\t// In that case, the max offset is unknown and we can't clamp the\n\t\t\t\t// new offset value.\n\t\t\t\tnewOffset = Math.max( 0, newOffset );\n\t\t\t}\n\n\t\t\toffsetY.value = newOffset;\n\t\t\tscrollTo( animatedScrollRef, 0, offsetY.value, false );\n\t\t}\n\t);\n\n\treturn [ startScrolling, scrollOnDragOver, stopScrolling, scrollHandler ];\n}\n"],"mappings":"AAAA;AACA;AACA;AACA,SAASA,mBAAmB,QAAQ,cAAc;AAClD,SACCC,cAAc,EACdC,cAAc,EACdC,QAAQ,EACRC,mBAAmB,EACnBC,UAAU,EACVC,UAAU,EACVC,eAAe,EACfC,MAAM,QACA,yBAAyB;;AAEhC;AACA;AACA;AACA,SAASC,mBAAmB,QAAQ,kCAAkC;AAEtE,MAAMC,2BAA2B,GAAG,EAAE;AACtC,MAAMC,kBAAkB,GAAG,IAAI;AAC/B,MAAMC,mBAAmB,GAAG,IAAI;;AAEhC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,eAAe,SAASC,qBAAqBA,CAAA,EAAG;EAC/C,MAAM;IAAEC;EAAU,CAAC,GAAGL,mBAAmB,CAAC,CAAC;EAC3C,MAAMM,iBAAiB,GAAGb,cAAc,CAAC,CAAC;EAC1Ca,iBAAiB,CAAED,SAAS,EAAEE,aAAc,CAAC;EAE7C,MAAM;IAAEC,MAAM,EAAEC;EAAa,CAAC,GAAGlB,mBAAmB,CAAC,CAAC;EAEtD,MAAMmB,SAAS,GAAGlB,cAAc,CAAE,CAAE,CAAC;EACrC,MAAMmB,OAAO,GAAGnB,cAAc,CAAE,CAAE,CAAC;EACnC,MAAMoB,UAAU,GAAGpB,cAAc,CAAE,CAAE,CAAC;EACtC,MAAMqB,cAAc,GAAGrB,cAAc,CAAE,CAAE,CAAC;EAC1C,MAAMsB,sBAAsB,GAAGtB,cAAc,CAAE,KAAM,CAAC;EACtD,MAAMuB,cAAc,GAAGvB,cAAc,CAAE,KAAM,CAAC;EAE9C,MAAMwB,MAAM,GAAG;IACdL,OAAO,EAAEnB,cAAc,CAAE,CAAE,CAAC;IAC5ByB,UAAU,EAAEzB,cAAc,CAAE,CAAE;EAC/B,CAAC;EACD,MAAM0B,aAAa,GAAKC,KAAK,IAAM;IAClC,SAAS;;IACT,MAAM;MAAEC,WAAW;MAAEC,aAAa;MAAEC;IAAkB,CAAC,GAAGH,KAAK;IAC/DH,MAAM,CAACL,OAAO,CAACY,KAAK,GAAGF,aAAa,CAACG,CAAC;IACtCR,MAAM,CAACC,UAAU,CAACM,KAAK,GAAGH,WAAW,CAACZ,MAAM,GAAGc,iBAAiB,CAACd,MAAM;EACxE,CAAC;EAED,MAAMiB,aAAa,GAAGA,CAAA,KAAM;IAC3B,SAAS;;IACT3B,eAAe,CAAEe,cAAe,CAAC;IAEjCC,sBAAsB,CAACS,KAAK,GAAG,KAAK;IACpCR,cAAc,CAACQ,KAAK,GAAG,KAAK;IAC5Bb,SAAS,CAACa,KAAK,GAAG,CAAC;EACpB,CAAC;EAED,MAAMG,cAAc,GAAKF,CAAC,IAAM;IAC/B,SAAS;;IACTC,aAAa,CAAC,CAAC;IACfd,OAAO,CAACY,KAAK,GAAGP,MAAM,CAACL,OAAO,CAACY,KAAK;IACpCX,UAAU,CAACW,KAAK,GAAGC,CAAC;IAEpBX,cAAc,CAACU,KAAK,GAAG,CAAC;IACxBV,cAAc,CAACU,KAAK,GAAG1B,UAAU,CAChCD,UAAU,CAAE,CAAC,EAAE;MACd+B,QAAQ,EAAEzB,kBAAkB;MAC5B0B,MAAM,EAAE7B,MAAM,CAAC8B;IAChB,CAAE,CAAC,EACH,CAAC,CAAC,EACF,IACD,CAAC;IACDf,sBAAsB,CAACS,KAAK,GAAG,IAAI;EACpC,CAAC;EAED,MAAMO,gBAAgB,GAAKN,CAAC,IAAM;IACjC,SAAS;;IACT,MAAMO,YAAY,GAAGC,IAAI,CAACC,GAAG,CAC5BD,IAAI,CAACE,GAAG,CAAEV,CAAC,GAAGZ,UAAU,CAACW,KAAM,CAAC,GAAGtB,2BAA2B,EAC9D,CACD,CAAC;IACD,MAAMkC,kBAAkB,GAAGJ,YAAY,GAAGtB,YAAY;IAEtD,IAAK,CAAEM,cAAc,CAACQ,KAAK,EAAG;MAC7BR,cAAc,CAACQ,KAAK,GAAGQ,YAAY,GAAG,CAAC;IACxC,CAAC,MAAM,IAAKP,CAAC,GAAGZ,UAAU,CAACW,KAAK,EAAG;MAClC;MACAb,SAAS,CAACa,KAAK,GAAGpB,mBAAmB,GAAGgC,kBAAkB;IAC3D,CAAC,MAAM,IAAKX,CAAC,GAAGZ,UAAU,CAACW,KAAK,EAAG;MAClC;MACAb,SAAS,CAACa,KAAK,GAAG,CAACpB,mBAAmB,GAAGgC,kBAAkB;IAC5D,CAAC,MAAM;MACNzB,SAAS,CAACa,KAAK,GAAG,CAAC;IACpB;EACD,CAAC;EAED5B,mBAAmB,CAClB,MAAMkB,cAAc,CAACU,KAAK,EAC1B,CAAEA,KAAK,EAAEa,QAAQ,KAAM;IACtB,IAAK1B,SAAS,CAACa,KAAK,KAAK,CAAC,EAAG;MAC5B;IACD;IAEA,MAAMc,KAAK,GAAGL,IAAI,CAACE,GAAG,CAAEX,KAAK,GAAGa,QAAS,CAAC;IAC1C,IAAIE,SAAS,GAAG3B,OAAO,CAACY,KAAK,GAAGc,KAAK,GAAG3B,SAAS,CAACa,KAAK;IAEvD,IAAKP,MAAM,CAACC,UAAU,CAACM,KAAK,KAAK,CAAC,EAAG;MACpCe,SAAS,GAAGN,IAAI,CAACC,GAAG,CACnB,CAAC,EACDD,IAAI,CAACO,GAAG,CAAEvB,MAAM,CAACC,UAAU,CAACM,KAAK,EAAEe,SAAU,CAC9C,CAAC;IACF,CAAC,MAAM;MACN;MACA;MACA;MACAA,SAAS,GAAGN,IAAI,CAACC,GAAG,CAAE,CAAC,EAAEK,SAAU,CAAC;IACrC;IAEA3B,OAAO,CAACY,KAAK,GAAGe,SAAS;IACzB5C,QAAQ,CAAEY,iBAAiB,EAAE,CAAC,EAAEK,OAAO,CAACY,KAAK,EAAE,KAAM,CAAC;EACvD,CACD,CAAC;EAED,OAAO,CAAEG,cAAc,EAAEI,gBAAgB,EAAEL,aAAa,EAAEP,aAAa,CAAE;AAC1E"}