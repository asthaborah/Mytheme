{"version":3,"names":["_hooks","require","_blocks","_tokenList","_interopRequireDefault","_fontSizes","_typography","_utils","_useSettings","_typographyUtils","FONT_SIZE_SUPPORT_KEY","exports","addAttributes","settings","hasBlockSupport","attributes","fontSize","Object","assign","type","addSaveProps","props","blockNameOrType","shouldSkipSerialization","TYPOGRAPHY_SUPPORT_KEY","classes","TokenList","className","add","getFontSizeClass","newClassName","value","undefined","FontSizeEdit","style","setAttributes","fontSizes","useSettings","onChange","fontSizeSlug","getFontSizeObjectByValue","slug","cleanEmptyObject","typography","fontSizeObject","getFontSize","fontSizeValue","size","_react","createElement","FontSizePicker","withReset","withSlider","useIsFontSizeDisabled","name","blockName","hasFontSizes","length","useBlockProps","fluidTypographySettings","layoutSettings","getTypographyFontSizeValue","fluid","layout","_default","default","attributeKeys","hasSupport","MIGRATION_PATHS","addTransforms","result","source","index","results","destinationBlockType","activeSupports","transformStyles","addFilter"],"sources":["@wordpress/block-editor/src/hooks/font-size.js"],"sourcesContent":["/**\n * WordPress dependencies\n */\nimport { addFilter } from '@wordpress/hooks';\nimport { hasBlockSupport } from '@wordpress/blocks';\nimport TokenList from '@wordpress/token-list';\n\n/**\n * Internal dependencies\n */\nimport {\n\tgetFontSize,\n\tgetFontSizeClass,\n\tgetFontSizeObjectByValue,\n\tFontSizePicker,\n} from '../components/font-sizes';\nimport { TYPOGRAPHY_SUPPORT_KEY } from './typography';\nimport {\n\tcleanEmptyObject,\n\ttransformStyles,\n\tshouldSkipSerialization,\n} from './utils';\nimport { useSettings } from '../components/use-settings';\nimport { getTypographyFontSizeValue } from '../components/global-styles/typography-utils';\n\nexport const FONT_SIZE_SUPPORT_KEY = 'typography.fontSize';\n\n/**\n * Filters registered block settings, extending attributes to include\n * `fontSize` and `fontWeight` attributes.\n *\n * @param {Object} settings Original block settings.\n *\n * @return {Object} Filtered block settings.\n */\nfunction addAttributes( settings ) {\n\tif ( ! hasBlockSupport( settings, FONT_SIZE_SUPPORT_KEY ) ) {\n\t\treturn settings;\n\t}\n\n\t// Allow blocks to specify a default value if needed.\n\tif ( ! settings.attributes.fontSize ) {\n\t\tObject.assign( settings.attributes, {\n\t\t\tfontSize: {\n\t\t\t\ttype: 'string',\n\t\t\t},\n\t\t} );\n\t}\n\n\treturn settings;\n}\n\n/**\n * Override props assigned to save component to inject font size.\n *\n * @param {Object} props           Additional props applied to save element.\n * @param {Object} blockNameOrType Block type.\n * @param {Object} attributes      Block attributes.\n *\n * @return {Object} Filtered props applied to save element.\n */\nfunction addSaveProps( props, blockNameOrType, attributes ) {\n\tif ( ! hasBlockSupport( blockNameOrType, FONT_SIZE_SUPPORT_KEY ) ) {\n\t\treturn props;\n\t}\n\n\tif (\n\t\tshouldSkipSerialization(\n\t\t\tblockNameOrType,\n\t\t\tTYPOGRAPHY_SUPPORT_KEY,\n\t\t\t'fontSize'\n\t\t)\n\t) {\n\t\treturn props;\n\t}\n\n\t// Use TokenList to dedupe classes.\n\tconst classes = new TokenList( props.className );\n\tclasses.add( getFontSizeClass( attributes.fontSize ) );\n\tconst newClassName = classes.value;\n\tprops.className = newClassName ? newClassName : undefined;\n\n\treturn props;\n}\n\n/**\n * Inspector control panel containing the font size related configuration\n *\n * @param {Object} props\n *\n * @return {Element} Font size edit element.\n */\nexport function FontSizeEdit( props ) {\n\tconst {\n\t\tattributes: { fontSize, style },\n\t\tsetAttributes,\n\t} = props;\n\tconst [ fontSizes ] = useSettings( 'typography.fontSizes' );\n\n\tconst onChange = ( value ) => {\n\t\tconst fontSizeSlug = getFontSizeObjectByValue( fontSizes, value ).slug;\n\n\t\tsetAttributes( {\n\t\t\tstyle: cleanEmptyObject( {\n\t\t\t\t...style,\n\t\t\t\ttypography: {\n\t\t\t\t\t...style?.typography,\n\t\t\t\t\tfontSize: fontSizeSlug ? undefined : value,\n\t\t\t\t},\n\t\t\t} ),\n\t\t\tfontSize: fontSizeSlug,\n\t\t} );\n\t};\n\n\tconst fontSizeObject = getFontSize(\n\t\tfontSizes,\n\t\tfontSize,\n\t\tstyle?.typography?.fontSize\n\t);\n\n\tconst fontSizeValue =\n\t\tfontSizeObject?.size || style?.typography?.fontSize || fontSize;\n\n\treturn (\n\t\t<FontSizePicker\n\t\t\tonChange={ onChange }\n\t\t\tvalue={ fontSizeValue }\n\t\t\twithReset={ false }\n\t\t\twithSlider\n\t\t\tsize=\"__unstable-large\"\n\t\t/>\n\t);\n}\n\n/**\n * Custom hook that checks if font-size settings have been disabled.\n *\n * @param {string} name The name of the block.\n * @return {boolean} Whether setting is disabled.\n */\nexport function useIsFontSizeDisabled( { name: blockName } = {} ) {\n\tconst [ fontSizes ] = useSettings( 'typography.fontSizes' );\n\tconst hasFontSizes = !! fontSizes?.length;\n\n\treturn (\n\t\t! hasBlockSupport( blockName, FONT_SIZE_SUPPORT_KEY ) || ! hasFontSizes\n\t);\n}\n\nfunction useBlockProps( { name, fontSize, style } ) {\n\tconst [ fontSizes, fluidTypographySettings, layoutSettings ] = useSettings(\n\t\t'typography.fontSizes',\n\t\t'typography.fluid',\n\t\t'layout'\n\t);\n\n\t/*\n\t * Only add inline styles if the block supports font sizes,\n\t * doesn't skip serialization of font sizes,\n\t * and has either a custom font size or a preset font size.\n\t */\n\tif (\n\t\t! hasBlockSupport( name, FONT_SIZE_SUPPORT_KEY ) ||\n\t\tshouldSkipSerialization( name, TYPOGRAPHY_SUPPORT_KEY, 'fontSize' ) ||\n\t\t( ! fontSize && ! style?.typography?.fontSize )\n\t) {\n\t\treturn;\n\t}\n\n\tlet props;\n\n\tif ( style?.typography?.fontSize ) {\n\t\tprops = {\n\t\t\tstyle: {\n\t\t\t\tfontSize: getTypographyFontSizeValue(\n\t\t\t\t\t{ size: style.typography.fontSize },\n\t\t\t\t\t{\n\t\t\t\t\t\ttypography: {\n\t\t\t\t\t\t\tfluid: fluidTypographySettings,\n\t\t\t\t\t\t},\n\t\t\t\t\t\tlayout: layoutSettings,\n\t\t\t\t\t}\n\t\t\t\t),\n\t\t\t},\n\t\t};\n\t}\n\n\tif ( fontSize ) {\n\t\tprops = {\n\t\t\tstyle: {\n\t\t\t\tfontSize: getFontSize(\n\t\t\t\t\tfontSizes,\n\t\t\t\t\tfontSize,\n\t\t\t\t\tstyle?.typography?.fontSize\n\t\t\t\t).size,\n\t\t\t},\n\t\t};\n\t}\n\n\tif ( ! props ) {\n\t\treturn;\n\t}\n\n\treturn addSaveProps( props, name, { fontSize } );\n}\n\nexport default {\n\tuseBlockProps,\n\taddSaveProps,\n\tattributeKeys: [ 'fontSize', 'style' ],\n\thasSupport( name ) {\n\t\treturn hasBlockSupport( name, FONT_SIZE_SUPPORT_KEY );\n\t},\n};\n\nconst MIGRATION_PATHS = {\n\tfontSize: [ [ 'fontSize' ], [ 'style', 'typography', 'fontSize' ] ],\n};\n\nfunction addTransforms( result, source, index, results ) {\n\tconst destinationBlockType = result.name;\n\tconst activeSupports = {\n\t\tfontSize: hasBlockSupport(\n\t\t\tdestinationBlockType,\n\t\t\tFONT_SIZE_SUPPORT_KEY\n\t\t),\n\t};\n\treturn transformStyles(\n\t\tactiveSupports,\n\t\tMIGRATION_PATHS,\n\t\tresult,\n\t\tsource,\n\t\tindex,\n\t\tresults\n\t);\n}\n\naddFilter(\n\t'blocks.registerBlockType',\n\t'core/font/addAttribute',\n\taddAttributes\n);\n\naddFilter(\n\t'blocks.switchToBlockType.transformedBlock',\n\t'core/font-size/addTransforms',\n\taddTransforms\n);\n"],"mappings":"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"}