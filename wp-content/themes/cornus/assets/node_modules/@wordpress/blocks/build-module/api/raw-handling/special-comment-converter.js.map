{"version":3,"names":["remove","replace","specialCommentConverter","node","doc","nodeType","COMMENT_NODE","nodeValue","createNextpage","indexOf","moreCommentConverter","customText","slice","trim","sibling","noTeaser","nextSibling","moreBlock","createMore","parentNode","nodeName","childNodes","length","Array","from","nodeIndex","wrapperNode","body","paragraphBuilder","acc","child","createElement","appendChild","reduce","forEach","element","insertBefore","dataset","block"],"sources":["@wordpress/blocks/src/api/raw-handling/special-comment-converter.js"],"sourcesContent":["/**\n * WordPress dependencies\n */\nimport { remove, replace } from '@wordpress/dom';\n\n/**\n * Looks for `<!--nextpage-->` and `<!--more-->` comments and\n * replaces them with a custom element representing a future block.\n *\n * The custom element is a way to bypass the rest of the `raw-handling`\n * transforms, which would eliminate other kinds of node with which to carry\n * `<!--more-->`'s data: nodes with `data` attributes, empty paragraphs, etc.\n *\n * The custom element is then expected to be recognized by any registered\n * block's `raw` transform.\n *\n * @param {Node}     node The node to be processed.\n * @param {Document} doc  The document of the node.\n * @return {void}\n */\nexport default function specialCommentConverter( node, doc ) {\n\tif ( node.nodeType !== node.COMMENT_NODE ) {\n\t\treturn;\n\t}\n\n\tif ( node.nodeValue === 'nextpage' ) {\n\t\treplace( node, createNextpage( doc ) );\n\t\treturn;\n\t}\n\n\tif ( node.nodeValue.indexOf( 'more' ) === 0 ) {\n\t\tmoreCommentConverter( node, doc );\n\t}\n}\n\n/**\n * Convert `<!--more-->` as well as the `<!--more Some text-->` variant\n * and its `<!--noteaser-->` companion into the custom element\n * described in `specialCommentConverter()`.\n *\n * @param {Node}     node The node to be processed.\n * @param {Document} doc  The document of the node.\n * @return {void}\n */\nfunction moreCommentConverter( node, doc ) {\n\t// Grab any custom text in the comment.\n\tconst customText = node.nodeValue.slice( 4 ).trim();\n\n\t/*\n\t * When a `<!--more-->` comment is found, we need to look for any\n\t * `<!--noteaser-->` sibling, but it may not be a direct sibling\n\t * (whitespace typically lies in between)\n\t */\n\tlet sibling = node;\n\tlet noTeaser = false;\n\twhile ( ( sibling = sibling.nextSibling ) ) {\n\t\tif (\n\t\t\tsibling.nodeType === sibling.COMMENT_NODE &&\n\t\t\tsibling.nodeValue === 'noteaser'\n\t\t) {\n\t\t\tnoTeaser = true;\n\t\t\tremove( sibling );\n\t\t\tbreak;\n\t\t}\n\t}\n\n\tconst moreBlock = createMore( customText, noTeaser, doc );\n\n\t// If our `<!--more-->` comment is in the middle of a paragraph, we should\n\t// split the paragraph in two and insert the more block in between. If not,\n\t// the more block will eventually end up being inserted after the paragraph.\n\tif (\n\t\t! node.parentNode ||\n\t\tnode.parentNode.nodeName !== 'P' ||\n\t\tnode.parentNode.childNodes.length === 1\n\t) {\n\t\treplace( node, moreBlock );\n\t} else {\n\t\tconst childNodes = Array.from( node.parentNode.childNodes );\n\t\tconst nodeIndex = childNodes.indexOf( node );\n\t\tconst wrapperNode = node.parentNode.parentNode || doc.body;\n\n\t\tconst paragraphBuilder = ( acc, child ) => {\n\t\t\tif ( ! acc ) {\n\t\t\t\tacc = doc.createElement( 'p' );\n\t\t\t}\n\n\t\t\tacc.appendChild( child );\n\n\t\t\treturn acc;\n\t\t};\n\n\t\t// Split the original parent node and insert our more block\n\t\t[\n\t\t\tchildNodes.slice( 0, nodeIndex ).reduce( paragraphBuilder, null ),\n\t\t\tmoreBlock,\n\t\t\tchildNodes.slice( nodeIndex + 1 ).reduce( paragraphBuilder, null ),\n\t\t].forEach(\n\t\t\t( element ) =>\n\t\t\t\telement && wrapperNode.insertBefore( element, node.parentNode )\n\t\t);\n\n\t\t// Remove the old parent paragraph\n\t\tremove( node.parentNode );\n\t}\n}\n\nfunction createMore( customText, noTeaser, doc ) {\n\tconst node = doc.createElement( 'wp-block' );\n\tnode.dataset.block = 'core/more';\n\tif ( customText ) {\n\t\tnode.dataset.customText = customText;\n\t}\n\tif ( noTeaser ) {\n\t\t// \"Boolean\" data attribute.\n\t\tnode.dataset.noTeaser = '';\n\t}\n\treturn node;\n}\n\nfunction createNextpage( doc ) {\n\tconst node = doc.createElement( 'wp-block' );\n\tnode.dataset.block = 'core/nextpage';\n\n\treturn node;\n}\n"],"mappings":"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"}