{"version":3,"names":["_components","require","_data","_i18n","_element","_store","_components2","_lockUnlock","ContentLockControlsPure","clientId","isSelected","getBlockListSettings","getSettings","useSelect","blockEditorStore","templateLock","isLockedByParent","isEditingAsBlocks","select","__unstableGetContentLockingParent","getTemplateLock","__unstableGetTemporarilyEditingAsBlocks","updateSettings","updateBlockListSettings","__unstableSetTemporarilyEditingAsBlocks","useDispatch","stopEditingAsBlocks","unlock","isContentLocked","__unstableMarkNextChangeAsNotPersistent","updateBlockAttributes","stopEditingAsBlockCallback","useCallback","showStopEditingAsBlocks","showStartEditingAsBlocks","_react","createElement","Fragment","BlockControls","group","ToolbarButton","onClick","__","BlockSettingsMenuControls","onClose","MenuItem","undefined","focusModeToRevert","focusMode","_default","exports","default","edit","hasSupport"],"sources":["@wordpress/block-editor/src/hooks/content-lock-ui.js"],"sourcesContent":["/**\n * WordPress dependencies\n */\nimport { ToolbarButton, MenuItem } from '@wordpress/components';\nimport { useDispatch, useSelect } from '@wordpress/data';\nimport { __ } from '@wordpress/i18n';\nimport { useCallback } from '@wordpress/element';\n\n/**\n * Internal dependencies\n */\nimport { store as blockEditorStore } from '../store';\nimport { BlockControls, BlockSettingsMenuControls } from '../components';\nimport { unlock } from '../lock-unlock';\n\n// The implementation of content locking is mainly in this file, although the mechanism\n// to stop temporarily editing as blocks when an outside block is selected is on component StopEditingAsBlocksOnOutsideSelect\n// at block-editor/src/components/block-list/index.js.\n// Besides the components on this file and the file referenced above the implementation\n// also includes artifacts on the store (actions, reducers, and selector).\n\nfunction ContentLockControlsPure( { clientId, isSelected } ) {\n\tconst { getBlockListSettings, getSettings } = useSelect( blockEditorStore );\n\tconst { templateLock, isLockedByParent, isEditingAsBlocks } = useSelect(\n\t\t( select ) => {\n\t\t\tconst {\n\t\t\t\t__unstableGetContentLockingParent,\n\t\t\t\tgetTemplateLock,\n\t\t\t\t__unstableGetTemporarilyEditingAsBlocks,\n\t\t\t} = select( blockEditorStore );\n\t\t\treturn {\n\t\t\t\ttemplateLock: getTemplateLock( clientId ),\n\t\t\t\tisLockedByParent:\n\t\t\t\t\t!! __unstableGetContentLockingParent( clientId ),\n\t\t\t\tisEditingAsBlocks:\n\t\t\t\t\t__unstableGetTemporarilyEditingAsBlocks() === clientId,\n\t\t\t};\n\t\t},\n\t\t[ clientId ]\n\t);\n\n\tconst {\n\t\tupdateSettings,\n\t\tupdateBlockListSettings,\n\t\t__unstableSetTemporarilyEditingAsBlocks,\n\t} = useDispatch( blockEditorStore );\n\tconst { stopEditingAsBlocks } = unlock( useDispatch( blockEditorStore ) );\n\tconst isContentLocked =\n\t\t! isLockedByParent && templateLock === 'contentOnly';\n\tconst { __unstableMarkNextChangeAsNotPersistent, updateBlockAttributes } =\n\t\tuseDispatch( blockEditorStore );\n\n\tconst stopEditingAsBlockCallback = useCallback( () => {\n\t\tstopEditingAsBlocks( clientId );\n\t}, [ clientId, stopEditingAsBlocks ] );\n\n\tif ( ! isContentLocked && ! isEditingAsBlocks ) {\n\t\treturn null;\n\t}\n\n\tconst showStopEditingAsBlocks = isEditingAsBlocks && ! isContentLocked;\n\tconst showStartEditingAsBlocks =\n\t\t! isEditingAsBlocks && isContentLocked && isSelected;\n\n\treturn (\n\t\t<>\n\t\t\t{ showStopEditingAsBlocks && (\n\t\t\t\t<>\n\t\t\t\t\t<BlockControls group=\"other\">\n\t\t\t\t\t\t<ToolbarButton onClick={ stopEditingAsBlockCallback }>\n\t\t\t\t\t\t\t{ __( 'Done' ) }\n\t\t\t\t\t\t</ToolbarButton>\n\t\t\t\t\t</BlockControls>\n\t\t\t\t</>\n\t\t\t) }\n\t\t\t{ showStartEditingAsBlocks && (\n\t\t\t\t<BlockSettingsMenuControls>\n\t\t\t\t\t{ ( { onClose } ) => (\n\t\t\t\t\t\t<MenuItem\n\t\t\t\t\t\t\tonClick={ () => {\n\t\t\t\t\t\t\t\t__unstableMarkNextChangeAsNotPersistent();\n\t\t\t\t\t\t\t\tupdateBlockAttributes( clientId, {\n\t\t\t\t\t\t\t\t\ttemplateLock: undefined,\n\t\t\t\t\t\t\t\t} );\n\t\t\t\t\t\t\t\tupdateBlockListSettings( clientId, {\n\t\t\t\t\t\t\t\t\t...getBlockListSettings( clientId ),\n\t\t\t\t\t\t\t\t\ttemplateLock: false,\n\t\t\t\t\t\t\t\t} );\n\t\t\t\t\t\t\t\tconst focusModeToRevert =\n\t\t\t\t\t\t\t\t\tgetSettings().focusMode;\n\t\t\t\t\t\t\t\tupdateSettings( { focusMode: true } );\n\t\t\t\t\t\t\t\t__unstableSetTemporarilyEditingAsBlocks(\n\t\t\t\t\t\t\t\t\tclientId,\n\t\t\t\t\t\t\t\t\tfocusModeToRevert\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\tonClose();\n\t\t\t\t\t\t\t} }\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{ __( 'Modify' ) }\n\t\t\t\t\t\t</MenuItem>\n\t\t\t\t\t) }\n\t\t\t\t</BlockSettingsMenuControls>\n\t\t\t) }\n\t\t</>\n\t);\n}\n\nexport default {\n\tedit: ContentLockControlsPure,\n\thasSupport() {\n\t\treturn true;\n\t},\n};\n"],"mappings":"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"}