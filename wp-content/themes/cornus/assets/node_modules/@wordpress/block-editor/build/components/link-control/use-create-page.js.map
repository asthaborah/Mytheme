{"version":3,"names":["_i18n","require","_element","useCreatePage","handleCreatePage","cancelableCreateSuggestion","useRef","isCreatingPage","setIsCreatingPage","useState","errorMessage","setErrorMessage","createPage","suggestionTitle","current","makeCancelable","Promise","resolve","promise","error","isCanceled","message","__","useEffect","cancel","hasCanceled_","wrappedPromise","reject","then","val"],"sources":["@wordpress/block-editor/src/components/link-control/use-create-page.js"],"sourcesContent":["/**\n * WordPress dependencies\n */\nimport { __ } from '@wordpress/i18n';\nimport { useEffect, useState, useRef } from '@wordpress/element';\n\nexport default function useCreatePage( handleCreatePage ) {\n\tconst cancelableCreateSuggestion = useRef();\n\tconst [ isCreatingPage, setIsCreatingPage ] = useState( false );\n\tconst [ errorMessage, setErrorMessage ] = useState( null );\n\n\tconst createPage = async function ( suggestionTitle ) {\n\t\tsetIsCreatingPage( true );\n\t\tsetErrorMessage( null );\n\n\t\ttry {\n\t\t\t// Make cancellable in order that we can avoid setting State\n\t\t\t// if the component unmounts during the call to `createSuggestion`\n\t\t\tcancelableCreateSuggestion.current = makeCancelable(\n\t\t\t\t// Using Promise.resolve to allow createSuggestion to return a\n\t\t\t\t// non-Promise based value.\n\t\t\t\tPromise.resolve( handleCreatePage( suggestionTitle ) )\n\t\t\t);\n\n\t\t\treturn await cancelableCreateSuggestion.current.promise;\n\t\t} catch ( error ) {\n\t\t\tif ( error && error.isCanceled ) {\n\t\t\t\treturn; // bail if canceled to avoid setting state\n\t\t\t}\n\n\t\t\tsetErrorMessage(\n\t\t\t\terror.message ||\n\t\t\t\t\t__(\n\t\t\t\t\t\t'An unknown error occurred during creation. Please try again.'\n\t\t\t\t\t)\n\t\t\t);\n\t\t\tthrow error;\n\t\t} finally {\n\t\t\tsetIsCreatingPage( false );\n\t\t}\n\t};\n\n\t/**\n\t * Handles cancelling any pending Promises that have been made cancelable.\n\t */\n\tuseEffect( () => {\n\t\treturn () => {\n\t\t\t// componentDidUnmount\n\t\t\tif ( cancelableCreateSuggestion.current ) {\n\t\t\t\tcancelableCreateSuggestion.current.cancel();\n\t\t\t}\n\t\t};\n\t}, [] );\n\n\treturn {\n\t\tcreatePage,\n\t\tisCreatingPage,\n\t\terrorMessage,\n\t};\n}\n\n/**\n * Creates a wrapper around a promise which allows it to be programmatically\n * cancelled.\n * See: https://reactjs.org/blog/2015/12/16/ismounted-antipattern.html\n *\n * @param {Promise} promise the Promise to make cancelable\n */\nconst makeCancelable = ( promise ) => {\n\tlet hasCanceled_ = false;\n\n\tconst wrappedPromise = new Promise( ( resolve, reject ) => {\n\t\tpromise.then(\n\t\t\t( val ) =>\n\t\t\t\thasCanceled_ ? reject( { isCanceled: true } ) : resolve( val ),\n\t\t\t( error ) =>\n\t\t\t\thasCanceled_ ? reject( { isCanceled: true } ) : reject( error )\n\t\t);\n\t} );\n\n\treturn {\n\t\tpromise: wrappedPromise,\n\t\tcancel() {\n\t\t\thasCanceled_ = true;\n\t\t},\n\t};\n};\n"],"mappings":";;;;;;AAGA,IAAAA,KAAA,GAAAC,OAAA;AACA,IAAAC,QAAA,GAAAD,OAAA;AAJA;AACA;AACA;;AAIe,SAASE,aAAaA,CAAEC,gBAAgB,EAAG;EACzD,MAAMC,0BAA0B,GAAG,IAAAC,eAAM,EAAC,CAAC;EAC3C,MAAM,CAAEC,cAAc,EAAEC,iBAAiB,CAAE,GAAG,IAAAC,iBAAQ,EAAE,KAAM,CAAC;EAC/D,MAAM,CAAEC,YAAY,EAAEC,eAAe,CAAE,GAAG,IAAAF,iBAAQ,EAAE,IAAK,CAAC;EAE1D,MAAMG,UAAU,GAAG,eAAAA,CAAiBC,eAAe,EAAG;IACrDL,iBAAiB,CAAE,IAAK,CAAC;IACzBG,eAAe,CAAE,IAAK,CAAC;IAEvB,IAAI;MACH;MACA;MACAN,0BAA0B,CAACS,OAAO,GAAGC,cAAc;MAClD;MACA;MACAC,OAAO,CAACC,OAAO,CAAEb,gBAAgB,CAAES,eAAgB,CAAE,CACtD,CAAC;MAED,OAAO,MAAMR,0BAA0B,CAACS,OAAO,CAACI,OAAO;IACxD,CAAC,CAAC,OAAQC,KAAK,EAAG;MACjB,IAAKA,KAAK,IAAIA,KAAK,CAACC,UAAU,EAAG;QAChC,OAAO,CAAC;MACT;MAEAT,eAAe,CACdQ,KAAK,CAACE,OAAO,IACZ,IAAAC,QAAE,EACD,8DACD,CACF,CAAC;MACD,MAAMH,KAAK;IACZ,CAAC,SAAS;MACTX,iBAAiB,CAAE,KAAM,CAAC;IAC3B;EACD,CAAC;;EAED;AACD;AACA;EACC,IAAAe,kBAAS,EAAE,MAAM;IAChB,OAAO,MAAM;MACZ;MACA,IAAKlB,0BAA0B,CAACS,OAAO,EAAG;QACzCT,0BAA0B,CAACS,OAAO,CAACU,MAAM,CAAC,CAAC;MAC5C;IACD,CAAC;EACF,CAAC,EAAE,EAAG,CAAC;EAEP,OAAO;IACNZ,UAAU;IACVL,cAAc;IACdG;EACD,CAAC;AACF;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAMK,cAAc,GAAKG,OAAO,IAAM;EACrC,IAAIO,YAAY,GAAG,KAAK;EAExB,MAAMC,cAAc,GAAG,IAAIV,OAAO,CAAE,CAAEC,OAAO,EAAEU,MAAM,KAAM;IAC1DT,OAAO,CAACU,IAAI,CACTC,GAAG,IACJJ,YAAY,GAAGE,MAAM,CAAE;MAAEP,UAAU,EAAE;IAAK,CAAE,CAAC,GAAGH,OAAO,CAAEY,GAAI,CAAC,EAC7DV,KAAK,IACNM,YAAY,GAAGE,MAAM,CAAE;MAAEP,UAAU,EAAE;IAAK,CAAE,CAAC,GAAGO,MAAM,CAAER,KAAM,CAChE,CAAC;EACF,CAAE,CAAC;EAEH,OAAO;IACND,OAAO,EAAEQ,cAAc;IACvBF,MAAMA,CAAA,EAAG;MACRC,YAAY,GAAG,IAAI;IACpB;EACD,CAAC;AACF,CAAC"}