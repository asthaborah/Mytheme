{"version":3,"names":["_utils","require","isFormattingSpace","character","htmlFormattingRemover","node","nodeType","TEXT_NODE","parent","parentNode","ELEMENT_NODE","nodeName","newData","data","replace","previousSibling","getSibling","textContent","slice","length","nextSibling","removeChild"],"sources":["@wordpress/blocks/src/api/raw-handling/html-formatting-remover.js"],"sourcesContent":["/**\n * Internal dependencies\n */\nimport { getSibling } from './utils';\n\nfunction isFormattingSpace( character ) {\n\treturn (\n\t\tcharacter === ' ' ||\n\t\tcharacter === '\\r' ||\n\t\tcharacter === '\\n' ||\n\t\tcharacter === '\\t'\n\t);\n}\n\n/**\n * Removes spacing that formats HTML.\n *\n * @see https://www.w3.org/TR/css-text-3/#white-space-processing\n *\n * @param {Node} node The node to be processed.\n * @return {void}\n */\nexport default function htmlFormattingRemover( node ) {\n\tif ( node.nodeType !== node.TEXT_NODE ) {\n\t\treturn;\n\t}\n\n\t// Ignore pre content. Note that this does not use Element#closest due to\n\t// a combination of (a) node may not be Element and (b) node.parentElement\n\t// does not have full support in all browsers (Internet Exporer).\n\t//\n\t// See: https://developer.mozilla.org/en-US/docs/Web/API/Node/parentElement#Browser_compatibility\n\n\t/** @type {Node?} */\n\tlet parent = node;\n\twhile ( ( parent = parent.parentNode ) ) {\n\t\tif (\n\t\t\tparent.nodeType === parent.ELEMENT_NODE &&\n\t\t\tparent.nodeName === 'PRE'\n\t\t) {\n\t\t\treturn;\n\t\t}\n\t}\n\n\t// First, replace any sequence of HTML formatting space with a single space.\n\tlet newData = node.data.replace( /[ \\r\\n\\t]+/g, ' ' );\n\n\t// Remove the leading space if the text element is at the start of a block,\n\t// is preceded by a line break element, or has a space in the previous\n\t// node.\n\tif ( newData[ 0 ] === ' ' ) {\n\t\tconst previousSibling = getSibling( node, 'previous' );\n\n\t\tif (\n\t\t\t! previousSibling ||\n\t\t\tpreviousSibling.nodeName === 'BR' ||\n\t\t\tpreviousSibling.textContent.slice( -1 ) === ' '\n\t\t) {\n\t\t\tnewData = newData.slice( 1 );\n\t\t}\n\t}\n\n\t// Remove the trailing space if the text element is at the end of a block,\n\t// is succeded by a line break element, or has a space in the next text\n\t// node.\n\tif ( newData[ newData.length - 1 ] === ' ' ) {\n\t\tconst nextSibling = getSibling( node, 'next' );\n\n\t\tif (\n\t\t\t! nextSibling ||\n\t\t\tnextSibling.nodeName === 'BR' ||\n\t\t\t( nextSibling.nodeType === nextSibling.TEXT_NODE &&\n\t\t\t\tisFormattingSpace( nextSibling.textContent[ 0 ] ) )\n\t\t) {\n\t\t\tnewData = newData.slice( 0, -1 );\n\t\t}\n\t}\n\n\t// If there's no data left, remove the node, so `previousSibling` stays\n\t// accurate. Otherwise, update the node data.\n\tif ( ! newData ) {\n\t\tnode.parentNode.removeChild( node );\n\t} else {\n\t\tnode.data = newData;\n\t}\n}\n"],"mappings":";;;;;;AAGA,IAAAA,MAAA,GAAAC,OAAA;AAHA;AACA;AACA;;AAGA,SAASC,iBAAiBA,CAAEC,SAAS,EAAG;EACvC,OACCA,SAAS,KAAK,GAAG,IACjBA,SAAS,KAAK,IAAI,IAClBA,SAAS,KAAK,IAAI,IAClBA,SAAS,KAAK,IAAI;AAEpB;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACe,SAASC,qBAAqBA,CAAEC,IAAI,EAAG;EACrD,IAAKA,IAAI,CAACC,QAAQ,KAAKD,IAAI,CAACE,SAAS,EAAG;IACvC;EACD;;EAEA;EACA;EACA;EACA;EACA;;EAEA;EACA,IAAIC,MAAM,GAAGH,IAAI;EACjB,OAAUG,MAAM,GAAGA,MAAM,CAACC,UAAU,EAAK;IACxC,IACCD,MAAM,CAACF,QAAQ,KAAKE,MAAM,CAACE,YAAY,IACvCF,MAAM,CAACG,QAAQ,KAAK,KAAK,EACxB;MACD;IACD;EACD;;EAEA;EACA,IAAIC,OAAO,GAAGP,IAAI,CAACQ,IAAI,CAACC,OAAO,CAAE,aAAa,EAAE,GAAI,CAAC;;EAErD;EACA;EACA;EACA,IAAKF,OAAO,CAAE,CAAC,CAAE,KAAK,GAAG,EAAG;IAC3B,MAAMG,eAAe,GAAG,IAAAC,iBAAU,EAAEX,IAAI,EAAE,UAAW,CAAC;IAEtD,IACC,CAAEU,eAAe,IACjBA,eAAe,CAACJ,QAAQ,KAAK,IAAI,IACjCI,eAAe,CAACE,WAAW,CAACC,KAAK,CAAE,CAAC,CAAE,CAAC,KAAK,GAAG,EAC9C;MACDN,OAAO,GAAGA,OAAO,CAACM,KAAK,CAAE,CAAE,CAAC;IAC7B;EACD;;EAEA;EACA;EACA;EACA,IAAKN,OAAO,CAAEA,OAAO,CAACO,MAAM,GAAG,CAAC,CAAE,KAAK,GAAG,EAAG;IAC5C,MAAMC,WAAW,GAAG,IAAAJ,iBAAU,EAAEX,IAAI,EAAE,MAAO,CAAC;IAE9C,IACC,CAAEe,WAAW,IACbA,WAAW,CAACT,QAAQ,KAAK,IAAI,IAC3BS,WAAW,CAACd,QAAQ,KAAKc,WAAW,CAACb,SAAS,IAC/CL,iBAAiB,CAAEkB,WAAW,CAACH,WAAW,CAAE,CAAC,CAAG,CAAG,EACnD;MACDL,OAAO,GAAGA,OAAO,CAACM,KAAK,CAAE,CAAC,EAAE,CAAC,CAAE,CAAC;IACjC;EACD;;EAEA;EACA;EACA,IAAK,CAAEN,OAAO,EAAG;IAChBP,IAAI,CAACI,UAAU,CAACY,WAAW,CAAEhB,IAAK,CAAC;EACpC,CAAC,MAAM;IACNA,IAAI,CAACQ,IAAI,GAAGD,OAAO;EACpB;AACD"}